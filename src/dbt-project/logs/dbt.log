2021-01-07 10:38:17.876349 (MainThread): Running with dbt=0.18.1
2021-01-07 10:38:17.967873 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.rpc.server.RPCServerTask'>, debug=False, defer=None, exclude=None, host='0.0.0.0', log_cache_events=False, log_format='default', models=None, partial_parse=True, port=8580, profile='user', profiles_dir='/usr/src/develop/.dbt', project_dir=None, record_timing_info=None, rpc_method=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='rpc', write_json=True)
2021-01-07 10:38:17.995197 (MainThread): Tracking: tracking
2021-01-07 10:38:18.005327 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a8fdc4f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9bcdde6d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a84b4070>]}
2021-01-07 10:38:18.005643 (MainThread): Serving RPC server at 0.0.0.0:8580, pid=13
2021-01-07 10:38:18.005996 (MainThread): Supported methods: ['cli_args', 'compile', 'compile_sql', 'deps', 'docs.generate', 'gc', 'get-manifest', 'kill', 'poll', 'ps', 'run', 'run-operation', 'run_sql', 'seed', 'snapshot', 'snapshot-freshness', 'status', 'test']
2021-01-07 10:38:18.006329 (MainThread): Send requests to http://localhost:8580/jsonrpc
2021-01-07 10:38:18.007199 (Thread-1): Parsing macros/relations.sql
2021-01-07 10:38:18.008102 (Thread-1): Parsing macros/adapters.sql
2021-01-07 10:38:18.034671 (Thread-1): Parsing macros/catalog.sql
2021-01-07 10:38:18.047889 (Thread-1): Parsing macros/materializations/snapshot_merge.sql
2021-01-07 10:38:18.049866 (Thread-1): Parsing macros/relations.sql
2021-01-07 10:38:18.051242 (Thread-1): Parsing macros/adapters.sql
2021-01-07 10:38:18.070857 (Thread-1): Parsing macros/catalog.sql
2021-01-07 10:38:18.073081 (Thread-1): Parsing macros/materializations/snapshot_merge.sql
2021-01-07 10:38:18.075699 (Thread-1): Parsing macros/core.sql
2021-01-07 10:38:18.079350 (Thread-1): Parsing macros/adapters/common.sql
2021-01-07 10:38:18.120382 (Thread-1): Parsing macros/materializations/helpers.sql
2021-01-07 10:38:18.128792 (Thread-1): Parsing macros/materializations/table/table.sql
2021-01-07 10:38:18.135094 (Thread-1): Parsing macros/materializations/seed/seed.sql
2021-01-07 10:38:18.154606 (Thread-1): Parsing macros/materializations/view/view.sql
2021-01-07 10:38:18.160515 (Thread-1): Parsing macros/materializations/view/create_or_replace_view.sql
2021-01-07 10:38:18.165230 (Thread-1): Parsing macros/materializations/incremental/helpers.sql
2021-01-07 10:38:18.166976 (Thread-1): Parsing macros/materializations/incremental/incremental.sql
2021-01-07 10:38:18.172702 (Thread-1): Parsing macros/materializations/common/merge.sql
2021-01-07 10:38:18.185883 (Thread-1): Parsing macros/materializations/snapshot/strategies.sql
2021-01-07 10:38:18.201418 (Thread-1): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-01-07 10:38:18.203105 (Thread-1): Parsing macros/materializations/snapshot/snapshot.sql
2021-01-07 10:38:18.230149 (Thread-1): Parsing macros/schema_tests/relationships.sql
2021-01-07 10:38:18.231962 (Thread-1): Parsing macros/schema_tests/not_null.sql
2021-01-07 10:38:18.233458 (Thread-1): Parsing macros/schema_tests/unique.sql
2021-01-07 10:38:18.235112 (Thread-1): Parsing macros/schema_tests/accepted_values.sql
2021-01-07 10:38:18.237703 (Thread-1): Parsing macros/etc/get_custom_database.sql
2021-01-07 10:38:18.239291 (Thread-1): Parsing macros/etc/query.sql
2021-01-07 10:38:18.240314 (Thread-1): Parsing macros/etc/datetime.sql
2021-01-07 10:38:18.248609 (Thread-1): Parsing macros/etc/get_custom_alias.sql
2021-01-07 10:38:18.249551 (Thread-1): Parsing macros/etc/is_incremental.sql
2021-01-07 10:38:18.251080 (Thread-1): Parsing macros/etc/get_custom_schema.sql
2021-01-07 10:38:18.285105 (Thread-2): handling status request
2021-01-07 10:38:18.285543 (Thread-2): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a8417610>]}
2021-01-07 10:38:18.287068 (Thread-2): sending response (<Response 185 bytes [200 OK]>) to 10.0.32.115
2021-01-07 10:38:18.304470 (Thread-1): Acquiring new redshift connection "model.my_new_project.top_nations".
2021-01-07 10:38:18.329932 (Thread-1): Acquiring new redshift connection "model.my_new_project.top_customers_rs".
2021-01-07 10:38:18.345677 (Thread-1): Acquiring new redshift connection "model.my_new_project.top_customers".
2021-01-07 10:38:18.360576 (Thread-1): Acquiring new redshift connection "model.my_new_project.mycustom".
2021-01-07 10:38:21.522153 (Thread-3): handling status request
2021-01-07 10:38:21.523920 (Thread-3): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a84dcfa0>]}
2021-01-07 10:38:21.527132 (Thread-3): sending response (<Response 9795 bytes [200 OK]>) to 10.0.32.115
2021-01-07 10:41:39.689030 (Thread-4): handling status request
2021-01-07 10:41:39.690608 (Thread-4): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a84dcf40>]}
2021-01-07 10:41:39.693964 (Thread-4): sending response (<Response 9795 bytes [200 OK]>) to 10.0.44.231
2021-01-07 10:41:40.099201 (Thread-5): handling compile_sql request
2021-01-07 10:41:40.099787 (Thread-5): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a84b4a60>]}
2021-01-07 10:41:40.103602 (Thread-5): Connection 'model.my_new_project.mycustom' was properly closed.
2021-01-07 10:41:40.912818 (Thread-5): sending response (<Response 138 bytes [200 OK]>) to 10.0.28.8
2021-01-07 10:41:40.928995 (MainThread): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-07 10:41:40.953439 (MainThread): Found 4 models, 0 tests, 0 snapshots, 0 analyses, 163 macros, 0 operations, 0 seed files, 0 sources
2021-01-07 10:41:40.953823 (Thread-1): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-07 10:41:40.953916 (Thread-1): Compiling rpc.my_new_project.request
2021-01-07 10:41:40.992014 (Thread-1): finished collecting timing info
2021-01-07 10:41:40.992222 (Thread-1): finished collecting timing info
2021-01-07 10:41:41.344532 (Thread-6): handling poll request
2021-01-07 10:41:41.345012 (Thread-6): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9bce46940>]}
2021-01-07 10:41:41.351016 (Thread-6): sending response (<Response 5952 bytes [200 OK]>) to 10.0.44.32
2021-01-07 10:41:45.961375 (Thread-7): Got an acceptable cached parse result
2021-01-07 10:41:45.992302 (Thread-7): Acquiring new redshift connection "model.my_new_project.top_nations".
2021-01-07 10:41:46.757474 (Thread-8): handling status request
2021-01-07 10:41:46.757902 (Thread-8): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a813f100>]}
2021-01-07 10:41:46.758800 (Thread-8): sending response (<Response 747 bytes [200 OK]>) to 10.0.2.124
2021-01-07 10:42:14.168583 (Thread-9): handling status request
2021-01-07 10:42:14.170142 (Thread-9): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a813f5b0>]}
2021-01-07 10:42:14.170994 (Thread-9): sending response (<Response 747 bytes [200 OK]>) to 10.0.27.91
2021-01-07 10:42:14.547716 (Thread-10): handling compile_sql request
2021-01-07 10:42:14.548135 (Thread-10): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a813f0d0>]}
2021-01-07 10:42:14.549347 (Thread-10): Connection 'model.my_new_project.top_nations' was properly closed.
2021-01-07 10:42:15.399409 (Thread-10): sending response (<Response 138 bytes [200 OK]>) to 10.0.30.161
2021-01-07 10:42:15.415995 (MainThread): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-07 10:42:15.435194 (MainThread): Found 4 models, 0 tests, 0 snapshots, 0 analyses, 163 macros, 0 operations, 0 seed files, 0 sources
2021-01-07 10:42:15.435583 (Thread-1): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-07 10:42:15.435693 (Thread-1): Compiling rpc.my_new_project.request
2021-01-07 10:42:15.475512 (Thread-1): finished collecting timing info
2021-01-07 10:42:15.475728 (Thread-1): finished collecting timing info
2021-01-07 10:42:15.826644 (Thread-11): handling poll request
2021-01-07 10:42:15.827223 (Thread-11): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a813fb50>]}
2021-01-07 10:42:15.834465 (Thread-11): sending response (<Response 5958 bytes [200 OK]>) to 10.0.11.112
2021-01-07 10:42:23.500459 (Thread-12): handling status request
2021-01-07 10:42:23.500914 (Thread-12): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a37fdb20>]}
2021-01-07 10:42:23.501809 (Thread-12): sending response (<Response 747 bytes [200 OK]>) to 10.0.44.231
2021-01-07 10:42:23.879738 (Thread-13): handling compile_sql request
2021-01-07 10:42:23.880159 (Thread-13): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a37fd8e0>]}
2021-01-07 10:42:24.678432 (Thread-13): sending response (<Response 138 bytes [200 OK]>) to 10.0.28.8
2021-01-07 10:42:24.694955 (MainThread): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-07 10:42:24.715495 (MainThread): Found 4 models, 0 tests, 0 snapshots, 0 analyses, 163 macros, 0 operations, 0 seed files, 0 sources
2021-01-07 10:42:24.715892 (Thread-1): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-07 10:42:24.715975 (Thread-1): Compiling rpc.my_new_project.request
2021-01-07 10:42:24.760903 (Thread-1): finished collecting timing info
2021-01-07 10:42:24.761132 (Thread-1): finished collecting timing info
2021-01-07 10:42:25.064402 (Thread-14): handling poll request
2021-01-07 10:42:25.064875 (Thread-14): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a37fd730>]}
2021-01-07 10:42:25.069560 (Thread-14): sending response (<Response 5958 bytes [200 OK]>) to 10.0.28.8
2021-01-07 10:42:30.109309 (Thread-15): Got an acceptable cached parse result
2021-01-07 10:42:30.477477 (Thread-16): handling status request
2021-01-07 10:42:30.477936 (Thread-16): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a35d24f0>]}
2021-01-07 10:42:30.478803 (Thread-16): sending response (<Response 447 bytes [200 OK]>) to 10.0.30.161
2021-01-07 10:43:43.799633 (Thread-17): handling status request
2021-01-07 10:43:43.801146 (Thread-17): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a35d2820>]}
2021-01-07 10:43:43.801979 (Thread-17): sending response (<Response 447 bytes [200 OK]>) to 10.0.43.56
2021-01-07 10:43:44.236584 (Thread-18): handling compile_sql request
2021-01-07 10:43:44.237175 (Thread-18): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a34fdc10>]}
2021-01-07 10:43:45.111276 (Thread-18): sending response (<Response 138 bytes [200 OK]>) to 10.0.44.231
2021-01-07 10:43:45.127762 (MainThread): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-07 10:43:45.147644 (MainThread): Found 4 models, 0 tests, 0 snapshots, 0 analyses, 163 macros, 0 operations, 0 seed files, 0 sources
2021-01-07 10:43:45.148618 (Thread-1): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-07 10:43:45.148718 (Thread-1): Compiling rpc.my_new_project.request
2021-01-07 10:43:45.187641 (Thread-1): finished collecting timing info
2021-01-07 10:43:45.187848 (Thread-1): finished collecting timing info
2021-01-07 10:43:45.756945 (Thread-19): handling poll request
2021-01-07 10:43:45.757573 (Thread-19): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a366d520>]}
2021-01-07 10:43:45.764114 (Thread-19): sending response (<Response 5813 bytes [200 OK]>) to 10.0.28.8
2021-01-07 10:43:47.918449 (Thread-20): Got an acceptable cached parse result
2021-01-07 10:43:48.816248 (Thread-21): handling status request
2021-01-07 10:43:48.816676 (Thread-21): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a360f8e0>]}
2021-01-07 10:43:48.817542 (Thread-21): sending response (<Response 447 bytes [200 OK]>) to 10.0.44.231
2021-01-07 10:43:54.724315 (Thread-22): Got an acceptable cached parse result
2021-01-07 10:43:55.116256 (Thread-23): handling status request
2021-01-07 10:43:55.116693 (Thread-23): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a370e1f0>]}
2021-01-07 10:43:55.117574 (Thread-23): sending response (<Response 447 bytes [200 OK]>) to 10.0.23.172
2021-01-07 10:43:59.204012 (Thread-24): handling status request
2021-01-07 10:43:59.204453 (Thread-24): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a36f4df0>]}
2021-01-07 10:43:59.205326 (Thread-24): sending response (<Response 447 bytes [200 OK]>) to 10.0.2.138
2021-01-07 10:43:59.617375 (Thread-25): handling compile_sql request
2021-01-07 10:43:59.617789 (Thread-25): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a350deb0>]}
2021-01-07 10:44:00.421343 (Thread-25): sending response (<Response 138 bytes [200 OK]>) to 10.0.2.138
2021-01-07 10:44:00.437700 (MainThread): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-07 10:44:00.456717 (MainThread): Found 4 models, 0 tests, 0 snapshots, 0 analyses, 163 macros, 0 operations, 0 seed files, 0 sources
2021-01-07 10:44:00.457104 (Thread-1): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-07 10:44:00.457198 (Thread-1): Compiling rpc.my_new_project.request
2021-01-07 10:44:00.496127 (Thread-1): finished collecting timing info
2021-01-07 10:44:00.496331 (Thread-1): finished collecting timing info
2021-01-07 10:44:00.816026 (Thread-26): handling poll request
2021-01-07 10:44:00.816478 (Thread-26): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a350deb0>]}
2021-01-07 10:44:00.820866 (Thread-26): sending response (<Response 5958 bytes [200 OK]>) to 10.0.23.172
2021-01-07 10:44:04.713611 (Thread-27): Got an acceptable cached parse result
2021-01-07 10:44:05.084096 (Thread-28): handling status request
2021-01-07 10:44:05.084697 (Thread-28): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a8413250>]}
2021-01-07 10:44:05.086013 (Thread-28): sending response (<Response 447 bytes [200 OK]>) to 10.0.2.138
2021-01-07 10:44:16.237045 (Thread-29): handling status request
2021-01-07 10:44:16.237476 (Thread-29): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a361feb0>]}
2021-01-07 10:44:16.238299 (Thread-29): sending response (<Response 447 bytes [200 OK]>) to 10.0.36.98
2021-01-07 10:44:16.638898 (Thread-30): handling run_sql request
2021-01-07 10:44:16.639309 (Thread-30): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a3562ca0>]}
2021-01-07 10:44:17.438511 (Thread-30): sending response (<Response 138 bytes [200 OK]>) to 10.0.23.172
2021-01-07 10:44:17.455547 (MainThread): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-07 10:44:17.474756 (MainThread): Found 4 models, 0 tests, 0 snapshots, 0 analyses, 163 macros, 0 operations, 0 seed files, 0 sources
2021-01-07 10:44:17.475205 (Thread-1): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-07 10:44:17.475303 (Thread-1): Compiling rpc.my_new_project.request
2021-01-07 10:44:17.516907 (Thread-1): finished collecting timing info
2021-01-07 10:44:17.517123 (Thread-1): Using redshift connection "rpc.my_new_project.request".
2021-01-07 10:44:17.517172 (Thread-1): On rpc.my_new_project.request: /*
   Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
   SPDX-License-Identifier: MIT-0
*/


/*
    Find 3 nations with the most active customers
*/



select n_name, n_comment, count(*) as active_buyers
from nation n left join "dev"."dbt_rschroeder"."top_customers" c on n.n_nationkey = c.c_nationkey
group by n_name, n_comment
order by active_buyers desc
limit 5
2021-01-07 10:44:17.517223 (Thread-1): Opening a new connection, currently in state init
2021-01-07 10:44:17.517260 (Thread-1): Connecting to Redshift using 'database' credentials
2021-01-07 10:44:17.841253 (Thread-31): handling poll request
2021-01-07 10:44:17.841749 (Thread-31): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a33485b0>]}
2021-01-07 10:44:17.843878 (Thread-31): sending response (<Response 3535 bytes [200 OK]>) to 10.0.2.138
2021-01-07 10:44:18.166451 (Thread-1): Postgres error: relation "dbt_rschroeder.top_customers" does not exist

2021-01-07 10:44:18.166636 (Thread-1): finished collecting timing info
2021-01-07 10:44:18.166872 (Thread-1): On rpc.my_new_project.request: Close
2021-01-07 10:44:18.167094 (Thread-1): Got an exception: Database Error
  relation "dbt_rschroeder.top_customers" does not exist
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/postgres/connections.py", line 46, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 78, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.UndefinedTable: relation "dbt_rschroeder.top_customers" does not exist


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 276, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 378, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/rpc/node_runners.py", line 84, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 224, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 123, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 86, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/postgres/connections.py", line 57, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error
  relation "dbt_rschroeder.top_customers" does not exist
2021-01-07 10:44:18.168225 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': 'Database Error in rpc request (from remote system)\n  relation "dbt_rschroeder.top_customers" does not exist', 'raw_sql': "/*\n   Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n   SPDX-License-Identifier: MIT-0\n*/\n\n\n/*\n    Find 3 nations with the most active customers\n*/\n\n{{ config(materialized='table') }}\n\nselect n_name, n_comment, count(*) as active_buyers\nfrom nation n left join {{ ref('top_customers') }} c on n.n_nationkey = c.c_nationkey\ngroup by n_name, n_comment\norder by active_buyers desc\nlimit 5\n", 'compiled_sql': '/*\n   Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n   SPDX-License-Identifier: MIT-0\n*/\n\n\n/*\n    Find 3 nations with the most active customers\n*/\n\n\n\nselect n_name, n_comment, count(*) as active_buyers\nfrom nation n left join "dev"."dbt_rschroeder"."top_customers" c on n.n_nationkey = c.c_nationkey\ngroup by n_name, n_comment\norder by active_buyers desc\nlimit 5', 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/rpc/sql_commands.py", line 145, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 349, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt/rpc/node_runners.py", line 52, in error_result
    raise error
dbt.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': 'Database Error in rpc request (from remote system)\n  relation "dbt_rschroeder.top_customers" does not exist', 'raw_sql': "/*\n   Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n   SPDX-License-Identifier: MIT-0\n*/\n\n\n/*\n    Find 3 nations with the most active customers\n*/\n\n{{ config(materialized='table') }}\n\nselect n_name, n_comment, count(*) as active_buyers\nfrom nation n left join {{ ref('top_customers') }} c on n.n_nationkey = c.c_nationkey\ngroup by n_name, n_comment\norder by active_buyers desc\nlimit 5\n", 'compiled_sql': '/*\n   Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n   SPDX-License-Identifier: MIT-0\n*/\n\n\n/*\n    Find 3 nations with the most active customers\n*/\n\n\n\nselect n_name, n_comment, count(*) as active_buyers\nfrom nation n left join "dev"."dbt_rschroeder"."top_customers" c on n.n_nationkey = c.c_nationkey\ngroup by n_name, n_comment\norder by active_buyers desc\nlimit 5', 'tags': None}, None)
2021-01-07 10:44:19.295445 (Thread-32): handling poll request
2021-01-07 10:44:19.295889 (Thread-32): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a3348cd0>]}
2021-01-07 10:44:19.296834 (Thread-32): sending response (<Response 10479 bytes [200 OK]>) to 10.0.44.231
2021-01-07 10:45:22.154762 (Thread-33): Got an acceptable cached parse result
2021-01-07 10:45:22.910747 (Thread-34): handling status request
2021-01-07 10:45:22.911228 (Thread-34): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a350d730>]}
2021-01-07 10:45:22.912147 (Thread-34): sending response (<Response 447 bytes [200 OK]>) to 10.0.29.77
2021-01-07 10:55:48.969488 (Thread-35): handling status request
2021-01-07 10:55:48.969912 (Thread-35): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a32cb910>]}
2021-01-07 10:55:48.970720 (Thread-35): sending response (<Response 447 bytes [200 OK]>) to 10.0.44.231
2021-01-07 10:57:02.410770 (Thread-36): handling status request
2021-01-07 10:57:02.412228 (Thread-36): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a32cb7f0>]}
2021-01-07 10:57:02.442204 (Thread-36): sending response (<Response 447 bytes [200 OK]>) to 10.0.29.77
2021-01-07 10:57:07.694579 (Thread-37): Parsing macros/relations.sql
2021-01-07 10:57:07.695384 (Thread-37): Parsing macros/adapters.sql
2021-01-07 10:57:07.721104 (Thread-37): Parsing macros/catalog.sql
2021-01-07 10:57:07.733475 (Thread-37): Parsing macros/materializations/snapshot_merge.sql
2021-01-07 10:57:07.734424 (Thread-37): Parsing macros/relations.sql
2021-01-07 10:57:07.735802 (Thread-37): Parsing macros/adapters.sql
2021-01-07 10:57:07.755588 (Thread-37): Parsing macros/catalog.sql
2021-01-07 10:57:07.757813 (Thread-37): Parsing macros/materializations/snapshot_merge.sql
2021-01-07 10:57:07.760391 (Thread-37): Parsing macros/core.sql
2021-01-07 10:57:07.763891 (Thread-37): Parsing macros/adapters/common.sql
2021-01-07 10:57:07.805377 (Thread-37): Parsing macros/materializations/helpers.sql
2021-01-07 10:57:07.813848 (Thread-37): Parsing macros/materializations/table/table.sql
2021-01-07 10:57:07.820375 (Thread-37): Parsing macros/materializations/seed/seed.sql
2021-01-07 10:57:07.839865 (Thread-37): Parsing macros/materializations/view/view.sql
2021-01-07 10:57:07.845814 (Thread-37): Parsing macros/materializations/view/create_or_replace_view.sql
2021-01-07 10:57:07.850483 (Thread-37): Parsing macros/materializations/incremental/helpers.sql
2021-01-07 10:57:07.852239 (Thread-37): Parsing macros/materializations/incremental/incremental.sql
2021-01-07 10:57:07.858099 (Thread-37): Parsing macros/materializations/common/merge.sql
2021-01-07 10:57:07.871439 (Thread-37): Parsing macros/materializations/snapshot/strategies.sql
2021-01-07 10:57:07.887106 (Thread-37): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-01-07 10:57:07.888818 (Thread-37): Parsing macros/materializations/snapshot/snapshot.sql
2021-01-07 10:57:07.916781 (Thread-37): Parsing macros/schema_tests/relationships.sql
2021-01-07 10:57:07.918673 (Thread-37): Parsing macros/schema_tests/not_null.sql
2021-01-07 10:57:07.920235 (Thread-37): Parsing macros/schema_tests/unique.sql
2021-01-07 10:57:07.921958 (Thread-37): Parsing macros/schema_tests/accepted_values.sql
2021-01-07 10:57:07.924691 (Thread-37): Parsing macros/etc/get_custom_database.sql
2021-01-07 10:57:07.926391 (Thread-37): Parsing macros/etc/query.sql
2021-01-07 10:57:07.927497 (Thread-37): Parsing macros/etc/datetime.sql
2021-01-07 10:57:07.936245 (Thread-37): Parsing macros/etc/get_custom_alias.sql
2021-01-07 10:57:07.937206 (Thread-37): Parsing macros/etc/is_incremental.sql
2021-01-07 10:57:07.938821 (Thread-37): Parsing macros/etc/get_custom_schema.sql
2021-01-07 10:57:07.979016 (Thread-37): Acquiring new redshift connection "model.my_new_project.top_nations".
2021-01-07 10:57:07.999975 (Thread-37): Acquiring new redshift connection "model.my_new_project.top_customers_rs".
2021-01-07 10:57:08.014962 (Thread-37): Acquiring new redshift connection "model.my_new_project.top_customers".
2021-01-07 10:57:08.028185 (Thread-37): Acquiring new redshift connection "model.my_new_project.mycustom".
2021-01-07 10:57:08.561163 (Thread-38): handling status request
2021-01-07 10:57:08.561604 (Thread-38): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a350d3a0>]}
2021-01-07 10:57:08.564810 (Thread-38): sending response (<Response 9830 bytes [200 OK]>) to 10.0.44.231
2021-01-07 10:57:43.758541 (Thread-39): handling status request
2021-01-07 10:57:43.758972 (Thread-39): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a350d310>]}
2021-01-07 10:57:43.762114 (Thread-39): sending response (<Response 9830 bytes [200 OK]>) to 10.0.2.124
2021-01-07 10:57:44.436461 (Thread-40): handling run_sql request
2021-01-07 10:57:44.436975 (Thread-40): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a32cbbe0>]}
2021-01-07 10:57:44.438187 (Thread-40): Connection 'model.my_new_project.mycustom' was properly closed.
2021-01-07 10:57:45.295951 (Thread-40): sending response (<Response 138 bytes [200 OK]>) to 10.0.32.115
2021-01-07 10:57:45.312553 (MainThread): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-07 10:57:45.333352 (MainThread): Found 4 models, 0 tests, 0 snapshots, 0 analyses, 163 macros, 0 operations, 0 seed files, 0 sources
2021-01-07 10:57:45.333791 (Thread-1): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-07 10:57:45.333895 (Thread-1): Compiling rpc.my_new_project.request
2021-01-07 10:57:45.381727 (Thread-1): finished collecting timing info
2021-01-07 10:57:45.382081 (Thread-1): Using redshift connection "rpc.my_new_project.request".
2021-01-07 10:57:45.382162 (Thread-1): On rpc.my_new_project.request: /*
   Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
   SPDX-License-Identifier: MIT-0
*/


/*
    Find 3 nations with the most active customers
*/



select n_name, n_comment, count(*) as active_buyers
from nation n left join "dev"."dbt_rschroeder"."top_customers" c on n.n_nationkey = c.c_nationkey
group by n_name, n_comment
order by active_buyers desc
limit 5
2021-01-07 10:57:45.382242 (Thread-1): Opening a new connection, currently in state init
2021-01-07 10:57:45.382305 (Thread-1): Connecting to Redshift using 'database' credentials
2021-01-07 10:57:45.730849 (Thread-41): handling poll request
2021-01-07 10:57:45.731367 (Thread-41): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a36b51f0>]}
2021-01-07 10:57:45.733522 (Thread-41): sending response (<Response 3535 bytes [200 OK]>) to 10.0.2.138
2021-01-07 10:57:46.002431 (Thread-1): Postgres error: relation "dbt_rschroeder.top_customers" does not exist

2021-01-07 10:57:46.002624 (Thread-1): finished collecting timing info
2021-01-07 10:57:46.002875 (Thread-1): On rpc.my_new_project.request: Close
2021-01-07 10:57:46.003108 (Thread-1): Got an exception: Database Error
  relation "dbt_rschroeder.top_customers" does not exist
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/postgres/connections.py", line 46, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 78, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.UndefinedTable: relation "dbt_rschroeder.top_customers" does not exist


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 276, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 378, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/rpc/node_runners.py", line 84, in execute
    _, execute_result = self.adapter.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 224, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 123, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 86, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/postgres/connections.py", line 57, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error
  relation "dbt_rschroeder.top_customers" does not exist
2021-01-07 10:57:46.004241 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': 'Database Error in rpc request (from remote system)\n  relation "dbt_rschroeder.top_customers" does not exist', 'raw_sql': "/*\n   Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n   SPDX-License-Identifier: MIT-0\n*/\n\n\n/*\n    Find 3 nations with the most active customers\n*/\n\n{{ config(materialized='table') }}\n\nselect n_name, n_comment, count(*) as active_buyers\nfrom nation n left join {{ ref('top_customers') }} c on n.n_nationkey = c.c_nationkey\ngroup by n_name, n_comment\norder by active_buyers desc\nlimit 5\n", 'compiled_sql': '/*\n   Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n   SPDX-License-Identifier: MIT-0\n*/\n\n\n/*\n    Find 3 nations with the most active customers\n*/\n\n\n\nselect n_name, n_comment, count(*) as active_buyers\nfrom nation n left join "dev"."dbt_rschroeder"."top_customers" c on n.n_nationkey = c.c_nationkey\ngroup by n_name, n_comment\norder by active_buyers desc\nlimit 5', 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/rpc/sql_commands.py", line 145, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 349, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.8/dist-packages/dbt/rpc/node_runners.py", line 52, in error_result
    raise error
dbt.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': 'Database Error in rpc request (from remote system)\n  relation "dbt_rschroeder.top_customers" does not exist', 'raw_sql': "/*\n   Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n   SPDX-License-Identifier: MIT-0\n*/\n\n\n/*\n    Find 3 nations with the most active customers\n*/\n\n{{ config(materialized='table') }}\n\nselect n_name, n_comment, count(*) as active_buyers\nfrom nation n left join {{ ref('top_customers') }} c on n.n_nationkey = c.c_nationkey\ngroup by n_name, n_comment\norder by active_buyers desc\nlimit 5\n", 'compiled_sql': '/*\n   Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n   SPDX-License-Identifier: MIT-0\n*/\n\n\n/*\n    Find 3 nations with the most active customers\n*/\n\n\n\nselect n_name, n_comment, count(*) as active_buyers\nfrom nation n left join "dev"."dbt_rschroeder"."top_customers" c on n.n_nationkey = c.c_nationkey\ngroup by n_name, n_comment\norder by active_buyers desc\nlimit 5', 'tags': None}, None)
2021-01-07 10:57:47.755552 (Thread-42): handling poll request
2021-01-07 10:57:47.756805 (Thread-42): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a341fca0>]}
2021-01-07 10:57:47.757660 (Thread-42): sending response (<Response 10479 bytes [200 OK]>) to 10.0.2.77
2021-01-07 11:00:20.385061 (Thread-43): handling status request
2021-01-07 11:00:20.386548 (Thread-43): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a3348fa0>]}
2021-01-07 11:00:20.389862 (Thread-43): sending response (<Response 9830 bytes [200 OK]>) to 10.0.32.115
2021-01-07 11:00:20.829402 (Thread-44): handling compile_sql request
2021-01-07 11:00:20.829834 (Thread-44): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a350d2b0>]}
2021-01-07 11:00:21.736984 (Thread-44): sending response (<Response 138 bytes [200 OK]>) to 10.0.32.115
2021-01-07 11:00:21.755578 (MainThread): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-07 11:00:21.779591 (MainThread): Found 4 models, 0 tests, 0 snapshots, 0 analyses, 163 macros, 0 operations, 0 seed files, 0 sources
2021-01-07 11:00:21.780017 (Thread-1): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-07 11:00:21.780116 (Thread-1): Compiling rpc.my_new_project.request
2021-01-07 11:00:21.821870 (Thread-1): finished collecting timing info
2021-01-07 11:00:21.822086 (Thread-1): finished collecting timing info
2021-01-07 11:00:22.121321 (Thread-45): handling poll request
2021-01-07 11:00:22.121772 (Thread-45): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a330b280>]}
2021-01-07 11:00:22.126229 (Thread-45): sending response (<Response 5958 bytes [200 OK]>) to 10.0.28.8
2021-01-07 11:00:25.685786 (Thread-46): handling status request
2021-01-07 11:00:25.686253 (Thread-46): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a331e9a0>]}
2021-01-07 11:00:25.689642 (Thread-46): sending response (<Response 9830 bytes [200 OK]>) to 10.0.28.8
2021-01-07 11:00:26.315828 (Thread-47): handling run_sql request
2021-01-07 11:00:26.316257 (Thread-47): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a33f98e0>]}
2021-01-07 11:00:27.150549 (Thread-47): sending response (<Response 138 bytes [200 OK]>) to 10.0.23.172
2021-01-07 11:00:27.167222 (MainThread): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-07 11:00:27.186696 (MainThread): Found 4 models, 0 tests, 0 snapshots, 0 analyses, 163 macros, 0 operations, 0 seed files, 0 sources
2021-01-07 11:00:27.187126 (Thread-1): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-07 11:00:27.187232 (Thread-1): Compiling rpc.my_new_project.request
2021-01-07 11:00:27.244059 (Thread-1): finished collecting timing info
2021-01-07 11:00:27.244433 (Thread-1): Using redshift connection "rpc.my_new_project.request".
2021-01-07 11:00:27.244514 (Thread-1): On rpc.my_new_project.request: /*
   Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
   SPDX-License-Identifier: MIT-0
*/


/*
    Find 3 nations with the most active customers
*/



select n_name, n_comment, count(*) as active_buyers
from nation n left join "dev"."dbt_rschroeder"."top_customers" c on n.n_nationkey = c.c_nationkey
group by n_name, n_comment
order by active_buyers desc
limit 5
2021-01-07 11:00:27.244594 (Thread-1): Opening a new connection, currently in state init
2021-01-07 11:00:27.244654 (Thread-1): Connecting to Redshift using 'database' credentials
2021-01-07 11:00:27.528599 (Thread-48): handling poll request
2021-01-07 11:00:27.529137 (Thread-48): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a33f92b0>]}
2021-01-07 11:00:27.533006 (Thread-48): sending response (<Response 3534 bytes [200 OK]>) to 10.0.29.77
2021-01-07 11:00:28.932003 (Thread-49): handling poll request
2021-01-07 11:00:28.932421 (Thread-49): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a37ddac0>]}
2021-01-07 11:00:28.933330 (Thread-49): sending response (<Response 409 bytes [200 OK]>) to 10.0.2.138
2021-01-07 11:00:30.354125 (Thread-50): handling poll request
2021-01-07 11:00:30.354529 (Thread-50): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a33139d0>]}
2021-01-07 11:00:30.355418 (Thread-50): sending response (<Response 410 bytes [200 OK]>) to 10.0.43.56
2021-01-07 11:00:31.755410 (Thread-51): handling poll request
2021-01-07 11:00:31.755839 (Thread-51): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a33d63d0>]}
2021-01-07 11:00:31.756719 (Thread-51): sending response (<Response 410 bytes [200 OK]>) to 10.0.28.8
2021-01-07 11:00:33.161691 (Thread-52): handling poll request
2021-01-07 11:00:33.162118 (Thread-52): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a33d6ca0>]}
2021-01-07 11:00:33.162977 (Thread-52): sending response (<Response 410 bytes [200 OK]>) to 10.0.2.77
2021-01-07 11:00:33.398497 (Thread-1): SQL status: SELECT in 6.15 seconds
2021-01-07 11:00:33.400951 (Thread-1): finished collecting timing info
2021-01-07 11:00:33.401224 (Thread-1): On rpc.my_new_project.request: Close
2021-01-07 11:00:34.592369 (Thread-53): handling poll request
2021-01-07 11:00:34.592822 (Thread-53): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a32f5d30>]}
2021-01-07 11:00:34.596600 (Thread-53): sending response (<Response 5626 bytes [200 OK]>) to 10.0.44.231
2021-01-07 11:24:30.727585 (Thread-54): handling status request
2021-01-07 11:24:30.728014 (Thread-54): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a32f5f40>]}
2021-01-07 11:24:30.732360 (Thread-54): sending response (<Response 9830 bytes [200 OK]>) to 10.0.3.50
2021-01-07 11:24:31.186300 (Thread-55): handling ps request
2021-01-07 11:24:31.186718 (Thread-55): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a32f5520>]}
2021-01-07 11:24:31.189986 (Thread-55): sending response (<Response 4869 bytes [200 OK]>) to 10.0.36.98
2021-01-07 11:37:25.101420 (Thread-56): handling status request
2021-01-07 11:37:25.103017 (Thread-56): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a32f55b0>]}
2021-01-07 11:37:25.106202 (Thread-56): sending response (<Response 9830 bytes [200 OK]>) to 10.0.28.8
2021-01-07 11:37:26.214903 (Thread-57): handling compile_sql request
2021-01-07 11:37:26.215319 (Thread-57): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a331e9d0>]}
2021-01-07 11:37:27.056543 (Thread-57): sending response (<Response 138 bytes [200 OK]>) to 10.0.11.112
2021-01-07 11:37:27.073264 (MainThread): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-07 11:37:27.092285 (MainThread): Found 4 models, 0 tests, 0 snapshots, 0 analyses, 163 macros, 0 operations, 0 seed files, 0 sources
2021-01-07 11:37:27.092731 (Thread-1): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-07 11:37:27.092854 (Thread-1): Compiling rpc.my_new_project.request
2021-01-07 11:37:27.136209 (Thread-1): finished collecting timing info
2021-01-07 11:37:27.136506 (Thread-1): finished collecting timing info
2021-01-07 11:37:27.705748 (Thread-58): handling poll request
2021-01-07 11:37:27.706216 (Thread-58): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a845d0d0>]}
2021-01-07 11:37:27.710688 (Thread-58): sending response (<Response 4063 bytes [200 OK]>) to 10.0.23.172
2021-01-07 11:37:37.911312 (Thread-59): handling status request
2021-01-07 11:37:37.911771 (Thread-59): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a33f99d0>]}
2021-01-07 11:37:37.915157 (Thread-59): sending response (<Response 9830 bytes [200 OK]>) to 10.0.29.77
2021-01-07 11:37:38.322974 (Thread-60): handling run_sql request
2021-01-07 11:37:38.323400 (Thread-60): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a32f5880>]}
2021-01-07 11:37:39.215294 (Thread-60): sending response (<Response 138 bytes [200 OK]>) to 10.0.3.50
2021-01-07 11:37:39.231824 (MainThread): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-07 11:37:39.248740 (MainThread): Found 4 models, 0 tests, 0 snapshots, 0 analyses, 163 macros, 0 operations, 0 seed files, 0 sources
2021-01-07 11:37:39.249147 (Thread-1): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-07 11:37:39.249248 (Thread-1): Compiling rpc.my_new_project.request
2021-01-07 11:37:39.290536 (Thread-1): finished collecting timing info
2021-01-07 11:37:39.290762 (Thread-1): Using redshift connection "rpc.my_new_project.request".
2021-01-07 11:37:39.290813 (Thread-1): On rpc.my_new_project.request: Select
*
from dbt_rschroeder.top_customers
limit 10;

2021-01-07 11:37:39.290864 (Thread-1): Opening a new connection, currently in state init
2021-01-07 11:37:39.290902 (Thread-1): Connecting to Redshift using 'database' credentials
2021-01-07 11:37:39.738683 (Thread-61): handling poll request
2021-01-07 11:37:39.739128 (Thread-61): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a3331f10>]}
2021-01-07 11:37:39.741237 (Thread-61): sending response (<Response 3172 bytes [200 OK]>) to 10.0.44.231
2021-01-07 11:37:40.121127 (Thread-1): SQL status: SELECT in 0.83 seconds
2021-01-07 11:37:40.121557 (Thread-1): finished collecting timing info
2021-01-07 11:37:40.121797 (Thread-1): On rpc.my_new_project.request: Close
2021-01-07 11:37:41.161898 (Thread-62): handling poll request
2021-01-07 11:37:41.162309 (Thread-62): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '58d899f3-8e77-449c-8bb2-38758abc61b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9a3331a90>]}
2021-01-07 11:37:41.166045 (Thread-62): sending response (<Response 3373 bytes [200 OK]>) to 10.0.43.56
2021-01-08 12:35:10.191227 (MainThread): Running with dbt=0.18.1
2021-01-08 12:35:10.289457 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.rpc.server.RPCServerTask'>, debug=False, defer=None, exclude=None, host='0.0.0.0', log_cache_events=False, log_format='default', models=None, partial_parse=True, port=8580, profile='user', profiles_dir='/usr/src/develop/.dbt', project_dir=None, record_timing_info=None, rpc_method=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='rpc', write_json=True)
2021-01-08 12:35:10.309468 (MainThread): Tracking: tracking
2021-01-08 12:35:10.335068 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f804fa80b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f804b538c70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f804b5333a0>]}
2021-01-08 12:35:10.335457 (MainThread): Serving RPC server at 0.0.0.0:8580, pid=13
2021-01-08 12:35:10.336234 (MainThread): Supported methods: ['cli_args', 'compile', 'compile_sql', 'deps', 'docs.generate', 'gc', 'get-manifest', 'kill', 'poll', 'ps', 'run', 'run-operation', 'run_sql', 'seed', 'snapshot', 'snapshot-freshness', 'status', 'test']
2021-01-08 12:35:10.336483 (MainThread): Send requests to http://localhost:8580/jsonrpc
2021-01-08 12:35:10.337925 (Thread-1): Parsing macros/relations.sql
2021-01-08 12:35:10.338927 (Thread-1): Parsing macros/adapters.sql
2021-01-08 12:35:10.366229 (Thread-1): Parsing macros/catalog.sql
2021-01-08 12:35:10.379049 (Thread-1): Parsing macros/materializations/snapshot_merge.sql
2021-01-08 12:35:10.380063 (Thread-1): Parsing macros/relations.sql
2021-01-08 12:35:10.381533 (Thread-1): Parsing macros/adapters.sql
2021-01-08 12:35:10.408964 (Thread-2): handling status request
2021-01-08 12:35:10.409410 (Thread-2): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '3ae359a1-93f0-4fd2-8352-b0bed91a2f9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f804b550dc0>]}
2021-01-08 12:35:10.409537 (Thread-1): Parsing macros/catalog.sql
2021-01-08 12:35:10.411448 (Thread-2): sending response (<Response 185 bytes [200 OK]>) to 10.0.43.37
2021-01-08 12:35:10.414465 (Thread-1): Parsing macros/materializations/snapshot_merge.sql
2021-01-08 12:35:10.417496 (Thread-1): Parsing macros/core.sql
2021-01-08 12:35:10.421231 (Thread-1): Parsing macros/adapters/common.sql
2021-01-08 12:35:10.471396 (Thread-1): Parsing macros/materializations/helpers.sql
2021-01-08 12:35:10.480099 (Thread-1): Parsing macros/materializations/table/table.sql
2021-01-08 12:35:10.486808 (Thread-1): Parsing macros/materializations/seed/seed.sql
2021-01-08 12:35:10.507243 (Thread-1): Parsing macros/materializations/view/view.sql
2021-01-08 12:35:10.513637 (Thread-1): Parsing macros/materializations/view/create_or_replace_view.sql
2021-01-08 12:35:10.518469 (Thread-1): Parsing macros/materializations/incremental/helpers.sql
2021-01-08 12:35:10.520311 (Thread-1): Parsing macros/materializations/incremental/incremental.sql
2021-01-08 12:35:10.526291 (Thread-1): Parsing macros/materializations/common/merge.sql
2021-01-08 12:35:10.539864 (Thread-1): Parsing macros/materializations/snapshot/strategies.sql
2021-01-08 12:35:10.556087 (Thread-1): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-01-08 12:35:10.557839 (Thread-1): Parsing macros/materializations/snapshot/snapshot.sql
2021-01-08 12:35:10.585356 (Thread-1): Parsing macros/schema_tests/relationships.sql
2021-01-08 12:35:10.587257 (Thread-1): Parsing macros/schema_tests/not_null.sql
2021-01-08 12:35:10.588819 (Thread-1): Parsing macros/schema_tests/unique.sql
2021-01-08 12:35:10.590529 (Thread-1): Parsing macros/schema_tests/accepted_values.sql
2021-01-08 12:35:10.593232 (Thread-1): Parsing macros/etc/get_custom_database.sql
2021-01-08 12:35:10.594878 (Thread-1): Parsing macros/etc/query.sql
2021-01-08 12:35:10.595960 (Thread-1): Parsing macros/etc/datetime.sql
2021-01-08 12:35:10.604519 (Thread-1): Parsing macros/etc/get_custom_alias.sql
2021-01-08 12:35:10.605483 (Thread-1): Parsing macros/etc/is_incremental.sql
2021-01-08 12:35:10.607055 (Thread-1): Parsing macros/etc/get_custom_schema.sql
2021-01-08 12:35:10.661950 (Thread-1): Acquiring new redshift connection "model.my_new_project.top_nations".
2021-01-08 12:35:10.692463 (Thread-1): Acquiring new redshift connection "model.my_new_project.top_customers_rs".
2021-01-08 12:35:10.710496 (Thread-1): Acquiring new redshift connection "model.my_new_project.top_customers".
2021-01-08 12:35:10.727929 (Thread-1): Acquiring new redshift connection "model.my_new_project.mycustom".
2021-01-08 12:35:17.243678 (Thread-3): handling status request
2021-01-08 12:35:17.244110 (Thread-3): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '3ae359a1-93f0-4fd2-8352-b0bed91a2f9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f804a25fe80>]}
2021-01-08 12:35:17.247596 (Thread-3): sending response (<Response 9795 bytes [200 OK]>) to 10.0.26.143
2021-01-08 12:39:40.334720 (Thread-4): handling status request
2021-01-08 12:39:40.336579 (Thread-4): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '3ae359a1-93f0-4fd2-8352-b0bed91a2f9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f804a25feb0>]}
2021-01-08 12:39:40.339851 (Thread-4): sending response (<Response 9795 bytes [200 OK]>) to 10.0.26.143
2021-01-08 12:39:42.307131 (Thread-5): handling compile_sql request
2021-01-08 12:39:42.307585 (Thread-5): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '3ae359a1-93f0-4fd2-8352-b0bed91a2f9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f804a25f9d0>]}
2021-01-08 12:39:42.310245 (Thread-5): Connection 'model.my_new_project.mycustom' was properly closed.
2021-01-08 12:39:43.160976 (Thread-5): sending response (<Response 138 bytes [200 OK]>) to 10.0.37.69
2021-01-08 12:39:43.187523 (MainThread): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-08 12:39:43.208836 (MainThread): Found 4 models, 0 tests, 0 snapshots, 0 analyses, 163 macros, 0 operations, 0 seed files, 0 sources
2021-01-08 12:39:43.209265 (Thread-1): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-08 12:39:43.209362 (Thread-1): Compiling rpc.my_new_project.request
2021-01-08 12:39:43.267476 (Thread-1): finished collecting timing info
2021-01-08 12:39:43.267740 (Thread-1): finished collecting timing info
2021-01-08 12:39:43.586911 (Thread-6): handling poll request
2021-01-08 12:39:43.587363 (Thread-6): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '3ae359a1-93f0-4fd2-8352-b0bed91a2f9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f804a153c10>]}
2021-01-08 12:39:43.596640 (Thread-6): sending response (<Response 609342 bytes [200 OK]>) to 10.0.40.118
2021-01-08 12:44:39.724688 (Thread-7): handling status request
2021-01-08 12:44:39.725117 (Thread-7): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '3ae359a1-93f0-4fd2-8352-b0bed91a2f9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f804a153160>]}
2021-01-08 12:44:39.728448 (Thread-7): sending response (<Response 9795 bytes [200 OK]>) to 10.0.26.143
2021-01-08 12:44:58.063456 (Thread-8): handling status request
2021-01-08 12:44:58.063909 (Thread-8): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '3ae359a1-93f0-4fd2-8352-b0bed91a2f9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f804a153100>]}
2021-01-08 12:44:58.067230 (Thread-8): sending response (<Response 9795 bytes [200 OK]>) to 10.0.17.213
2021-01-08 12:59:26.305605 (MainThread): Running with dbt=0.18.1
2021-01-08 12:59:26.399161 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.rpc.server.RPCServerTask'>, debug=False, defer=None, exclude=None, host='0.0.0.0', log_cache_events=False, log_format='default', models=None, partial_parse=True, port=8580, profile='user', profiles_dir='/usr/src/develop/.dbt', project_dir=None, record_timing_info=None, rpc_method=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='rpc', write_json=True)
2021-01-08 12:59:26.410489 (MainThread): Tracking: tracking
2021-01-08 12:59:26.437945 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d78222460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6fcdaeb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6fcdab20>]}
2021-01-08 12:59:26.438412 (MainThread): Serving RPC server at 0.0.0.0:8580, pid=13
2021-01-08 12:59:26.439173 (MainThread): Supported methods: ['cli_args', 'compile', 'compile_sql', 'deps', 'docs.generate', 'gc', 'get-manifest', 'kill', 'poll', 'ps', 'run', 'run-operation', 'run_sql', 'seed', 'snapshot', 'snapshot-freshness', 'status', 'test']
2021-01-08 12:59:26.439389 (MainThread): Send requests to http://localhost:8580/jsonrpc
2021-01-08 12:59:26.440794 (Thread-1): Parsing macros/relations.sql
2021-01-08 12:59:26.441807 (Thread-1): Parsing macros/adapters.sql
2021-01-08 12:59:26.467946 (Thread-1): Parsing macros/catalog.sql
2021-01-08 12:59:26.480315 (Thread-1): Parsing macros/materializations/snapshot_merge.sql
2021-01-08 12:59:26.481258 (Thread-1): Parsing macros/relations.sql
2021-01-08 12:59:26.482777 (Thread-1): Parsing macros/adapters.sql
2021-01-08 12:59:26.502890 (Thread-1): Parsing macros/catalog.sql
2021-01-08 12:59:26.505108 (Thread-1): Parsing macros/materializations/snapshot_merge.sql
2021-01-08 12:59:26.507776 (Thread-1): Parsing macros/core.sql
2021-01-08 12:59:26.511361 (Thread-1): Parsing macros/adapters/common.sql
2021-01-08 12:59:26.552567 (Thread-1): Parsing macros/materializations/helpers.sql
2021-01-08 12:59:26.561053 (Thread-1): Parsing macros/materializations/table/table.sql
2021-01-08 12:59:26.567574 (Thread-1): Parsing macros/materializations/seed/seed.sql
2021-01-08 12:59:26.587161 (Thread-1): Parsing macros/materializations/view/view.sql
2021-01-08 12:59:26.593141 (Thread-1): Parsing macros/materializations/view/create_or_replace_view.sql
2021-01-08 12:59:26.597844 (Thread-1): Parsing macros/materializations/incremental/helpers.sql
2021-01-08 12:59:26.599642 (Thread-1): Parsing macros/materializations/incremental/incremental.sql
2021-01-08 12:59:26.605518 (Thread-1): Parsing macros/materializations/common/merge.sql
2021-01-08 12:59:26.618877 (Thread-1): Parsing macros/materializations/snapshot/strategies.sql
2021-01-08 12:59:26.634599 (Thread-1): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-01-08 12:59:26.636309 (Thread-1): Parsing macros/materializations/snapshot/snapshot.sql
2021-01-08 12:59:26.663379 (Thread-1): Parsing macros/schema_tests/relationships.sql
2021-01-08 12:59:26.665201 (Thread-1): Parsing macros/schema_tests/not_null.sql
2021-01-08 12:59:26.666716 (Thread-1): Parsing macros/schema_tests/unique.sql
2021-01-08 12:59:26.668374 (Thread-1): Parsing macros/schema_tests/accepted_values.sql
2021-01-08 12:59:26.671007 (Thread-1): Parsing macros/etc/get_custom_database.sql
2021-01-08 12:59:26.672606 (Thread-1): Parsing macros/etc/query.sql
2021-01-08 12:59:26.673630 (Thread-1): Parsing macros/etc/datetime.sql
2021-01-08 12:59:26.682010 (Thread-1): Parsing macros/etc/get_custom_alias.sql
2021-01-08 12:59:26.682990 (Thread-1): Parsing macros/etc/is_incremental.sql
2021-01-08 12:59:26.684539 (Thread-1): Parsing macros/etc/get_custom_schema.sql
2021-01-08 12:59:26.737738 (Thread-1): Acquiring new redshift connection "model.my_new_project.top_nations".
2021-01-08 12:59:26.763232 (Thread-1): Acquiring new redshift connection "model.my_new_project.bar_table_test_cbt".
2021-01-08 12:59:26.777962 (Thread-1): Acquiring new redshift connection "model.my_new_project.top_customers_rs".
2021-01-08 12:59:26.794259 (Thread-1): Acquiring new redshift connection "model.my_new_project.top_customers".
2021-01-08 12:59:26.808678 (Thread-1): Acquiring new redshift connection "model.my_new_project.mycustom".
2021-01-08 12:59:27.354989 (Thread-2): handling status request
2021-01-08 12:59:27.355415 (Thread-2): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f2fd340>]}
2021-01-08 12:59:27.359582 (Thread-2): sending response (<Response 10103 bytes [200 OK]>) to 10.0.37.69
2021-01-08 12:59:27.990507 (Thread-3): handling status request
2021-01-08 12:59:27.990913 (Thread-3): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d741c75b0>]}
2021-01-08 12:59:27.994079 (Thread-3): sending response (<Response 10103 bytes [200 OK]>) to 10.0.31.102
2021-01-08 13:03:19.297759 (Thread-4): handling status request
2021-01-08 13:03:19.300495 (Thread-4): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d741c7730>]}
2021-01-08 13:03:19.303716 (Thread-4): sending response (<Response 10103 bytes [200 OK]>) to 10.0.15.240
2021-01-08 13:03:19.805935 (Thread-5): handling compile_sql request
2021-01-08 13:03:19.806562 (Thread-5): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6ff88c10>]}
2021-01-08 13:03:19.810613 (Thread-5): Connection 'model.my_new_project.mycustom' was properly closed.
2021-01-08 13:03:21.153515 (Thread-5): sending response (<Response 138 bytes [200 OK]>) to 10.0.43.37
2021-01-08 13:03:21.184530 (MainThread): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-08 13:03:21.226408 (MainThread): Found 5 models, 0 tests, 0 snapshots, 0 analyses, 163 macros, 0 operations, 0 seed files, 0 sources
2021-01-08 13:03:21.227082 (Thread-1): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-08 13:03:21.227233 (Thread-1): Compiling rpc.my_new_project.request
2021-01-08 13:03:21.294647 (Thread-1): finished collecting timing info
2021-01-08 13:03:21.295120 (Thread-1): finished collecting timing info
2021-01-08 13:03:21.784119 (Thread-6): handling poll request
2021-01-08 13:03:21.784773 (Thread-6): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f2467f0>]}
2021-01-08 13:03:21.794806 (Thread-6): sending response (<Response 4869 bytes [200 OK]>) to 10.0.35.111
2021-01-08 13:03:36.952048 (Thread-7): handling status request
2021-01-08 13:03:36.954316 (Thread-7): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f2467c0>]}
2021-01-08 13:03:36.957613 (Thread-7): sending response (<Response 10103 bytes [200 OK]>) to 10.0.14.17
2021-01-08 13:03:37.451965 (Thread-8): handling compile_sql request
2021-01-08 13:03:37.452365 (Thread-8): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f2468b0>]}
2021-01-08 13:03:38.340008 (Thread-8): sending response (<Response 138 bytes [200 OK]>) to 10.0.35.111
2021-01-08 13:03:38.356916 (MainThread): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-08 13:03:38.374242 (MainThread): Found 5 models, 0 tests, 0 snapshots, 0 analyses, 163 macros, 0 operations, 0 seed files, 0 sources
2021-01-08 13:03:38.374684 (Thread-1): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-08 13:03:38.374787 (Thread-1): Compiling rpc.my_new_project.request
2021-01-08 13:03:38.421873 (Thread-1): finished collecting timing info
2021-01-08 13:03:38.422129 (Thread-1): finished collecting timing info
2021-01-08 13:03:38.782871 (Thread-9): handling poll request
2021-01-08 13:03:38.783313 (Thread-9): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6fcdd100>]}
2021-01-08 13:03:38.787641 (Thread-9): sending response (<Response 4814 bytes [200 OK]>) to 10.0.2.160
2021-01-08 13:03:51.373951 (Thread-10): handling status request
2021-01-08 13:03:51.374417 (Thread-10): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f2468e0>]}
2021-01-08 13:03:51.378122 (Thread-10): sending response (<Response 10103 bytes [200 OK]>) to 10.0.32.130
2021-01-08 13:03:51.838229 (Thread-11): handling run_sql request
2021-01-08 13:03:51.838637 (Thread-11): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6fff5b50>]}
2021-01-08 13:03:52.764534 (Thread-11): sending response (<Response 138 bytes [200 OK]>) to 10.0.43.37
2021-01-08 13:03:52.782754 (MainThread): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-08 13:03:52.800473 (MainThread): Found 5 models, 0 tests, 0 snapshots, 0 analyses, 163 macros, 0 operations, 0 seed files, 0 sources
2021-01-08 13:03:52.800975 (Thread-1): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-08 13:03:52.801077 (Thread-1): Compiling rpc.my_new_project.request
2021-01-08 13:03:52.845365 (Thread-1): finished collecting timing info
2021-01-08 13:03:52.845626 (Thread-1): Using redshift connection "rpc.my_new_project.request".
2021-01-08 13:03:52.845682 (Thread-1): On rpc.my_new_project.request: CREATE TABLE wns_nm_DD_TT_UCID_REFTABLE AS (
	SELECT perm_ucid_hashed as ucid, SUBSCRIBER_KEY,CUSTOMER_NO,'CARDS' AS CARD_TYPE
	FROM DEVELOPMENT.DIM_CUSTOMER_CARD_MAPPING
	GROUP BY 1,2,3,4) ;

2021-01-08 13:03:52.845736 (Thread-1): Opening a new connection, currently in state init
2021-01-08 13:03:52.845775 (Thread-1): Connecting to Redshift using 'database' credentials
2021-01-08 13:03:53.193900 (Thread-12): handling poll request
2021-01-08 13:03:53.194374 (Thread-12): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f3acfd0>]}
2021-01-08 13:03:53.196416 (Thread-12): sending response (<Response 3314 bytes [200 OK]>) to 10.0.15.240
2021-01-08 13:03:53.752828 (Thread-1): SQL status: SELECT in 0.91 seconds
2021-01-08 13:03:53.753063 (Thread-1): finished collecting timing info
2021-01-08 13:03:53.753311 (Thread-1): On rpc.my_new_project.request: Close
2021-01-08 13:03:54.646087 (Thread-13): handling poll request
2021-01-08 13:03:54.646534 (Thread-13): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f4837c0>]}
2021-01-08 13:03:54.650359 (Thread-13): sending response (<Response 3787 bytes [200 OK]>) to 10.0.35.111
2021-01-08 13:05:13.996496 (Thread-14): handling status request
2021-01-08 13:05:13.998960 (Thread-14): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6fff5fd0>]}
2021-01-08 13:05:14.004783 (Thread-14): sending response (<Response 10103 bytes [200 OK]>) to 10.0.15.240
2021-01-08 13:05:14.436340 (Thread-15): handling compile_sql request
2021-01-08 13:05:14.436887 (Thread-15): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6fcd36d0>]}
2021-01-08 13:05:15.394218 (Thread-15): sending response (<Response 138 bytes [200 OK]>) to 10.0.43.37
2021-01-08 13:05:15.411493 (MainThread): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-08 13:05:15.431756 (MainThread): Found 5 models, 0 tests, 0 snapshots, 0 analyses, 163 macros, 0 operations, 0 seed files, 0 sources
2021-01-08 13:05:15.432231 (Thread-1): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-08 13:05:15.432373 (Thread-1): Compiling rpc.my_new_project.request
2021-01-08 13:05:15.479967 (Thread-1): finished collecting timing info
2021-01-08 13:05:15.480194 (Thread-1): finished collecting timing info
2021-01-08 13:05:15.826803 (Thread-16): handling poll request
2021-01-08 13:05:15.827258 (Thread-16): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6fcd35e0>]}
2021-01-08 13:05:15.831481 (Thread-16): sending response (<Response 4815 bytes [200 OK]>) to 10.0.15.240
2021-01-08 13:13:04.810403 (Thread-17): handling status request
2021-01-08 13:13:04.812374 (Thread-17): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f3acdf0>]}
2021-01-08 13:13:04.815940 (Thread-17): sending response (<Response 10103 bytes [200 OK]>) to 10.0.30.244
2021-01-08 13:13:05.224318 (Thread-18): handling compile_sql request
2021-01-08 13:13:05.224738 (Thread-18): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f317fd0>]}
2021-01-08 13:13:06.078342 (Thread-18): sending response (<Response 138 bytes [200 OK]>) to 10.0.31.102
2021-01-08 13:13:06.094560 (MainThread): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-08 13:13:06.114668 (MainThread): Found 5 models, 0 tests, 0 snapshots, 0 analyses, 163 macros, 0 operations, 0 seed files, 0 sources
2021-01-08 13:13:06.115171 (Thread-1): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-08 13:13:06.115276 (Thread-1): Compiling rpc.my_new_project.request
2021-01-08 13:13:06.166272 (Thread-1): finished collecting timing info
2021-01-08 13:13:06.166765 (Thread-1): finished collecting timing info
2021-01-08 13:13:06.533016 (Thread-19): handling poll request
2021-01-08 13:13:06.533475 (Thread-19): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f3171f0>]}
2021-01-08 13:13:06.538105 (Thread-19): sending response (<Response 4595 bytes [200 OK]>) to 10.0.30.244
2021-01-08 13:38:28.417608 (Thread-20): Got an acceptable cached parse result
2021-01-08 13:38:28.458961 (Thread-20): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE".
2021-01-08 13:38:29.763242 (Thread-21): handling status request
2021-01-08 13:38:29.763671 (Thread-21): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f329100>]}
2021-01-08 13:38:29.764621 (Thread-21): sending response (<Response 764 bytes [200 OK]>) to 10.0.14.17
2021-01-08 13:38:54.754003 (MainThread): Connection 'model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE' was properly closed.
2021-01-08 13:38:54.814326 (Thread-22): Got an acceptable cached parse result
2021-01-08 13:38:54.858698 (Thread-22): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_INFO".
2021-01-08 13:38:55.684224 (Thread-23): handling status request
2021-01-08 13:38:55.684650 (Thread-23): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f393460>]}
2021-01-08 13:38:55.685558 (Thread-23): sending response (<Response 761 bytes [200 OK]>) to 10.0.40.118
2021-01-08 13:39:54.575712 (MainThread): Connection 'model.my_new_project.wns_nm_DD_UCID_HHI_INFO' was properly closed.
2021-01-08 13:39:54.642120 (Thread-24): Got an acceptable cached parse result
2021-01-08 13:39:54.700658 (Thread-24): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1".
2021-01-08 13:39:54.999223 (Thread-25): handling status request
2021-01-08 13:39:54.999677 (Thread-25): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e3dc5b0>]}
2021-01-08 13:39:55.000670 (Thread-25): sending response (<Response 767 bytes [200 OK]>) to 10.0.32.130
2021-01-08 13:40:32.556826 (MainThread): Connection 'model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1' was properly closed.
2021-01-08 13:40:32.618468 (Thread-26): Got an acceptable cached parse result
2021-01-08 13:40:32.654796 (Thread-26): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_DEMOGOG_STAGING".
2021-01-08 13:40:33.734931 (Thread-27): handling status request
2021-01-08 13:40:33.735416 (Thread-27): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e3d8610>]}
2021-01-08 13:40:33.736310 (Thread-27): sending response (<Response 763 bytes [200 OK]>) to 10.0.40.118
2021-01-08 13:40:57.207523 (MainThread): Connection 'model.my_new_project.wns_nm_DD_DEMOGOG_STAGING' was properly closed.
2021-01-08 13:40:57.273426 (Thread-28): Got an acceptable cached parse result
2021-01-08 13:40:57.432931 (Thread-28): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2".
2021-01-08 13:40:57.591100 (Thread-29): handling status request
2021-01-08 13:40:57.591491 (Thread-29): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e37bb50>]}
2021-01-08 13:40:57.592182 (Thread-29): sending response (<Response 185 bytes [200 OK]>) to 10.0.17.213
2021-01-08 13:40:59.010961 (Thread-30): handling status request
2021-01-08 13:40:59.011374 (Thread-30): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f27ae20>]}
2021-01-08 13:40:59.012234 (Thread-30): sending response (<Response 769 bytes [200 OK]>) to 10.0.31.102
2021-01-08 13:41:56.823231 (MainThread): Connection 'model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2' was properly closed.
2021-01-08 13:41:56.884561 (Thread-31): Got an acceptable cached parse result
2021-01-08 13:41:56.935377 (Thread-31): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2".
2021-01-08 13:41:57.278643 (Thread-32): handling status request
2021-01-08 13:41:57.279080 (Thread-32): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f2d6f40>]}
2021-01-08 13:41:57.280003 (Thread-32): sending response (<Response 767 bytes [200 OK]>) to 10.0.30.244
2021-01-08 13:42:19.421377 (MainThread): Connection 'model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2' was properly closed.
2021-01-08 13:42:19.486099 (Thread-33): Got an acceptable cached parse result
2021-01-08 13:42:19.632196 (Thread-33): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3".
2021-01-08 13:42:19.842750 (Thread-34): handling status request
2021-01-08 13:42:19.843173 (Thread-34): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f40a2e0>]}
2021-01-08 13:42:19.843906 (Thread-34): sending response (<Response 185 bytes [200 OK]>) to 10.0.15.240
2021-01-08 13:42:21.285537 (Thread-35): handling status request
2021-01-08 13:42:21.286019 (Thread-35): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f1a6be0>]}
2021-01-08 13:42:21.286936 (Thread-35): sending response (<Response 767 bytes [200 OK]>) to 10.0.43.37
2021-01-08 13:43:20.129237 (MainThread): Connection 'model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3' was properly closed.
2021-01-08 13:43:20.194615 (Thread-36): Got an acceptable cached parse result
2021-01-08 13:43:20.279985 (Thread-36): Acquiring new redshift connection "model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO".
2021-01-08 13:43:21.771580 (Thread-37): handling status request
2021-01-08 13:43:21.772046 (Thread-37): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f338130>]}
2021-01-08 13:43:21.772966 (Thread-37): sending response (<Response 765 bytes [200 OK]>) to 10.0.31.102
2021-01-08 13:45:28.504001 (MainThread): Connection 'model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO' was properly closed.
2021-01-08 13:45:28.676699 (Thread-38): Got an acceptable cached parse result
2021-01-08 13:45:28.715400 (Thread-38): Acquiring new redshift connection "model.my_new_project.foobar-script-a".
2021-01-08 13:45:30.911749 (Thread-39): handling status request
2021-01-08 13:45:30.912157 (Thread-39): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f27a970>]}
2021-01-08 13:45:30.936864 (Thread-39): sending response (<Response 753 bytes [200 OK]>) to 10.0.35.111
2021-01-08 13:59:43.882486 (MainThread): Connection 'model.my_new_project.foobar-script-a' was properly closed.
2021-01-08 13:59:43.946909 (Thread-40): Got an acceptable cached parse result
2021-01-08 13:59:43.997904 (Thread-40): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE".
2021-01-08 13:59:44.977998 (Thread-41): handling status request
2021-01-08 13:59:44.978445 (Thread-41): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d75130ee0>]}
2021-01-08 13:59:44.979326 (Thread-41): sending response (<Response 764 bytes [200 OK]>) to 10.0.14.17
2021-01-08 13:59:56.377799 (MainThread): Connection 'model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE' was properly closed.
2021-01-08 13:59:56.437919 (Thread-42): Got an acceptable cached parse result
2021-01-08 13:59:56.498838 (Thread-42): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_INFO".
2021-01-08 13:59:56.818851 (Thread-43): handling status request
2021-01-08 13:59:56.819249 (Thread-43): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e438100>]}
2021-01-08 13:59:56.820116 (Thread-43): sending response (<Response 761 bytes [200 OK]>) to 10.0.43.37
2021-01-08 14:00:04.721978 (MainThread): Connection 'model.my_new_project.wns_nm_DD_UCID_HHI_INFO' was properly closed.
2021-01-08 14:00:04.779667 (Thread-44): Got an acceptable cached parse result
2021-01-08 14:00:04.855633 (Thread-44): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1".
2021-01-08 14:00:05.151728 (Thread-45): handling status request
2021-01-08 14:00:05.152208 (Thread-45): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e430f40>]}
2021-01-08 14:00:05.153233 (Thread-45): sending response (<Response 767 bytes [200 OK]>) to 10.0.31.102
2021-01-08 14:00:13.961370 (MainThread): Connection 'model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1' was properly closed.
2021-01-08 14:00:14.031451 (Thread-46): Got an acceptable cached parse result
2021-01-08 14:00:14.229902 (Thread-46): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_DEMOGOG_STAGING".
2021-01-08 14:00:14.434261 (Thread-47): handling status request
2021-01-08 14:00:14.434691 (Thread-47): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e403550>]}
2021-01-08 14:00:14.435426 (Thread-47): sending response (<Response 185 bytes [200 OK]>) to 10.0.17.213
2021-01-08 14:00:15.858289 (Thread-48): handling status request
2021-01-08 14:00:15.858761 (Thread-48): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e502e80>]}
2021-01-08 14:00:15.860097 (Thread-48): sending response (<Response 763 bytes [200 OK]>) to 10.0.30.244
2021-01-08 14:00:19.372229 (MainThread): Connection 'model.my_new_project.wns_nm_DD_DEMOGOG_STAGING' was properly closed.
2021-01-08 14:00:19.442405 (Thread-49): Got an acceptable cached parse result
2021-01-08 14:00:19.501107 (Thread-49): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2".
2021-01-08 14:00:19.848475 (Thread-50): handling status request
2021-01-08 14:00:19.848903 (Thread-50): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e6d1070>]}
2021-01-08 14:00:19.849808 (Thread-50): sending response (<Response 769 bytes [200 OK]>) to 10.0.40.118
2021-01-08 14:00:23.323188 (MainThread): Connection 'model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2' was properly closed.
2021-01-08 14:00:23.385929 (Thread-51): Got an acceptable cached parse result
2021-01-08 14:00:23.557885 (Thread-51): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2".
2021-01-08 14:00:23.734662 (Thread-52): handling status request
2021-01-08 14:00:23.735113 (Thread-52): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e31e0d0>]}
2021-01-08 14:00:23.735855 (Thread-52): sending response (<Response 185 bytes [200 OK]>) to 10.0.31.102
2021-01-08 14:00:25.167124 (Thread-53): handling status request
2021-01-08 14:00:25.167586 (Thread-53): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e309070>]}
2021-01-08 14:00:25.168600 (Thread-53): sending response (<Response 767 bytes [200 OK]>) to 10.0.31.102
2021-01-08 14:00:28.764188 (MainThread): Connection 'model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2' was properly closed.
2021-01-08 14:00:28.829375 (Thread-54): Got an acceptable cached parse result
2021-01-08 14:00:28.865319 (Thread-54): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3".
2021-01-08 14:00:29.220210 (Thread-55): handling status request
2021-01-08 14:00:29.220703 (Thread-55): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f17dd00>]}
2021-01-08 14:00:29.221631 (Thread-55): sending response (<Response 767 bytes [200 OK]>) to 10.0.32.130
2021-01-08 14:00:32.654650 (MainThread): Connection 'model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3' was properly closed.
2021-01-08 14:00:32.727204 (Thread-56): Got an acceptable cached parse result
2021-01-08 14:00:32.900343 (Thread-56): Acquiring new redshift connection "model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO".
2021-01-08 14:00:33.190854 (Thread-57): handling status request
2021-01-08 14:00:33.191289 (Thread-57): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e6fa790>]}
2021-01-08 14:00:33.192268 (Thread-57): sending response (<Response 765 bytes [200 OK]>) to 10.0.2.160
2021-01-08 14:01:50.980925 (MainThread): Connection 'model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO' was properly closed.
2021-01-08 14:01:51.072361 (Thread-58): Got an acceptable cached parse result
2021-01-08 14:01:51.125965 (Thread-58): Acquiring new redshift connection "model.my_new_project.foobar-script-a".
2021-01-08 14:01:52.009584 (Thread-59): handling status request
2021-01-08 14:01:52.010172 (Thread-59): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e2a8430>]}
2021-01-08 14:01:52.011516 (Thread-59): sending response (<Response 753 bytes [200 OK]>) to 10.0.2.160
2021-01-08 14:09:13.410052 (MainThread): Connection 'model.my_new_project.foobar-script-a' was properly closed.
2021-01-08 14:09:13.474705 (Thread-60): Got an acceptable cached parse result
2021-01-08 14:09:13.614369 (Thread-60): Acquiring new redshift connection "model.my_new_project.foobar-script-a".
2021-01-08 14:09:14.439033 (Thread-61): handling status request
2021-01-08 14:09:14.439473 (Thread-61): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f21fd60>]}
2021-01-08 14:09:14.440365 (Thread-61): sending response (<Response 753 bytes [200 OK]>) to 10.0.22.169
2021-01-08 14:09:23.329684 (Thread-62): handling status request
2021-01-08 14:09:23.330120 (Thread-62): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f21fbe0>]}
2021-01-08 14:09:23.331189 (Thread-62): sending response (<Response 753 bytes [200 OK]>) to 10.0.22.169
2021-01-08 14:09:23.376017 (Thread-63): handling status request
2021-01-08 14:09:23.376392 (Thread-63): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f21fd90>]}
2021-01-08 14:09:23.377461 (Thread-63): sending response (<Response 753 bytes [200 OK]>) to 10.0.43.37
2021-01-08 14:09:23.753168 (Thread-64): handling cli_args request
2021-01-08 14:09:23.753582 (Thread-64): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f21fd00>]}
2021-01-08 14:09:23.764662 (Thread-64): Connection 'model.my_new_project.foobar-script-a' was properly closed.
2021-01-08 14:09:24.613711 (Thread-64): sending response (<Response 138 bytes [200 OK]>) to 10.0.31.102
2021-01-08 14:09:24.675366 (MainThread): Partial parsing not enabled
2021-01-08 14:09:24.677784 (MainThread): Parsing macros/relations.sql
2021-01-08 14:09:24.678757 (MainThread): Parsing macros/adapters.sql
2021-01-08 14:09:24.705886 (MainThread): Parsing macros/catalog.sql
2021-01-08 14:09:24.718556 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2021-01-08 14:09:24.719541 (MainThread): Parsing macros/relations.sql
2021-01-08 14:09:24.721062 (MainThread): Parsing macros/adapters.sql
2021-01-08 14:09:24.770933 (MainThread): Parsing macros/catalog.sql
2021-01-08 14:09:24.773387 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2021-01-08 14:09:24.776066 (MainThread): Parsing macros/core.sql
2021-01-08 14:09:24.779639 (MainThread): Parsing macros/adapters/common.sql
2021-01-08 14:09:24.821222 (MainThread): Parsing macros/materializations/helpers.sql
2021-01-08 14:09:24.829801 (MainThread): Parsing macros/materializations/table/table.sql
2021-01-08 14:09:24.836385 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-01-08 14:09:24.856103 (MainThread): Parsing macros/materializations/view/view.sql
2021-01-08 14:09:24.862092 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-01-08 14:09:24.866831 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-01-08 14:09:24.868627 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-01-08 14:09:24.874510 (MainThread): Parsing macros/materializations/common/merge.sql
2021-01-08 14:09:24.888368 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-01-08 14:09:24.904397 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-01-08 14:09:24.906303 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-01-08 14:09:24.933872 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-01-08 14:09:24.935857 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-01-08 14:09:24.937418 (MainThread): Parsing macros/schema_tests/unique.sql
2021-01-08 14:09:24.939150 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-01-08 14:09:24.941765 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-01-08 14:09:24.943450 (MainThread): Parsing macros/etc/query.sql
2021-01-08 14:09:24.944507 (MainThread): Parsing macros/etc/datetime.sql
2021-01-08 14:09:24.952921 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-01-08 14:09:24.953921 (MainThread): Parsing macros/etc/is_incremental.sql
2021-01-08 14:09:24.955545 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-01-08 14:09:24.966390 (MainThread): Partial parsing not enabled
2021-01-08 14:09:25.007767 (MainThread): Acquiring new redshift connection "model.my_new_project.foobar-script-a".
2021-01-08 14:09:25.031417 (MainThread): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3".
2021-01-08 14:09:25.040338 (Thread-65): handling poll request
2021-01-08 14:09:25.040762 (Thread-65): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f4655b0>]}
2021-01-08 14:09:25.044596 (Thread-65): sending response (<Response 9936 bytes [200 OK]>) to 10.0.37.69
2021-01-08 14:09:25.043815 (MainThread): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_DEMOGOG_STAGING".
2021-01-08 14:09:25.056787 (MainThread): Acquiring new redshift connection "model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO".
2021-01-08 14:09:25.069557 (MainThread): Acquiring new redshift connection "model.my_new_project.top_nations".
2021-01-08 14:09:25.084966 (MainThread): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE".
2021-01-08 14:09:25.097616 (MainThread): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2".
2021-01-08 14:09:25.112434 (MainThread): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2".
2021-01-08 14:09:25.125295 (MainThread): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_INFO".
2021-01-08 14:09:25.138747 (MainThread): Acquiring new redshift connection "model.my_new_project.bar_table_test_cbt".
2021-01-08 14:09:25.155107 (MainThread): Acquiring new redshift connection "model.my_new_project.top_customers_rs".
2021-01-08 14:09:25.175136 (MainThread): Acquiring new redshift connection "model.my_new_project.top_customers".
2021-01-08 14:09:25.189295 (MainThread): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1".
2021-01-08 14:09:25.202255 (MainThread): Acquiring new redshift connection "model.my_new_project.mycustom".
2021-01-08 14:09:25.423497 (MainThread): Found 14 models, 0 tests, 0 snapshots, 0 analyses, 163 macros, 0 operations, 0 seed files, 0 sources
2021-01-08 14:09:25.424417 (MainThread): 
2021-01-08 14:09:25.424715 (MainThread): Acquiring new redshift connection "master".
2021-01-08 14:09:25.439978 (ThreadPoolExecutor-0_0): Acquiring new redshift connection "list_dev".
2021-01-08 14:09:25.450827 (ThreadPoolExecutor-0_0): Using redshift connection "list_dev".
2021-01-08 14:09:25.450952 (ThreadPoolExecutor-0_0): On list_dev: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "connection_name": "list_dev"} */

    select distinct nspname from pg_namespace
  
2021-01-08 14:09:25.451026 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-01-08 14:09:25.451072 (ThreadPoolExecutor-0_0): Connecting to Redshift using 'database' credentials
2021-01-08 14:09:26.068204 (ThreadPoolExecutor-0_0): SQL status: SELECT in 0.62 seconds
2021-01-08 14:09:26.070601 (ThreadPoolExecutor-0_0): On list_dev: Close
2021-01-08 14:09:26.086060 (ThreadPoolExecutor-1_0): Acquiring new redshift connection "list_dev_development".
2021-01-08 14:09:26.093392 (ThreadPoolExecutor-1_0): Using redshift connection "list_dev_development".
2021-01-08 14:09:26.093464 (ThreadPoolExecutor-1_0): On list_dev_development: BEGIN
2021-01-08 14:09:26.093520 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-01-08 14:09:26.093560 (ThreadPoolExecutor-1_0): Connecting to Redshift using 'database' credentials
2021-01-08 14:09:26.480604 (Thread-66): handling poll request
2021-01-08 14:09:26.481037 (Thread-66): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f465c10>]}
2021-01-08 14:09:26.483837 (Thread-66): sending response (<Response 8566 bytes [200 OK]>) to 10.0.14.17
2021-01-08 14:09:26.711680 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.62 seconds
2021-01-08 14:09:26.711878 (ThreadPoolExecutor-1_0): Using redshift connection "list_dev_development".
2021-01-08 14:09:26.711949 (ThreadPoolExecutor-1_0): On list_dev_development: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "connection_name": "list_dev_development"} */
select
      'dev' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'development'
    union all
    select
      'dev' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'development'
  
2021-01-08 14:09:26.790478 (ThreadPoolExecutor-1_0): SQL status: SELECT in 0.08 seconds
2021-01-08 14:09:26.841670 (ThreadPoolExecutor-1_0): On list_dev_development: ROLLBACK
2021-01-08 14:09:26.910634 (ThreadPoolExecutor-1_0): On list_dev_development: Close
2021-01-08 14:09:26.929994 (MainThread): Using redshift connection "master".
2021-01-08 14:09:26.930095 (MainThread): On master: BEGIN
2021-01-08 14:09:26.930153 (MainThread): Opening a new connection, currently in state init
2021-01-08 14:09:26.930215 (MainThread): Connecting to Redshift using 'database' credentials
2021-01-08 14:09:27.548131 (MainThread): SQL status: BEGIN in 0.62 seconds
2021-01-08 14:09:27.548283 (MainThread): Using redshift connection "master".
2021-01-08 14:09:27.548336 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2021-01-08 14:09:27.640768 (MainThread): SQL status: SELECT in 0.09 seconds
2021-01-08 14:09:27.641107 (MainThread): On master: ROLLBACK
2021-01-08 14:09:27.709812 (MainThread): Using redshift connection "master".
2021-01-08 14:09:27.709965 (MainThread): On master: BEGIN
2021-01-08 14:09:27.847345 (MainThread): SQL status: BEGIN in 0.14 seconds
2021-01-08 14:09:27.847521 (MainThread): On master: COMMIT
2021-01-08 14:09:27.847570 (MainThread): Using redshift connection "master".
2021-01-08 14:09:27.847616 (MainThread): On master: COMMIT
2021-01-08 14:09:27.899037 (Thread-67): handling poll request
2021-01-08 14:09:27.899433 (Thread-67): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e57b1f0>]}
2021-01-08 14:09:27.901787 (Thread-67): sending response (<Response 8836 bytes [200 OK]>) to 10.0.31.102
2021-01-08 14:09:27.916342 (MainThread): SQL status: COMMIT in 0.07 seconds
2021-01-08 14:09:27.916512 (MainThread): On master: Close
2021-01-08 14:09:27.916996 (MainThread): 14:09:27 | Concurrency: 1 threads (target='default')
2021-01-08 14:09:27.917092 (MainThread): 14:09:27 | 
2021-01-08 14:09:27.919311 (Thread-1): Began running node model.my_new_project.top_customers
2021-01-08 14:09:27.920329 (Thread-1): 14:09:27 | 1 of 14 START table model development.top_customers.................. [RUN]
2021-01-08 14:09:27.920579 (Thread-1): Acquiring new redshift connection "model.my_new_project.top_customers".
2021-01-08 14:09:27.920657 (Thread-1): Compiling model.my_new_project.top_customers
2021-01-08 14:09:27.934239 (Thread-1): Writing injected SQL for node "model.my_new_project.top_customers"
2021-01-08 14:09:27.974386 (Thread-1): finished collecting timing info
2021-01-08 14:09:27.990717 (Thread-1): Using redshift connection "model.my_new_project.top_customers".
2021-01-08 14:09:27.990843 (Thread-1): On model.my_new_project.top_customers: BEGIN
2021-01-08 14:09:27.990909 (Thread-1): Opening a new connection, currently in state closed
2021-01-08 14:09:27.990953 (Thread-1): Connecting to Redshift using 'database' credentials
2021-01-08 14:09:28.609281 (Thread-1): SQL status: BEGIN in 0.62 seconds
2021-01-08 14:09:28.614369 (Thread-1): Using redshift connection "model.my_new_project.top_customers".
2021-01-08 14:09:28.614465 (Thread-1): On model.my_new_project.top_customers: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.top_customers"} */
drop table if exists "dev"."development"."top_customers__dbt_tmp" cascade
2021-01-08 14:09:28.683896 (Thread-1): SQL status: DROP TABLE in 0.07 seconds
2021-01-08 14:09:28.684743 (Thread-1): On model.my_new_project.top_customers: COMMIT
2021-01-08 14:09:28.684827 (Thread-1): Using redshift connection "model.my_new_project.top_customers".
2021-01-08 14:09:28.684872 (Thread-1): On model.my_new_project.top_customers: COMMIT
2021-01-08 14:09:28.756068 (Thread-1): SQL status: COMMIT in 0.07 seconds
2021-01-08 14:09:28.756234 (Thread-1): Using redshift connection "model.my_new_project.top_customers".
2021-01-08 14:09:28.756286 (Thread-1): On model.my_new_project.top_customers: BEGIN
2021-01-08 14:09:28.825046 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:09:28.825275 (Thread-1): On model.my_new_project.top_customers: COMMIT
2021-01-08 14:09:28.825328 (Thread-1): Using redshift connection "model.my_new_project.top_customers".
2021-01-08 14:09:28.825370 (Thread-1): On model.my_new_project.top_customers: COMMIT
2021-01-08 14:09:28.893869 (Thread-1): SQL status: COMMIT in 0.07 seconds
2021-01-08 14:09:28.894010 (Thread-1): Using redshift connection "model.my_new_project.top_customers".
2021-01-08 14:09:28.894058 (Thread-1): On model.my_new_project.top_customers: BEGIN
2021-01-08 14:09:28.962819 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:09:28.964790 (Thread-1): Using redshift connection "model.my_new_project.top_customers".
2021-01-08 14:09:28.964918 (Thread-1): On model.my_new_project.top_customers: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.top_customers"} */
drop table if exists "dev"."development"."top_customers__dbt_backup" cascade
2021-01-08 14:09:29.033736 (Thread-1): SQL status: DROP TABLE in 0.07 seconds
2021-01-08 14:09:29.034609 (Thread-1): On model.my_new_project.top_customers: COMMIT
2021-01-08 14:09:29.034702 (Thread-1): Using redshift connection "model.my_new_project.top_customers".
2021-01-08 14:09:29.034749 (Thread-1): On model.my_new_project.top_customers: COMMIT
2021-01-08 14:09:29.105745 (Thread-1): SQL status: COMMIT in 0.07 seconds
2021-01-08 14:09:29.105919 (Thread-1): Using redshift connection "model.my_new_project.top_customers".
2021-01-08 14:09:29.105969 (Thread-1): On model.my_new_project.top_customers: BEGIN
2021-01-08 14:09:29.175281 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:09:29.201534 (Thread-1): Writing runtime SQL for node "model.my_new_project.top_customers"
2021-01-08 14:09:29.241536 (Thread-1): Using redshift connection "model.my_new_project.top_customers".
2021-01-08 14:09:29.241720 (Thread-1): On model.my_new_project.top_customers: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.top_customers"} */


  create  table
    "dev"."development"."top_customers__dbt_tmp"
    
    
  as (
    /* 
   Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
   SPDX-License-Identifier: MIT-0
*/


/*
    Find top 100 customers with the most number of orders
*/



select c_custkey, c_nationkey, count(*) total_order
from customer c left join orders o on c.c_custkey = o.o_custkey
group by c_custkey, c_nationkey
order by total_order desc
limit 100
  );
2021-01-08 14:09:29.323844 (Thread-68): handling poll request
2021-01-08 14:09:29.324425 (Thread-68): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e5820a0>]}
2021-01-08 14:09:29.329523 (Thread-68): sending response (<Response 16574 bytes [200 OK]>) to 10.0.37.69
2021-01-08 14:09:30.783230 (Thread-69): handling poll request
2021-01-08 14:09:30.783655 (Thread-69): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e582670>]}
2021-01-08 14:09:30.784508 (Thread-69): sending response (<Response 288 bytes [200 OK]>) to 10.0.14.17
2021-01-08 14:09:32.210961 (Thread-70): handling poll request
2021-01-08 14:09:32.211381 (Thread-70): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f4653d0>]}
2021-01-08 14:09:32.212284 (Thread-70): sending response (<Response 288 bytes [200 OK]>) to 10.0.9.152
2021-01-08 14:09:33.636462 (Thread-71): handling poll request
2021-01-08 14:09:33.636872 (Thread-71): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f433d90>]}
2021-01-08 14:09:33.637717 (Thread-71): sending response (<Response 288 bytes [200 OK]>) to 10.0.2.160
2021-01-08 14:09:35.057083 (Thread-72): handling poll request
2021-01-08 14:09:35.057553 (Thread-72): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e586220>]}
2021-01-08 14:09:35.058500 (Thread-72): sending response (<Response 289 bytes [200 OK]>) to 10.0.2.160
2021-01-08 14:09:36.813398 (Thread-73): handling poll request
2021-01-08 14:09:36.813845 (Thread-73): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f466dc0>]}
2021-01-08 14:09:36.814777 (Thread-73): sending response (<Response 289 bytes [200 OK]>) to 10.0.35.111
2021-01-08 14:09:38.254249 (Thread-74): handling poll request
2021-01-08 14:09:38.254660 (Thread-74): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f4661c0>]}
2021-01-08 14:09:38.255514 (Thread-74): sending response (<Response 289 bytes [200 OK]>) to 10.0.37.69
2021-01-08 14:09:39.857870 (Thread-75): handling poll request
2021-01-08 14:09:39.858316 (Thread-75): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f466850>]}
2021-01-08 14:09:39.859190 (Thread-75): sending response (<Response 289 bytes [200 OK]>) to 10.0.31.102
2021-01-08 14:09:41.301796 (Thread-76): handling poll request
2021-01-08 14:09:41.302238 (Thread-76): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f466700>]}
2021-01-08 14:09:41.303114 (Thread-76): sending response (<Response 288 bytes [200 OK]>) to 10.0.31.102
2021-01-08 14:09:42.810291 (Thread-77): handling poll request
2021-01-08 14:09:42.810709 (Thread-77): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f1bc3a0>]}
2021-01-08 14:09:42.811575 (Thread-77): sending response (<Response 289 bytes [200 OK]>) to 10.0.26.143
2021-01-08 14:09:44.241369 (Thread-78): handling poll request
2021-01-08 14:09:44.241814 (Thread-78): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f1bcc40>]}
2021-01-08 14:09:44.242743 (Thread-78): sending response (<Response 289 bytes [200 OK]>) to 10.0.17.213
2021-01-08 14:09:44.716558 (Thread-1): SQL status: SELECT in 15.47 seconds
2021-01-08 14:09:44.722870 (Thread-1): Using redshift connection "model.my_new_project.top_customers".
2021-01-08 14:09:44.722964 (Thread-1): On model.my_new_project.top_customers: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.top_customers"} */
alter table "dev"."development"."top_customers__dbt_tmp" rename to "top_customers"
2021-01-08 14:09:44.792235 (Thread-1): SQL status: ALTER TABLE in 0.07 seconds
2021-01-08 14:09:44.799444 (Thread-1): On model.my_new_project.top_customers: COMMIT
2021-01-08 14:09:44.799539 (Thread-1): Using redshift connection "model.my_new_project.top_customers".
2021-01-08 14:09:44.799584 (Thread-1): On model.my_new_project.top_customers: COMMIT
2021-01-08 14:09:44.901077 (Thread-1): SQL status: COMMIT in 0.10 seconds
2021-01-08 14:09:44.903025 (Thread-1): Using redshift connection "model.my_new_project.top_customers".
2021-01-08 14:09:44.903108 (Thread-1): On model.my_new_project.top_customers: BEGIN
2021-01-08 14:09:44.972100 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:09:44.973952 (Thread-1): Using redshift connection "model.my_new_project.top_customers".
2021-01-08 14:09:44.974023 (Thread-1): On model.my_new_project.top_customers: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.top_customers"} */
drop table if exists "dev"."development"."top_customers__dbt_backup" cascade
2021-01-08 14:09:45.042768 (Thread-1): SQL status: DROP TABLE in 0.07 seconds
2021-01-08 14:09:45.043599 (Thread-1): On model.my_new_project.top_customers: COMMIT
2021-01-08 14:09:45.043679 (Thread-1): Using redshift connection "model.my_new_project.top_customers".
2021-01-08 14:09:45.043726 (Thread-1): On model.my_new_project.top_customers: COMMIT
2021-01-08 14:09:45.114304 (Thread-1): SQL status: COMMIT in 0.07 seconds
2021-01-08 14:09:45.114464 (Thread-1): Using redshift connection "model.my_new_project.top_customers".
2021-01-08 14:09:45.114517 (Thread-1): On model.my_new_project.top_customers: BEGIN
2021-01-08 14:09:45.183391 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:09:45.185096 (Thread-1): finished collecting timing info
2021-01-08 14:09:45.185311 (Thread-1): On model.my_new_project.top_customers: ROLLBACK
2021-01-08 14:09:45.254004 (Thread-1): On model.my_new_project.top_customers: Close
2021-01-08 14:09:45.254842 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '21041e39-c71c-40f1-8a03-3dfd99b9104a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd33c30a400>]}
2021-01-08 14:09:45.255897 (Thread-1): 14:09:45 | 1 of 14 OK created table model development.top_customers............. [SELECT in 17.33s]
2021-01-08 14:09:45.255983 (Thread-1): Finished running node model.my_new_project.top_customers
2021-01-08 14:09:45.256088 (Thread-1): Began running node model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE
2021-01-08 14:09:45.256883 (Thread-1): 14:09:45 | 2 of 14 START view model development.wns_nm_DD_TT_UCID_REFTABLE...... [RUN]
2021-01-08 14:09:45.257091 (Thread-1): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE".
2021-01-08 14:09:45.257164 (Thread-1): Compiling model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE
2021-01-08 14:09:45.262228 (Thread-1): Writing injected SQL for node "model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE"
2021-01-08 14:09:45.274679 (Thread-1): finished collecting timing info
2021-01-08 14:09:45.289963 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE".
2021-01-08 14:09:45.290049 (Thread-1): On model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE: BEGIN
2021-01-08 14:09:45.290108 (Thread-1): Opening a new connection, currently in state closed
2021-01-08 14:09:45.290148 (Thread-1): Connecting to Redshift using 'database' credentials
2021-01-08 14:09:45.757902 (Thread-79): handling poll request
2021-01-08 14:09:45.758355 (Thread-79): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f1bc190>]}
2021-01-08 14:09:45.784985 (Thread-79): sending response (<Response 14190 bytes [200 OK]>) to 10.0.37.69
2021-01-08 14:09:45.903478 (Thread-1): SQL status: BEGIN in 0.61 seconds
2021-01-08 14:09:45.905410 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE".
2021-01-08 14:09:45.905499 (Thread-1): On model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE"} */
drop view if exists "dev"."development"."wns_nm_DD_TT_UCID_REFTABLE__dbt_tmp" cascade
2021-01-08 14:09:45.974109 (Thread-1): SQL status: DROP VIEW in 0.07 seconds
2021-01-08 14:09:45.974932 (Thread-1): On model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE: COMMIT
2021-01-08 14:09:45.975010 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE".
2021-01-08 14:09:45.975057 (Thread-1): On model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE: COMMIT
2021-01-08 14:09:46.069006 (Thread-1): SQL status: COMMIT in 0.09 seconds
2021-01-08 14:09:46.069179 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE".
2021-01-08 14:09:46.069232 (Thread-1): On model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE: BEGIN
2021-01-08 14:09:46.137641 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:09:46.137799 (Thread-1): On model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE: COMMIT
2021-01-08 14:09:46.137846 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE".
2021-01-08 14:09:46.137885 (Thread-1): On model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE: COMMIT
2021-01-08 14:09:46.206056 (Thread-1): SQL status: COMMIT in 0.07 seconds
2021-01-08 14:09:46.206231 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE".
2021-01-08 14:09:46.206284 (Thread-1): On model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE: BEGIN
2021-01-08 14:09:46.274648 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:09:46.276987 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE".
2021-01-08 14:09:46.277077 (Thread-1): On model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE"} */
drop view if exists "dev"."development"."wns_nm_DD_TT_UCID_REFTABLE__dbt_backup" cascade
2021-01-08 14:09:46.345307 (Thread-1): SQL status: DROP VIEW in 0.07 seconds
2021-01-08 14:09:46.346138 (Thread-1): On model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE: COMMIT
2021-01-08 14:09:46.346264 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE".
2021-01-08 14:09:46.346313 (Thread-1): On model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE: COMMIT
2021-01-08 14:09:46.429456 (Thread-1): SQL status: COMMIT in 0.08 seconds
2021-01-08 14:09:46.429627 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE".
2021-01-08 14:09:46.429692 (Thread-1): On model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE: BEGIN
2021-01-08 14:09:46.498029 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:09:46.502696 (Thread-1): Writing runtime SQL for node "model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE"
2021-01-08 14:09:46.515001 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE".
2021-01-08 14:09:46.515109 (Thread-1): On model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE"} */


  create view "dev"."development"."wns_nm_DD_TT_UCID_REFTABLE__dbt_tmp" as (
    CREATE TABLE wns_nm_DD_TT_UCID_REFTABLE AS (
	SELECT perm_ucid_hashed as ucid, SUBSCRIBER_KEY,CUSTOMER_NO,'CARDS' AS CARD_TYPE
	FROM DEVELOPMENT.DIM_CUSTOMER_CARD_MAPPING
	GROUP BY 1,2,3,4) ;
  ) ;

2021-01-08 14:09:46.583938 (Thread-1): Postgres error: syntax error at or near "CREATE"
LINE 5:     CREATE TABLE wns_nm_DD_TT_UCID_REFTABLE AS (
            ^

2021-01-08 14:09:46.584084 (Thread-1): On model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE: ROLLBACK
2021-01-08 14:09:46.652213 (Thread-1): finished collecting timing info
2021-01-08 14:09:46.652553 (Thread-1): On model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE: Close
2021-01-08 14:09:46.653124 (Thread-1): Database Error in model wns_nm_DD_TT_UCID_REFTABLE (models/example/wns_nm_DD_TT_UCID_REFTABLE.sql)
  syntax error at or near "CREATE"
  LINE 5:     CREATE TABLE wns_nm_DD_TT_UCID_REFTABLE AS (
              ^
  compiled SQL at target/run/my_new_project/models/example/wns_nm_DD_TT_UCID_REFTABLE.sql
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/postgres/connections.py", line 46, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 78, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.SyntaxError: syntax error at or near "CREATE"
LINE 5:     CREATE TABLE wns_nm_DD_TT_UCID_REFTABLE AS (
            ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 276, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 378, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/run.py", line 233, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 61, in macro
  File "/usr/local/lib/python3.8/dist-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/lib/python3.8/dist-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 224, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 123, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 86, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/postgres/connections.py", line 57, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model wns_nm_DD_TT_UCID_REFTABLE (models/example/wns_nm_DD_TT_UCID_REFTABLE.sql)
  syntax error at or near "CREATE"
  LINE 5:     CREATE TABLE wns_nm_DD_TT_UCID_REFTABLE AS (
              ^
  compiled SQL at target/run/my_new_project/models/example/wns_nm_DD_TT_UCID_REFTABLE.sql
2021-01-08 14:09:46.654913 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '21041e39-c71c-40f1-8a03-3dfd99b9104a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd33c315040>]}
2021-01-08 14:09:46.656560 (Thread-1): 14:09:46 | 2 of 14 ERROR creating view model development.wns_nm_DD_TT_UCID_REFTABLE [ERROR in 1.40s]
2021-01-08 14:09:46.656688 (Thread-1): Finished running node model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE
2021-01-08 14:09:46.656836 (Thread-1): Began running node model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO
2021-01-08 14:09:46.658170 (Thread-1): 14:09:46 | 3 of 14 START view model development.WNS_NM_SD_DIM_CUSTOMER_DEMO..... [RUN]
2021-01-08 14:09:46.658686 (Thread-1): Acquiring new redshift connection "model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO".
2021-01-08 14:09:46.658800 (Thread-1): Compiling model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO
2021-01-08 14:09:46.667559 (Thread-1): Writing injected SQL for node "model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO"
2021-01-08 14:09:46.679642 (Thread-1): finished collecting timing info
2021-01-08 14:09:46.685354 (Thread-1): Using redshift connection "model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO".
2021-01-08 14:09:46.685445 (Thread-1): On model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO: BEGIN
2021-01-08 14:09:46.685506 (Thread-1): Opening a new connection, currently in state closed
2021-01-08 14:09:46.685548 (Thread-1): Connecting to Redshift using 'database' credentials
2021-01-08 14:09:47.284818 (Thread-80): handling poll request
2021-01-08 14:09:47.285224 (Thread-80): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f466250>]}
2021-01-08 14:09:47.290061 (Thread-80): sending response (<Response 24073 bytes [200 OK]>) to 10.0.35.111
2021-01-08 14:09:47.330019 (Thread-1): SQL status: BEGIN in 0.64 seconds
2021-01-08 14:09:47.331917 (Thread-1): Using redshift connection "model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO".
2021-01-08 14:09:47.332122 (Thread-1): On model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO"} */
drop view if exists "dev"."development"."WNS_NM_SD_DIM_CUSTOMER_DEMO__dbt_tmp" cascade
2021-01-08 14:09:47.404185 (Thread-1): SQL status: DROP VIEW in 0.07 seconds
2021-01-08 14:09:47.405079 (Thread-1): On model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO: COMMIT
2021-01-08 14:09:47.405167 (Thread-1): Using redshift connection "model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO".
2021-01-08 14:09:47.405215 (Thread-1): On model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO: COMMIT
2021-01-08 14:09:47.502809 (Thread-1): SQL status: COMMIT in 0.10 seconds
2021-01-08 14:09:47.502972 (Thread-1): Using redshift connection "model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO".
2021-01-08 14:09:47.503022 (Thread-1): On model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO: BEGIN
2021-01-08 14:09:47.574886 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:09:47.575086 (Thread-1): On model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO: COMMIT
2021-01-08 14:09:47.575138 (Thread-1): Using redshift connection "model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO".
2021-01-08 14:09:47.575181 (Thread-1): On model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO: COMMIT
2021-01-08 14:09:47.646780 (Thread-1): SQL status: COMMIT in 0.07 seconds
2021-01-08 14:09:47.646947 (Thread-1): Using redshift connection "model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO".
2021-01-08 14:09:47.646999 (Thread-1): On model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO: BEGIN
2021-01-08 14:09:47.718824 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:09:47.720659 (Thread-1): Using redshift connection "model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO".
2021-01-08 14:09:47.720747 (Thread-1): On model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO"} */
drop view if exists "dev"."development"."WNS_NM_SD_DIM_CUSTOMER_DEMO__dbt_backup" cascade
2021-01-08 14:09:47.793309 (Thread-1): SQL status: DROP VIEW in 0.07 seconds
2021-01-08 14:09:47.794148 (Thread-1): On model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO: COMMIT
2021-01-08 14:09:47.794254 (Thread-1): Using redshift connection "model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO".
2021-01-08 14:09:47.794302 (Thread-1): On model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO: COMMIT
2021-01-08 14:09:47.882035 (Thread-1): SQL status: COMMIT in 0.09 seconds
2021-01-08 14:09:47.882223 (Thread-1): Using redshift connection "model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO".
2021-01-08 14:09:47.882279 (Thread-1): On model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO: BEGIN
2021-01-08 14:09:47.954135 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:09:47.954817 (Thread-1): Writing runtime SQL for node "model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO"
2021-01-08 14:09:47.967600 (Thread-1): Using redshift connection "model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO".
2021-01-08 14:09:47.967761 (Thread-1): On model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO"} */


  create view "dev"."development"."WNS_NM_SD_DIM_CUSTOMER_DEMO__dbt_tmp" as (
    DROP TABLE IF EXISTS DEVELOPMENT.WNS_NM_SD_DIM_CUSTOMER_DEMO;
CREATE TABLE DEVELOPMENT.WNS_NM_SD_DIM_CUSTOMER_DEMO
	DISTSTYLE ALL AS
		SELECT UCID, CARD_TYPE, INCOME_CLASS, HOUSEHOLD_INCOME_SUBRANGE,DERIVED_RACE,
				BIRTH_DATE,AGE_YEARS,GENDER,INFO_CHANGED_DATE,CREATED_DATE
		FROM (
			SELECT UCID, CARD_TYPE, INCOME_CLASS, HOUSEHOLD_INCOME_SUBRANGE,DERIVED_RACE,
					BIRTH_DATE,AGE_DAYS,AGE_YEARS,GENDER,INFO_CHANGED_DATE,CREATED_DATE
			FROM (
				SELECT * FROM wns_nm_DD_UCID_HHI_DEMO_TEMP3 WHERE UCID IN (
					SELECT UCID FROM (
						SELECT UCID, COUNT(*)AS CNT
						FROM wns_nm_DD_UCID_HHI_DEMO_TEMP3
						GROUP BY 1)
					WHERE CNT=1) -- AND ( INCOME_CLASS IS NOT NULL )
				ORDER BY UCID,HOUSEHOLD_INCOME_SUBRANGE,DERIVED_RACE,BIRTH_DATE,
						AGE_DAYS,AGE_YEARS,GENDER,INFO_CHANGED_DATE,CREATED_DATE)
				UNION
				SELECT UCID, CARD_TYPE, INCOME_CLASS, HOUSEHOLD_INCOME_SUBRANGE,DERIVED_RACE,
						BIRTH_DATE,AGE_DAYS,AGE_YEARS,GENDER,INFO_CHANGED_DATE,CREATED_DATE
				FROM (
					SELECT UCID, CARD_TYPE, INCOME_CLASS, HOUSEHOLD_INCOME_SUBRANGE,DERIVED_RACE,
							BIRTH_DATE,AGE_DAYS,AGE_YEARS,GENDER,INFO_CHANGED_DATE,CREATED_DATE,
					ROW_NUMBER() OVER(PARTITION BY UCID ORDER BY INFO_CHANGED_DATE DESC,DERIVED_RACE DESC,AGE_DAYS ASC,GENDER ASC) AS RN
					FROM (
						SELECT * FROM wns_nm_DD_UCID_HHI_DEMO_TEMP3
						WHERE UCID IN (
							SELECT UCID FROM (
								SELECT UCID, COUNT(*)AS CNT
								FROM wns_nm_DD_UCID_HHI_DEMO_TEMP3
								GROUP BY 1)
							WHERE CNT>1) -- AND ( INCOME_CLASS IS NOT NULL )
						AND (INCOME_CLASS <>-1 AND INCOME_CLASS<>' ' AND INCOME_CLASS IS NOT NULL )
						ORDER BY UCID,HOUSEHOLD_INCOME_SUBRANGE,DERIVED_RACE,BIRTH_DATE,
								AGE_DAYS,AGE_YEARS,GENDER,INFO_CHANGED_DATE,CREATED_DATE))
				WHERE RN=1);
-- Execution time: 18.21s

DROP TABLE IF EXISTS wns_nm_DD_TT_UCID_REFTABLE;
DROP TABLE IF EXISTS wns_nm_DD_UCID_HHI_INFO;
DROP TABLE IF EXISTS wns_nm_DD_UCID_HHI_DEMO_TEMP1;
DROP TABLE IF EXISTS wns_nm_DD_DEMOGOG_STAGING;
DROP TABLE IF EXISTS wns_nm_DD_UCID_HHI_DEMO_TEMP1_2;
DROP TABLE IF EXISTS wns_nm_DD_UCID_HHI_DEMO_TEMP2;
DROP TABLE IF EXISTS wns_nm_DD_UCID_HHI_DEMO_TEMP3;
  ) ;

2021-01-08 14:09:48.041377 (Thread-1): Postgres error: syntax error at or near "DROP"
LINE 5:     DROP TABLE IF EXISTS DEVELOPMENT.WNS_NM_SD_DIM_CUSTOMER_...
            ^

2021-01-08 14:09:48.041583 (Thread-1): On model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO: ROLLBACK
2021-01-08 14:09:48.113138 (Thread-1): finished collecting timing info
2021-01-08 14:09:48.113460 (Thread-1): On model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO: Close
2021-01-08 14:09:48.113977 (Thread-1): Database Error in model WNS_NM_SD_DIM_CUSTOMER_DEMO (models/example/WNS_NM_SD_DIM_CUSTOMER_DEMO.sql)
  syntax error at or near "DROP"
  LINE 5:     DROP TABLE IF EXISTS DEVELOPMENT.WNS_NM_SD_DIM_CUSTOMER_...
              ^
  compiled SQL at target/run/my_new_project/models/example/WNS_NM_SD_DIM_CUSTOMER_DEMO.sql
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/postgres/connections.py", line 46, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 78, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.SyntaxError: syntax error at or near "DROP"
LINE 5:     DROP TABLE IF EXISTS DEVELOPMENT.WNS_NM_SD_DIM_CUSTOMER_...
            ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 276, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 378, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/run.py", line 233, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 61, in macro
  File "/usr/local/lib/python3.8/dist-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/lib/python3.8/dist-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 224, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 123, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 86, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/postgres/connections.py", line 57, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model WNS_NM_SD_DIM_CUSTOMER_DEMO (models/example/WNS_NM_SD_DIM_CUSTOMER_DEMO.sql)
  syntax error at or near "DROP"
  LINE 5:     DROP TABLE IF EXISTS DEVELOPMENT.WNS_NM_SD_DIM_CUSTOMER_...
              ^
  compiled SQL at target/run/my_new_project/models/example/WNS_NM_SD_DIM_CUSTOMER_DEMO.sql
2021-01-08 14:09:48.114643 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '21041e39-c71c-40f1-8a03-3dfd99b9104a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd33c32f4f0>]}
2021-01-08 14:09:48.115689 (Thread-1): 14:09:48 | 3 of 14 ERROR creating view model development.WNS_NM_SD_DIM_CUSTOMER_DEMO [ERROR in 1.46s]
2021-01-08 14:09:48.115771 (Thread-1): Finished running node model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO
2021-01-08 14:09:48.115874 (Thread-1): Began running node model.my_new_project.bar_table_test_cbt
2021-01-08 14:09:48.116646 (Thread-1): 14:09:48 | 4 of 14 START view model development.bar_table_test_cbt.............. [RUN]
2021-01-08 14:09:48.116872 (Thread-1): Acquiring new redshift connection "model.my_new_project.bar_table_test_cbt".
2021-01-08 14:09:48.116945 (Thread-1): Compiling model.my_new_project.bar_table_test_cbt
2021-01-08 14:09:48.125430 (Thread-1): Writing injected SQL for node "model.my_new_project.bar_table_test_cbt"
2021-01-08 14:09:48.154262 (Thread-1): finished collecting timing info
2021-01-08 14:09:48.159907 (Thread-1): Using redshift connection "model.my_new_project.bar_table_test_cbt".
2021-01-08 14:09:48.160009 (Thread-1): On model.my_new_project.bar_table_test_cbt: BEGIN
2021-01-08 14:09:48.160087 (Thread-1): Opening a new connection, currently in state closed
2021-01-08 14:09:48.160144 (Thread-1): Connecting to Redshift using 'database' credentials
2021-01-08 14:09:48.773890 (Thread-1): SQL status: BEGIN in 0.61 seconds
2021-01-08 14:09:48.778593 (Thread-1): Using redshift connection "model.my_new_project.bar_table_test_cbt".
2021-01-08 14:09:48.778735 (Thread-1): On model.my_new_project.bar_table_test_cbt: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.bar_table_test_cbt"} */
drop view if exists "dev"."development"."bar_table_test_cbt__dbt_tmp" cascade
2021-01-08 14:09:48.831171 (Thread-81): handling poll request
2021-01-08 14:09:48.831563 (Thread-81): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e5e5310>]}
2021-01-08 14:09:48.836177 (Thread-81): sending response (<Response 27568 bytes [200 OK]>) to 10.0.17.213
2021-01-08 14:09:48.847351 (Thread-1): SQL status: DROP VIEW in 0.07 seconds
2021-01-08 14:09:48.848266 (Thread-1): On model.my_new_project.bar_table_test_cbt: COMMIT
2021-01-08 14:09:48.848356 (Thread-1): Using redshift connection "model.my_new_project.bar_table_test_cbt".
2021-01-08 14:09:48.848403 (Thread-1): On model.my_new_project.bar_table_test_cbt: COMMIT
2021-01-08 14:09:48.942919 (Thread-1): SQL status: COMMIT in 0.09 seconds
2021-01-08 14:09:48.943095 (Thread-1): Using redshift connection "model.my_new_project.bar_table_test_cbt".
2021-01-08 14:09:48.943147 (Thread-1): On model.my_new_project.bar_table_test_cbt: BEGIN
2021-01-08 14:09:49.011626 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:09:49.011848 (Thread-1): On model.my_new_project.bar_table_test_cbt: COMMIT
2021-01-08 14:09:49.011901 (Thread-1): Using redshift connection "model.my_new_project.bar_table_test_cbt".
2021-01-08 14:09:49.011944 (Thread-1): On model.my_new_project.bar_table_test_cbt: COMMIT
2021-01-08 14:09:49.080066 (Thread-1): SQL status: COMMIT in 0.07 seconds
2021-01-08 14:09:49.080242 (Thread-1): Using redshift connection "model.my_new_project.bar_table_test_cbt".
2021-01-08 14:09:49.080293 (Thread-1): On model.my_new_project.bar_table_test_cbt: BEGIN
2021-01-08 14:09:49.148675 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:09:49.150667 (Thread-1): Using redshift connection "model.my_new_project.bar_table_test_cbt".
2021-01-08 14:09:49.150775 (Thread-1): On model.my_new_project.bar_table_test_cbt: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.bar_table_test_cbt"} */
drop view if exists "dev"."development"."bar_table_test_cbt__dbt_backup" cascade
2021-01-08 14:09:49.219180 (Thread-1): SQL status: DROP VIEW in 0.07 seconds
2021-01-08 14:09:49.220197 (Thread-1): On model.my_new_project.bar_table_test_cbt: COMMIT
2021-01-08 14:09:49.220289 (Thread-1): Using redshift connection "model.my_new_project.bar_table_test_cbt".
2021-01-08 14:09:49.220336 (Thread-1): On model.my_new_project.bar_table_test_cbt: COMMIT
2021-01-08 14:09:49.303993 (Thread-1): SQL status: COMMIT in 0.08 seconds
2021-01-08 14:09:49.304163 (Thread-1): Using redshift connection "model.my_new_project.bar_table_test_cbt".
2021-01-08 14:09:49.304215 (Thread-1): On model.my_new_project.bar_table_test_cbt: BEGIN
2021-01-08 14:09:49.372549 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:09:49.373150 (Thread-1): Writing runtime SQL for node "model.my_new_project.bar_table_test_cbt"
2021-01-08 14:09:49.397676 (Thread-1): Using redshift connection "model.my_new_project.bar_table_test_cbt".
2021-01-08 14:09:49.397775 (Thread-1): On model.my_new_project.bar_table_test_cbt: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.bar_table_test_cbt"} */


  create view "dev"."development"."bar_table_test_cbt__dbt_tmp" as (
    /*
DEMO_TABLE = DEVELOPMENT.DIM_CUSTOMER_CARD_MAPPING
#TT_TABLE = DEVELOPMENT.WNS_AS_DD_TENDER_TYPE_MAPPING_02FEB
BASKET_MAPPING = DEVELOPMENT.CUST_BASKET_MAPPING
last_updated_date = '2015-01-01' = {0} 
FinYearFinWeek = {1} 
FinYearFinWeek - 1 = {3}
cust_basket_item_table_name ={4}
limit = {5}
comment = {6}
*/

/*0} last_updated_date '2021-01-04' , max last date updated
{1} DEVELOPMENT.CUST_BASKET_ITEM_{1}, DEVELOPMENT.CUST_BASKET_ITEM_Thursday
{2} fin year month and day, if run today, TEMP_CONS_CUST_BASKET_ITEM_202127_Thursday
{4} cust_basket_item  --is name of table
{5} limit
{6} some comment */

--WbVarDef -variable=vlast_updated_date    -query= "select max(last_updated_date) from analytics.fnd_cust_basket";   --{0}
WbVarDef vlast_updated_date  = '2020-01-01' ;   --{0}
WbVarDef -variable=vDayName              -query= "select to_char(current_date-1,'Day')";                          --{1}
WbVarDef -variable=vFinYearWeekNoDay     -query= "Select fin_year_no||fin_week_no from analytics.fnd_calendar where calendar_date = current_date-1";   --{2}
WbVarDef vCBI                  = 'cust_basket_item';                                                                                     --{4]
WbVarDef vLimit                = '';   --{5}
WbVarDef vComment              = '';   --{6}

/*current_date_$[vlast_updated_date];
select $[vDayName];
select $[vFinYearWeekNoDay];
select $[vCBI];
select $[vLimit];
select $[vComment];*/

/*
-- ANALYTICS.FND_CUSTOMER
-- ANALYTICS.FND_CUSTOMER_MASTER
-- ANALYTICS.FND_CUST_BASKET
-- ANALYTICS.FND_CUST_FV_VOUCHER
-- ANALYTICS.FND_CUSTOMER_PORTFOLIO
-- ANALYTICS.FND_CUST_BASKET_TENDER
-- ANALYTICS.FND_CALENDAR
-- ANALYTICS.FND_LOCATION
-- ANALYTICS.FND_WOD_TIER_MTH_DETAIL
-- ANALYTICS.FND_CUST_BASKET_ITEM
-- ANALYTICS.FND_ITEM
-- ANALYTICS.FND_CUST_BASKET_AUX
-- DEVELOPMENT.WNS_AS_DD_TENDER_TYPE_MAPPING_02FEB (fixed, needs t
-- DEVELOPMENT.CUST_BASKET_MAPPING
-- DEVELOPMENT.DIM_CUSTOMER_CARD_MAPPING
-- DEVELOPMENT.FND_LST_EA_CODES
-- DEVELOPMENT.FND_ROG_SOC_LOCATION
-- analytics.FND_CUSTOMER_CARD
-- DEVELOPMENT.FND_CUST_DERIVED_RACE_REF
*/



/******************************************************************************************************************************************/
/* SCRIPT A - Collating Demographic Details ***********************************************************************************************/
/******************************************************************************************************************************************/

-- CREATE A NEW REFTABLE FOR THE SEP END RUN
CREATE TABLE #wns_nm_DD_TT_UCID_REFTABLE_$[vDayName] AS (
	SELECT perm_ucid_hashed as ucid, SUBSCRIBER_KEY,CUSTOMER_NO,'CARDS' AS CARD_TYPE
	FROM DEVELOPMENT.DIM_CUSTOMER_CARD_MAPPING
	GROUP BY 1,2,3,4) ;
-- Execution time: 8.44s

CREATE TABLE #wns_nm_DD_UCID_HHI_INFO_$[vDayName] AS (
	SELECT A.*, B.EA_CODE,INCOME_CLASS,HOUSEHOLD_INCOME_SUBRANGE
	FROM (
		SELECT UCID,SUBSCRIBER_KEY,CUSTOMER_NO,CARD_TYPE
		FROM #wns_nm_DD_TT_UCID_REFTABLE_$[vDayName]
		GROUP BY 1,2,3,4) A
	LEFT JOIN (
		SELECT CUSTOMER_NO, EA_CODE
		FROM ANALYTICS.FND_CUSTOMER
		GROUP BY 1,2) B
	ON A.CUSTOMER_NO=B.CUSTOMER_NO
	LEFT JOIN (
		SELECT EA_CODE,RACE_CODE,INCOME_CLASS,HOUSEHOLD_INCOME_SUBRANGE,AVERAGE_ADULT_AGE
		FROM DEVELOPMENT.FND_LST_EA_CODES
		GROUP BY 1,2,3,4,5) C
	ON B.EA_CODE=C.EA_CODE)$[vLimit];
-- Execution time: 16.48s

--ADDING ALL THE REQUIRED INFORMATION IN ONE TABLE(HHI+DEMOGRAPHICS)
CREATE TABLE #wns_nm_DD_UCID_HHI_DEMO_TEMP1 AS (
	SELECT A.*,GENDER AS GENDER,BIRTH_DATE,DERIVED_RACE,AGE_DAYS,AGE_YEARS,LAST_UPDATED_DATE AS INFO_CHANGED_DATE, CURRENT_DATE AS CREATED_DATE
	FROM #wns_nm_DD_UCID_HHI_INFO_$[vDayName] A
	LEFT JOIN (
		SELECT A.*,
				UPPER(DERIVED_RACE)  AS DERIVED_RACE,
				(CURRENT_DATE -A.BIRTH_DATE) AS AGE_DAYS,
				(CURRENT_DATE -A.BIRTH_DATE)/365 AS AGE_YEARS
		FROM ANALYTICS.FND_CUSTOMER_MASTER A
		LEFT JOIN DEVELOPMENT.FND_CUST_DERIVED_RACE_REF B
			ON UPPER(A.LAST_NAME)=UPPER(B.SURNAME)) B
		ON A.SUBSCRIBER_KEY=B.MASTER_SUBSCRIBER_KEY)$[vLimit];
-- Execution time: 35.36s

--CREATING TABLE TO DERIVE AGE AND GENDER FROM ID INFORMATION
CREATE TABLE #wns_nm_DD_DEMOGOG_STAGING AS (
	SELECT SUBSCRIBER_KEY,CUSTOMER_NO,CARD_ID,GENDER,TRUNC(DOB) AS DOB,
			(CURRENT_DATE-TRUNC(DOB)) AS AGE,
			(CURRENT_DATE-TRUNC(DOB))/365 AS AGE_YEARS
	FROM (
		SELECT SUBSCRIBER_KEY,CUSTOMER_NO,CARD_ID,
				CASE WHEN GEND_IND BETWEEN 0000 AND 4999 THEN 'F'
					 WHEN GEND_IND BETWEEN 5000 AND 9999 THEN 'M'
					 ELSE 'UNKNOWN' END AS GENDER,
				CASE WHEN DATE_PART_YEAR(BIRTH_DATE) BETWEEN 2000 AND 2019 THEN BIRTH_DATE
					 WHEN DATE_PART_YEAR(BIRTH_DATE)BETWEEN 1900 AND 1919 THEN  DATEADD(YEAR,100,BIRTH_DATE)
					 WHEN DATE_PART_YEAR(BIRTH_DATE) BETWEEN 1920 AND 1999 THEN BIRTH_DATE
					 ELSE DATEADD(YEAR,-100,BIRTH_DATE) END AS DOB
		FROM (
			SELECT SUBSCRIBER_KEY,CUSTOMER_NO,CARD_ID,TRUNC(TO_DATE(LEFT(CARD_ID,6),'YYMMDD'))AS BIRTH_DATE,SUBSTRING(CARD_ID,7,4) AS GEND_IND
			FROM (
				SELECT SUBSCRIBER_KEY,CUSTOMER_NO,MAX(CARD_ID) AS CARD_ID
				FROM (
					SELECT SUBSCRIBER_KEY ,CUSTOMER_NO , CARDHOLDER_IDENTITY_NO AS CARD_ID
					FROM DEVELOPMENT.DIM_CUSTOMER_CARD_MAPPING
					WHERE CARD_ID IS NOT NULL AND CARD_ID <> -1)
					GROUP BY 1,2))))$[vLimit];
-- Execution time: 8.34s

---AGE FROM ID INFORMATION
CREATE TABLE #wns_nm_DD_UCID_HHI_DEMO_TEMP1_2 AS (
	SELECT A.UCID, A.SUBSCRIBER_KEY , A.CUSTOMER_NO,A.CARD_TYPE,A.EA_CODE,A.INCOME_CLASS,A.HOUSEHOLD_INCOME_SUBRANGE,A.DERIVED_RACE,
			CASE WHEN B.AGE IS NULL THEN A.AGE_DAYS ELSE B.AGE END AS AGE_DAYS,
			CASE WHEN B.AGE_YEARS IS NULL THEN A.AGE_YEARS ELSE B.AGE_YEARS END AS AGE_YEARS,
			CASE WHEN B.GENDER IS NULL THEN A.GENDER ELSE B.GENDER END AS GENDER,
			CASE WHEN B.DOB IS NULL THEN A.BIRTH_DATE ELSE B.DOB END AS BIRTH_DATE,
			INFO_CHANGED_DATE,
			CREATED_DATE
	FROM #wns_nm_DD_UCID_HHI_DEMO_TEMP1 A
	LEFT JOIN #wns_nm_DD_DEMOGOG_STAGING B
		ON A.SUBSCRIBER_KEY=B.SUBSCRIBER_KEY
			AND A.CUSTOMER_NO=B.CUSTOMER_NO)$[vLimit];
-- Execution time: 21.33s

--------REMOVING DUPLICATES AT UCID, SUBSCRIBER_KEY LEVEL
CREATE TABLE  #wns_nm_DD_UCID_HHI_DEMO_TEMP2 AS
	SELECT UCID,SUBSCRIBER_KEY,CARD_TYPE,EA_CODE,INCOME_CLASS,HOUSEHOLD_INCOME_SUBRANGE,
			DERIVED_RACE,BIRTH_DATE,AGE_DAYS,AGE_YEARS,GENDER,INFO_CHANGED_DATE,CREATED_DATE
	FROM
		(SELECT UCID,SUBSCRIBER_KEY,CARD_TYPE,EA_CODE,INCOME_CLASS,HOUSEHOLD_INCOME_SUBRANGE,
				DERIVED_RACE,BIRTH_DATE,AGE_DAYS,AGE_YEARS,GENDER,INFO_CHANGED_DATE,CREATED_DATE
		FROM #wns_nm_DD_UCID_HHI_DEMO_TEMP1_2
		WHERE UCID IN (
			SELECT UCID FROM (
				SELECT UCID, SUBSCRIBER_KEY, COUNT(*)AS CNT
				FROM #wns_nm_DD_UCID_HHI_DEMO_TEMP1_2
				GROUP BY 1,2)
			WHERE CNT=1)
		ORDER BY UCID)
		UNION
		(SELECT UCID,SUBSCRIBER_KEY,CARD_TYPE,EA_CODE,INCOME_CLASS,HOUSEHOLD_INCOME_SUBRANGE,
				DERIVED_RACE,BIRTH_DATE,AGE_DAYS,AGE_YEARS,GENDER,INFO_CHANGED_DATE,CREATED_DATE
		FROM #wns_nm_DD_UCID_HHI_DEMO_TEMP1_2
		WHERE UCID IN (
			SELECT UCID FROM (
				SELECT UCID, SUBSCRIBER_KEY, COUNT(*)AS CNT
				FROM #wns_nm_DD_UCID_HHI_DEMO_TEMP1_2
				GROUP BY 1,2)
			WHERE CNT>1)
			AND CUSTOMER_NO IS NOT NULL
		GROUP BY UCID,SUBSCRIBER_KEY,CARD_TYPE,EA_CODE,INCOME_CLASS,HOUSEHOLD_INCOME_SUBRANGE,
				DERIVED_RACE,BIRTH_DATE,AGE_DAYS,AGE_YEARS,GENDER,INFO_CHANGED_DATE,CREATED_DATE
		ORDER BY UCID)$[vLimit];
-- Execution time: 47.39s

--------REMOVING DUPLICATES AT UCID
CREATE TABLE  #wns_nm_DD_UCID_HHI_DEMO_TEMP3 AS
	SELECT UCID,CARD_TYPE,INCOME_CLASS,HOUSEHOLD_INCOME_SUBRANGE,DERIVED_RACE,
			BIRTH_DATE,AGE_DAYS,AGE_YEARS,GENDER,INFO_CHANGED_DATE,CREATED_DATE
	FROM
		(SELECT UCID,CARD_TYPE,INCOME_CLASS,HOUSEHOLD_INCOME_SUBRANGE,DERIVED_RACE,
				BIRTH_DATE,AGE_DAYS,AGE_YEARS,GENDER,INFO_CHANGED_DATE,CREATED_DATE
		FROM #wns_nm_DD_UCID_HHI_DEMO_TEMP2
		WHERE UCID IN (
			SELECT UCID FROM (
				SELECT UCID, COUNT(*)AS CNT
				FROM #wns_nm_DD_UCID_HHI_DEMO_TEMP2
				GROUP BY 1)
			WHERE CNT=1)
		ORDER BY UCID)
		UNION
		(SELECT UCID,CARD_TYPE,INCOME_CLASS,HOUSEHOLD_INCOME_SUBRANGE,DERIVED_RACE,
				BIRTH_DATE,AGE_DAYS,AGE_YEARS,GENDER,INFO_CHANGED_DATE,CREATED_DATE
		FROM #wns_nm_DD_UCID_HHI_DEMO_TEMP2
		WHERE UCID IN (
			SELECT UCID FROM (
				SELECT UCID, COUNT(*)AS CNT
				FROM #wns_nm_DD_UCID_HHI_DEMO_TEMP2
				GROUP BY 1)
			WHERE CNT>1)
		AND SUBSCRIBER_KEY IS NOT NULL
		GROUP BY UCID,CARD_TYPE,INCOME_CLASS,HOUSEHOLD_INCOME_SUBRANGE,DERIVED_RACE,
				BIRTH_DATE,AGE_DAYS,AGE_YEARS,GENDER,INFO_CHANGED_DATE,CREATED_DATE
		ORDER BY UCID)$[vLimit];
-- Execution time: 15.12s

--FINAL TABLE -- CONSIDERING THE UCID WITH LATEST MODIFIED INFORMATION
DROP TABLE IF EXISTS DEVELOPMENT.WNS_NM_SD_DIM_CUSTOMER_DEMO_$[vDayName];
CREATE TABLE DEVELOPMENT.WNS_NM_SD_DIM_CUSTOMER_DEMO_$[vDayName]
	DISTSTYLE ALL AS
		SELECT UCID, CARD_TYPE, INCOME_CLASS, HOUSEHOLD_INCOME_SUBRANGE,DERIVED_RACE,
				BIRTH_DATE,AGE_YEARS,GENDER,INFO_CHANGED_DATE,CREATED_DATE
		FROM (
			SELECT UCID, CARD_TYPE, INCOME_CLASS, HOUSEHOLD_INCOME_SUBRANGE,DERIVED_RACE,
					BIRTH_DATE,AGE_DAYS,AGE_YEARS,GENDER,INFO_CHANGED_DATE,CREATED_DATE
			FROM (
				SELECT * FROM #wns_nm_DD_UCID_HHI_DEMO_TEMP3 WHERE UCID IN (
					SELECT UCID FROM (
						SELECT UCID, COUNT(*)AS CNT
						FROM #wns_nm_DD_UCID_HHI_DEMO_TEMP3
						GROUP BY 1)
					WHERE CNT=1) -- AND ( INCOME_CLASS IS NOT NULL )
				ORDER BY UCID,HOUSEHOLD_INCOME_SUBRANGE,DERIVED_RACE,BIRTH_DATE,
						AGE_DAYS,AGE_YEARS,GENDER,INFO_CHANGED_DATE,CREATED_DATE)
				UNION
				SELECT UCID, CARD_TYPE, INCOME_CLASS, HOUSEHOLD_INCOME_SUBRANGE,DERIVED_RACE,
						BIRTH_DATE,AGE_DAYS,AGE_YEARS,GENDER,INFO_CHANGED_DATE,CREATED_DATE
				FROM (
					SELECT UCID, CARD_TYPE, INCOME_CLASS, HOUSEHOLD_INCOME_SUBRANGE,DERIVED_RACE,
							BIRTH_DATE,AGE_DAYS,AGE_YEARS,GENDER,INFO_CHANGED_DATE,CREATED_DATE,
					ROW_NUMBER() OVER(PARTITION BY UCID ORDER BY INFO_CHANGED_DATE DESC,DERIVED_RACE DESC,AGE_DAYS ASC,GENDER ASC) AS RN
					FROM (
						SELECT * FROM #wns_nm_DD_UCID_HHI_DEMO_TEMP3
						WHERE UCID IN (
							SELECT UCID FROM (
								SELECT UCID, COUNT(*)AS CNT
								FROM #wns_nm_DD_UCID_HHI_DEMO_TEMP3
								GROUP BY 1)
							WHERE CNT>1) -- AND ( INCOME_CLASS IS NOT NULL )
						AND (INCOME_CLASS <>-1 AND INCOME_CLASS<>' ' AND INCOME_CLASS IS NOT NULL )
						ORDER BY UCID,HOUSEHOLD_INCOME_SUBRANGE,DERIVED_RACE,BIRTH_DATE,
								AGE_DAYS,AGE_YEARS,GENDER,INFO_CHANGED_DATE,CREATED_DATE))
				WHERE RN=1)$[vLimit];
-- Execution time: 18.21s

DROP TABLE IF EXISTS #wns_nm_DD_TT_UCID_REFTABLE_$[vDayName];
DROP TABLE IF EXISTS #wns_nm_DD_UCID_HHI_INFO_$[vDayName];
DROP TABLE IF EXISTS #wns_nm_DD_UCID_HHI_DEMO_TEMP1;
DROP TABLE IF EXISTS #wns_nm_DD_DEMOGOG_STAGING;
DROP TABLE IF EXISTS #wns_nm_DD_UCID_HHI_DEMO_TEMP1_2;
DROP TABLE IF EXISTS #wns_nm_DD_UCID_HHI_DEMO_TEMP2;
DROP TABLE IF EXISTS #wns_nm_DD_UCID_HHI_DEMO_TEMP3;


/******************************************************************************************************************************************/
/* SCRIPT A - END                                                                                                         *****************/
/******************************************************************************************************************************************/








/******************************************************************************************************************************************/
/* SCRIPT B - Creating base table from CUST_BASKET data using loyalty, promotional, voucher & calendar details ****************************/
/******************************************************************************************************************************************/

-- Snapshot of the CUST_BASKET table
CREATE TABLE #wns_nm_DD_FND_CUST_BASKET_TEMP
	DISTKEY(TRAN_DATE) COMPOUND SORTKEY(TRAN_DATE, LOCATION_NO, TILL_NO, TRAN_NO) AS (
		SELECT LOCATION_NO, TILL_NO, TRAN_NO, TRAN_DATE, TRAN_TIME, TRAN_TYPE, TRAN_SELLING, DISCOUNT_SELLING, WASTE_IND,
				LOYALTY_WW_SWIPE_NO, LOYALTY_EXT_SWIPE_NO, CUSTOMER_NO,VMP_IND,
				ROW_NUMBER() OVER(PARTITION BY TRAN_DATE, LOCATION_NO, TILL_NO, TRAN_NO ORDER BY LAST_UPDATED_DATE DESC) AS LATEST_FLAG
		FROM ANALYTICS.FND_CUST_BASKET
		WHERE last_updated_date = '$[vlast_updated_date]') $[vLimit];
-- Execution time: 1m 22s

-- REMOVING OLDER ROWS OF A TRANSACTION
DELETE FROM #wns_nm_DD_FND_CUST_BASKET_TEMP WHERE LATEST_FLAG>1;
-- 0 rows affected
-- Execution time: 0.18s

drop table if exists development.wns_adj_new_pos_logic_$[vDayName] ;
create table development.wns_adj_new_pos_logic_$[vDayName]
DISTKEY(TRAN_DATE) COMPOUND SORTKEY(TRAN_DATE, LOCATION_NO, TILL_NO, TRAN_NO) as
select  a.LOCATION_NO, a.TILL_NO, a.TRAN_NO, a.TRAN_DATE, a.TRAN_TIME,  TRAN_SELLING, DISCOUNT_SELLING, WASTE_IND,
                LOYALTY_WW_SWIPE_NO, LOYALTY_EXT_SWIPE_NO, CUSTOMER_NO,VMP_IND,
--case when item_tran_type  in ('R','V','Q','S') then item_tran_type else tran_type end as tran_type_new,
nvl(item_tran_type,tran_type) as tran_type
from #wns_nm_DD_FND_CUST_BASKET_TEMP A
left join (select TRAN_DATE,LOCATION_NO,TILL_NO,TRAN_NO,
				case when item_TRAN_TYPE in ('R','Q','V') then item_TRAN_TYPE else null end as item_TRAN_TYPE
			from(
				select TRAN_DATE,LOCATION_NO,TILL_NO,TRAN_NO,
				count(distinct TRAN_TYPE) as item_TRAN_TYPE_count,
				max( TRAN_TYPE) as item_TRAN_TYPE
				from analytics.fnd_cust_basket_item
				group by 1,2,3,4
                ) where item_TRAN_TYPE_count=1
           ) B
           ON A.TRAN_DATE=B.TRAN_DATE
           AND A.LOCATION_NO=B.LOCATION_NO
           AND A.TILL_NO=B.TILL_NO
           AND A.TRAN_NO=B.TRAN_NO;

CREATE TABLE #wns_nm_DD_CUST_BASKET_UCID
    DISTKEY(TRAN_DATE) COMPOUND SORTKEY(TRAN_DATE, LOCATION_NO, TILL_NO, TRAN_NO) AS (
        SELECT A.LOCATION_NO ,
                A.TILL_NO ,
                A.TRAN_NO ,
                A.TRAN_DATE ,
                A.TRAN_TIME ,
                A.TRAN_TYPE ,
                A.WASTE_IND ,
                A.TRAN_SELLING ,
                A.DISCOUNT_SELLING ,
                A.LOYALTY_WW_SWIPE_NO ,A.LOYALTY_EXT_SWIPE_NO ,
                A.CUSTOMER_NO ,A.VMP_IND,
               (CASE WHEN A.TRAN_TYPE='S' THEN 1 WHEN A.TRAN_TYPE='V' THEN -1 ELSE 0 END) AS TRAN_IND,
                B.UCID
        FROM development.wns_adj_new_pos_logic_$[vDayName] A
        LEFT JOIN (SELECT TRAN_DATE,LOCATION_NO,TILL_NO,TRAN_NO, MAX(PERM_UCID_HASHED) as UCID FROM DEVELOPMENT.CUST_BASKET_MAPPING
                    GROUP BY 1,2,3,4) B
        ON A.TRAN_DATE=B.TRAN_DATE
           AND A.LOCATION_NO=B.LOCATION_NO
           AND A.TILL_NO=B.TILL_NO
           AND A.TRAN_NO=B.TRAN_NO)$[vLimit];
-- Execution time: 52.55s
drop table if exists development.wns_adj_new_pos_logic_$[vDayName] ;


CREATE TABLE #wns_nm_DD_CUST_BASKET_UCID_TYPE_TEMP DISTSTYLE ALL AS (
	SELECT perm_ucid_hashed as UCID,UCID_TYPE
	FROM DEVELOPMENT.DIM_CUSTOMER_CARD_MAPPING
	GROUP BY 1,2)$[vLimit];
-- Execution time: 18.34s

-- ATTACH UCID_TYPE TO THE DATA
CREATE TABLE #wns_nm_DD_CUST_BASKET_UCID_TYPE
	DISTKEY(TRAN_DATE) COMPOUND SORTKEY(TRAN_DATE, LOCATION_NO, TILL_NO, TRAN_NO) AS (
		SELECT A.LOCATION_NO, A.TILL_NO, A.TRAN_NO, A.TRAN_DATE, A.TRAN_TIME, A.TRAN_TYPE, A.WASTE_IND,
				A.LOYALTY_WW_SWIPE_NO, A.LOYALTY_EXT_SWIPE_NO, A.CUSTOMER_NO,A.VMP_IND, A.TRAN_IND, A.UCID, A.TRAN_SELLING,
				A.DISCOUNT_SELLING, C.AGE_YEARS AS AGE, C.DERIVED_RACE AS RACE, C.GENDER AS GENDER,
				C.HOUSEHOLD_INCOME_SUBRANGE AS HOUSEHOLD_INCOME, B.UCID_TYPE
		FROM #wns_nm_DD_CUST_BASKET_UCID A
		LEFT JOIN #wns_nm_DD_CUST_BASKET_UCID_TYPE_TEMP B
		ON A.UCID=B.UCID
		LEFT JOIN DEVELOPMENT.WNS_NM_SD_DIM_CUSTOMER_DEMO_$[vDayName] C
	    ON A.UCID=C.UCID)$[vLimit];
-- Execution time: 58.12s

CREATE TABLE #wns_nm_DD_FND_FV_VOUCHER_TEMP
	DISTKEY(REDEEMED_DATE) COMPOUND SORTKEY(REDEEMED_DATE, REDEEMED_STORE, REDEEMED_TILL_NO, REDEEMED_TRAN_NO) AS (
		SELECT REDEEMED_DATE, REDEEMED_STORE, REDEEMED_TILL_NO, REDEEMED_TRAN_NO,
				COUNT(DISTINCT VOUCHER_NO) AS VOUCHER_COUNT,
				SUM(REDEEMED_AMOUNT) AS VOUCHER_DISCOUNT
		FROM ANALYTICS.FND_CUST_FV_VOUCHER
		WHERE REDEEMED_DATE IS NOT NULL
			AND last_updated_date = '$[vlast_updated_date]'
		GROUP BY 1,2,3,4 )$[vLimit];
-- Execution time: 13.51s

-- ATTACH VOUCHER INFORMATION
CREATE TABLE #wns_nm_DD_CA_TRAN_LEVEL_VOUCHER_FLAG
	DISTKEY(TRAN_DATE) COMPOUND SORTKEY(TRAN_DATE, LOCATION_NO, TILL_NO, TRAN_NO) AS (
		SELECT A.*,
				CASE WHEN B.REDEEMED_DATE IS NULL THEN 0 ELSE 1 END AS VOUCHER_FLAG,
				VOUCHER_COUNT, VOUCHER_DISCOUNT
		FROM #wns_nm_DD_CUST_BASKET_UCID_TYPE A
		LEFT JOIN #wns_nm_DD_FND_FV_VOUCHER_TEMP B
				ON A.TRAN_DATE=B.REDEEMED_DATE
				AND A.LOCATION_NO=B.REDEEMED_STORE
				AND A.TILL_NO=B.REDEEMED_TILL_NO
				AND A.TRAN_NO=B.REDEEMED_TRAN_NO)$[vLimit];
-- Execution time: 52.41s

CREATE TABLE #wns_nm_DD_CA_UCID_LEVEL_CUST_ACQ
	DISTSTYLE ALL AS (
		SELECT UCID, MIN(PORTFOLIO_CREATE_DATE) AS ACQUISITION_DATE
		FROM (SELECT B.UCID, B.CUSTOMER_NO, C.PORTFOLIO_CREATE_DATE
				FROM (SELECT perm_ucid_hashed as UCID, CUSTOMER_NO
						FROM DEVELOPMENT.DIM_CUSTOMER_CARD_MAPPING GROUP BY 1,2) B -- CHANGE HERE TO DEVELOPMENT.AJL_DIM_CUSTOMER_CARD_MAPPING_NO_CUTOFF_202013_V2 [NM]
				LEFT JOIN (SELECT CUSTOMER_NO, PORTFOLIO_CREATE_DATE, PRODUCT_CODE_NO
							FROM ANALYTICS.FND_CUSTOMER_PORTFOLIO
							WHERE PRODUCT_CODE_NO IN ('0','1','2','3','4','5','6','7','8','9','10','11','15','16','19','20','21','28') ) C --TO BE CHANGED [NM]
				ON B.CUSTOMER_NO=C.CUSTOMER_NO) D
		GROUP BY 1)$[vLimit];
-- Execution time: 15.71s

CREATE TABLE #wns_nm_DD_CA_TRAN_LEVEL_CUST_ACQ
	DISTKEY(TRAN_DATE) COMPOUND SORTKEY(TRAN_DATE, LOCATION_NO, TILL_NO, TRAN_NO) AS (
		SELECT A.LOCATION_NO, A.TILL_NO, A.TRAN_NO, A.TRAN_DATE, A.TRAN_TIME, A.TRAN_TYPE, A.TRAN_SELLING, A.DISCOUNT_SELLING, A.WASTE_IND,
				A.LOYALTY_WW_SWIPE_NO, A.LOYALTY_EXT_SWIPE_NO, A.CUSTOMER_NO, A.VMP_IND,A.TRAN_IND, A.UCID, A.UCID_TYPE, A.AGE, A.RACE, A.GENDER,
				A.HOUSEHOLD_INCOME, A.VOUCHER_FLAG, A.VOUCHER_COUNT, A.VOUCHER_DISCOUNT,
				CASE WHEN ACQUISITION_DATE IS NULL THEN '1999-01-01'
					WHEN ACQUISITION_DATE<'1999-01-01' THEN '1999-01-01' -- THE FIRST DATE IN CUST_BASKET IS 1999-06-04
					WHEN ACQUISITION_DATE>=(CURRENT_DATE+1) THEN CURRENT_DATE
						ELSE ACQUISITION_DATE END AS ACQUISITION_DATE
		FROM #wns_nm_DD_CA_TRAN_LEVEL_VOUCHER_FLAG A
		LEFT JOIN #wns_nm_DD_CA_UCID_LEVEL_CUST_ACQ B
				ON A.UCID=B.UCID)$[vLimit];
-- Execution time: 57.6s

CREATE TABLE #wns_nm_DD_SHK_CUSTOMER_CARD_MAPPING_SUB
	DISTSTYLE ALL AS (
		SELECT CARD_NO, CUSTOMER_NO
		FROM DEVELOPMENT.DIM_CUSTOMER_CARD_MAPPING
		GROUP BY 1,2)$[vLimit];
-- Execution time: 1m 0s

-- ATTACH CUSTOMER NO BASED ON LOYALTY_WW_SWIPE_NO
CREATE TABLE #wns_nm_DD_CA_TRAN_LEVEL_C2_1
	DISTKEY(TRAN_DATE) COMPOUND SORTKEY(TRAN_DATE, LOCATION_NO, TILL_NO, TRAN_NO) AS (
		SELECT A.*, B.CUSTOMER_NO AS C2_CUSTOMER_NO_1
		FROM #wns_nm_DD_CA_TRAN_LEVEL_CUST_ACQ A
		LEFT JOIN #wns_nm_DD_SHK_CUSTOMER_CARD_MAPPING_SUB B
				ON A.LOYALTY_WW_SWIPE_NO=B.CARD_NO)$[vLimit];
-- Execution time: 54.67s

-- ATTACH CUSTOMER NO BASED ON LOYALTY_EXT_SWIPE_NO
CREATE TABLE #wns_nm_DD_CA_TRAN_LEVEL_C2_2
	DISTKEY(TRAN_DATE) COMPOUND SORTKEY(TRAN_DATE, LOCATION_NO, TILL_NO, TRAN_NO) AS (
		SELECT A.*,B.CUSTOMER_NO AS C2_CUSTOMER_NO_2
			FROM #wns_nm_DD_CA_TRAN_LEVEL_CUST_ACQ A
			LEFT JOIN #wns_nm_DD_SHK_CUSTOMER_CARD_MAPPING_SUB B
			ON A.LOYALTY_EXT_SWIPE_NO=B.CARD_NO)$[vLimit];
-- Execution time: 49.84s

-- PICKING THE AVAILABLE CUSTOMER NO
CREATE TABLE #wns_nm_DD_CA_TRAN_LEVEL_C2
	DISTKEY(TRAN_DATE) COMPOUND SORTKEY(TRAN_DATE, LOCATION_NO, TILL_NO, TRAN_NO) AS (
		SELECT A.*,
				CASE WHEN A.C2_CUSTOMER_NO_1 IS NULL THEN B.C2_CUSTOMER_NO_2 ELSE A.C2_CUSTOMER_NO_1 END AS C2_CUSTOMER_NO,
				CASE WHEN A.LOYALTY_WW_SWIPE_NO IS NULL THEN 0 ELSE 1 END AS WREWARDS_SWIPE_IND,
				CASE WHEN A.LOYALTY_EXT_SWIPE_NO IS NULL THEN 0 ELSE 1 END AS MYSCHOOL_SWIPE_IND
		FROM #wns_nm_DD_CA_TRAN_LEVEL_C2_1 A
		LEFT JOIN #wns_nm_DD_CA_TRAN_LEVEL_C2_2 B
				ON A.TRAN_DATE=B.TRAN_DATE
					AND A.LOCATION_NO=B.LOCATION_NO
					AND A.TILL_NO=B.TILL_NO
					AND A.TRAN_NO=B.TRAN_NO)$[vLimit];
-- Execution time: 1m 1s

ALTER TABLE #wns_nm_DD_CA_TRAN_LEVEL_C2 DROP COLUMN LOYALTY_WW_SWIPE_NO;
ALTER TABLE #wns_nm_DD_CA_TRAN_LEVEL_C2 DROP COLUMN LOYALTY_EXT_SWIPE_NO;
ALTER TABLE #wns_nm_DD_CA_TRAN_LEVEL_C2 DROP COLUMN C2_CUSTOMER_NO_1;
-- Total script execution time: 0.06s

CREATE TABLE #wns_nm_DD_FND_CUST_BASKET_TENDER_TEMP
	DISTKEY(TRAN_DATE) COMPOUND SORTKEY(TRAN_DATE, LOCATION_NO, TILL_NO, TRAN_NO) AS (
		SELECT LOCATION_NO, TILL_NO, TRAN_NO, TRAN_DATE,
				CASE WHEN TENDER_TYPE_DETAIL_CODE IS NULL THEN 'NULL_VALUE' ELSE TENDER_TYPE_DETAIL_CODE END AS TENDER_TYPE_DETAIL_CODE1,
				TENDER_NO, TENDER_SELLING, CHANGE_SELLING
		FROM ANALYTICS.FND_CUST_BASKET_TENDER
		GROUP BY 1,2,3,4,5,6,7,8)$[vLimit];
-- Execution time: 1m 12s

CREATE TABLE #wns_nm_DD_FND_CUSTOMER_CARD_TEMP DISTSTYLE ALL AS (
	SELECT CARD_NO,
			CASE WHEN PRODUCT_CODE_NO IN ('1','2','3','4','5','6','7','21' ) THEN 'SC'
					WHEN PRODUCT_CODE_NO ='20' THEN 'CC' END AS STORE_CC_FLAG
	FROM analytics.FND_CUSTOMER_CARD)$[vLimit];
-- Execution time: 59.26s

delete from #wns_nm_DD_FND_CUSTOMER_CARD_TEMP where STORE_CC_FLAG is null;
-- 8,924,491 rows affected
-- Execution time: 4.76s

CREATE TABLE #wns_nm_DD_FND_CUST_BASKET_TENDER_TEMP_STORE_CC_FLAG
	DISTKEY(TRAN_DATE) COMPOUND SORTKEY(TRAN_DATE, LOCATION_NO, TILL_NO, TRAN_NO) AS (
		SELECT LOCATION_NO, TILL_NO, TRAN_NO, TRAN_DATE,
				TENDER_TYPE_DETAIL_CODE1 AS TENDER_TYPE_DETAIL_CODE,
				TENDER_NO, TENDER_SELLING, CHANGE_SELLING, STORE_CC_FLAG
		FROM #wns_nm_DD_FND_CUST_BASKET_TENDER_TEMP A
		LEFT JOIN #wns_nm_DD_FND_CUSTOMER_CARD_TEMP B
				ON A.TENDER_NO=B.CARD_NO)$[vLimit];
-- Execution time: 31.72s

CREATE TABLE #wns_nm_DD_FND_CUST_BASKET_TENDER_TEMP_STORE_CC_FLAG_BASE_TABLE
	DISTKEY(TRAN_DATE) COMPOUND SORTKEY(TRAN_DATE, LOCATION_NO, TILL_NO, TRAN_NO) AS (
		SELECT A.LOCATION_NO, A.TILL_NO, A.TRAN_NO, A.TRAN_DATE, A.TENDER_TYPE_DETAIL_CODE, A.TENDER_NO, A.TENDER_SELLING, A.CHANGE_SELLING, A.STORE_CC_FLAG,
				B.TENDER_TYPE_FOR_BASE_TABLE,
				CASE WHEN STORE_CC_FLAG IS NULL
						THEN
						CASE WHEN TENDER_TYPE_FOR_BASE_TABLE='WW VISA CARD' THEN 'CC'
							 WHEN TENDER_TYPE_FOR_BASE_TABLE='WW STORE CARD' THEN 'SC'
							 ELSE TENDER_TYPE_FOR_BASE_TABLE
						END
						ELSE STORE_CC_FLAG
					END AS TENDER_TYPE_FOR_BASE_TABLE1
		FROM #wns_nm_DD_FND_CUST_BASKET_TENDER_TEMP_STORE_CC_FLAG A
		LEFT JOIN (SELECT CASE WHEN TENDER_TYPE_DETAIL_CODE IS NULL THEN 'NULL_VALUE' ELSE TENDER_TYPE_DETAIL_CODE END AS TENDER_TYPE_DETAIL_CODE1,
							TENDER_TYPE_FOR_BASE_TABLE FROM DEVELOPMENT.SD_TENDER_TYPE_MAPPING_06APR) B
				ON A.TENDER_TYPE_DETAIL_CODE=B.TENDER_TYPE_DETAIL_CODE1)$[vLimit];
-- Execution time: 32.8s

CREATE TABLE #wns_nm_WNS_SD_TEMP1
	DISTKEY(TRAN_DATE) COMPOUND SORTKEY(TRAN_DATE, LOCATION_NO, TILL_NO, TRAN_NO) AS (
		SELECT TRAN_NO, LOCATION_NO, TILL_NO , TRAN_DATE,
				COUNT(DISTINCT CASE WHEN TENDER_TYPE_FOR_BASE_TABLE1='SC' THEN TENDER_NO END) AS STORE_CARD_TENDER_COUNT,
				SUM(CASE WHEN TENDER_TYPE_FOR_BASE_TABLE1 ='SC' THEN TENDER_SELLING END) AS STORE_CARD_TRAN_TENDER_SELLING,
				COUNT(DISTINCT CASE WHEN TENDER_TYPE_FOR_BASE_TABLE1 ='WW Gift Card' THEN TENDER_NO END) AS GIFT_CARD_TENDER_COUNT,
				SUM(CASE WHEN TENDER_TYPE_FOR_BASE_TABLE1 ='WW Gift Card' THEN TENDER_SELLING END) AS GIFT_CARD_TRAN_TENDER_SELLING,
				COUNT(DISTINCT CASE WHEN TENDER_TYPE_FOR_BASE_TABLE1 ='WW Voucher' THEN TENDER_NO END) AS VOUCHER_TENDER_COUNT,
				SUM(CASE WHEN TENDER_TYPE_FOR_BASE_TABLE1 ='WW Voucher' THEN TENDER_SELLING END) AS VOUCHER_TRAN_TENDER_SELLING,
				COUNT(DISTINCT CASE WHEN TENDER_TYPE_FOR_BASE_TABLE1 ='Alien Bank Card' THEN TENDER_NO END) AS ALIEN_CARD_TENDER_COUNT,
				SUM(CASE WHEN TENDER_TYPE_FOR_BASE_TABLE1 ='Alien Bank Card' THEN TENDER_SELLING END) AS ALIEN_CARD_TRAN_TENDER_SELLING,
				COUNT(DISTINCT CASE WHEN TENDER_TYPE_FOR_BASE_TABLE1 ='CC' THEN TENDER_NO END) AS CREDIT_CARD_TENDER_COUNT,
				SUM(CASE WHEN TENDER_TYPE_FOR_BASE_TABLE1 ='CC' THEN TENDER_SELLING END) AS CREDIT_CARD_TRAN_TENDER_SELLING,
				MAX(CASE WHEN TENDER_TYPE_FOR_BASE_TABLE1 ='Cash' THEN 1 ELSE 0 END) AS CASH_TENDER_IND,
				SUM(CASE WHEN TENDER_TYPE_FOR_BASE_TABLE1 ='Cash' THEN TENDER_SELLING-CHANGE_SELLING END) AS CASH_TRAN_TENDER_SELLING,
				COUNT(DISTINCT CASE WHEN TENDER_TYPE_FOR_BASE_TABLE1 ='Other' THEN TENDER_NO END) AS OTHER_TENDER_COUNT,
				SUM(CASE WHEN TENDER_TYPE_FOR_BASE_TABLE1 ='Other' THEN TENDER_SELLING END) AS OTHER_TRAN_TENDER_SELLING
		FROM #wns_nm_DD_FND_CUST_BASKET_TENDER_TEMP_STORE_CC_FLAG_BASE_TABLE
		GROUP BY 1,2,3,4)$[vLimit];
-- Execution time: 2m 57s

CREATE TABLE #wns_nm_WNS_DD_CA_TRAN_LEVEL_CAL_JOIN
	DISTKEY(TRAN_DATE) COMPOUND SORTKEY(TRAN_DATE, LOCATION_NO, TILL_NO, TRAN_NO) AS (
		SELECT A.*,FIN_YEAR_NO, FIN_HALF_NO, FIN_QUARTER_NO, FIN_MONTH_NO, FIN_WEEK_NO, FIN_DAY_NO, SEASON_NO
		        ,CASE WHEN DAY_NAME IN ('SATURDAY','SUNDAY') THEN 2   --added the weekday_weekend_code - new column
				 ELSE 1 END AS WEEKDAY_WEEKEND_CODE,
				C.GIFT_CARD_TENDER_COUNT, C.GIFT_CARD_TRAN_TENDER_SELLING, C.VOUCHER_TENDER_COUNT, C.VOUCHER_TRAN_TENDER_SELLING,
				C.ALIEN_CARD_TENDER_COUNT, C.ALIEN_CARD_TRAN_TENDER_SELLING, C.CASH_TENDER_IND, C.CASH_TRAN_TENDER_SELLING,
				C.STORE_CARD_TENDER_COUNT, C.STORE_CARD_TRAN_TENDER_SELLING, C.CREDIT_CARD_TENDER_COUNT, C.CREDIT_CARD_TRAN_TENDER_SELLING,
				C.OTHER_TENDER_COUNT, C.OTHER_TRAN_TENDER_SELLING
		FROM #wns_nm_DD_CA_TRAN_LEVEL_C2 A
		LEFT JOIN ANALYTICS.FND_CALENDAR B
				ON A.TRAN_DATE=B.CALENDAR_DATE
		LEFT JOIN #wns_nm_WNS_SD_TEMP1 C
				ON A.TRAN_DATE=C.TRAN_DATE
				AND A.LOCATION_NO=C.LOCATION_NO
				AND A.TILL_NO=C.TILL_NO
				AND A.TRAN_NO=C.TRAN_NO)$[vLimit];
-- Execution time: 1m 23s
-- 60GB
DROP TABLE IF EXISTS DEVELOPMENT.WNS_NM_DD_CA_UCID_LEVEL_CUST_ACQ_mapping$[vDayName];
create table DEVELOPMENT.WNS_NM_DD_CA_UCID_LEVEL_CUST_ACQ_mapping$[vDayName]
diststyle all as
(select * from #wns_nm_DD_CA_UCID_LEVEL_CUST_ACQ) $[vLimit];

DROP TABLE IF EXISTS #wns_nm_DD_FND_CUST_BASKET_TEMP;
DROP TABLE IF EXISTS #wns_nm_DD_CUST_BASKET_UCID;
DROP TABLE IF EXISTS #wns_nm_DD_CUST_BASKET_UCID_TYPE_TEMP;
DROP TABLE IF EXISTS #wns_nm_DD_CUST_BASKET_UCID_TYPE;
DROP TABLE IF EXISTS #wns_nm_DD_FND_FV_VOUCHER_TEMP;
DROP TABLE IF EXISTS #wns_nm_DD_CA_TRAN_LEVEL_VOUCHER_FLAG;
DROP TABLE IF EXISTS #wns_nm_DD_CA_UCID_LEVEL_CUST_ACQ;
DROP TABLE IF EXISTS #wns_nm_DD_CA_TRAN_LEVEL_CUST_ACQ;
DROP TABLE IF EXISTS #wns_nm_DD_SHK_CUSTOMER_CARD_MAPPING_SUB;
DROP TABLE IF EXISTS #wns_nm_DD_CA_TRAN_LEVEL_C2_1;
DROP TABLE IF EXISTS #wns_nm_DD_CA_TRAN_LEVEL_C2_2;
DROP TABLE IF EXISTS #wns_nm_DD_CA_TRAN_LEVEL_C2;
DROP TABLE IF EXISTS #wns_nm_DD_FND_CUST_BASKET_TENDER_TEMP;
DROP TABLE IF EXISTS #wns_nm_DD_FND_CUSTOMER_CARD_TEMP;
DROP TABLE IF EXISTS #wns_nm_DD_FND_CUST_BASKET_TENDER_TEMP_STORE_CC_FLAG;
DROP TABLE IF EXISTS #wns_nm_DD_FND_CUST_BASKET_TENDER_TEMP_STORE_CC_FLAG_BASE_TABLE;
DROP TABLE IF EXISTS #wns_nm_WNS_SD_TEMP1;


/******************************************************************************************************************************************/
/* SCRIPT B - END                                                                                                         *****************/
/******************************************************************************************************************************************/

/******************************************************************
--TIER START
*******************************************************************/
---======================================================  START tier ====================================================
-- year ,half_year,fin_qy,fin_month_no based tier calculation and creating a single table
--  ''development.wns_adj_tier_wise$[vDayName]''

DROP TABLE IF EXISTS development.wns_nm_DD_SHK_TIER_LAST_TIER_RAW_$[vDayName];

CREATE TABLE development.wns_nm_DD_SHK_TIER_LAST_TIER_RAW_$[vDayName] AS
  SELECT * FROM (
                SELECT PRIMARY_CUSTOMER_IDENTIFIER AS CUSTOMER_NO, (FIN_YEAR_NO*100)+01 AS FIN_MONTH, MONTH_01_TIER AS TIER FROM ANALYTICS.FND_WOD_TIER_MTH_DETAIL UNION
                SELECT PRIMARY_CUSTOMER_IDENTIFIER AS CUSTOMER_NO, (FIN_YEAR_NO*100)+02 AS FIN_MONTH, MONTH_02_TIER AS TIER FROM ANALYTICS.FND_WOD_TIER_MTH_DETAIL UNION
                SELECT PRIMARY_CUSTOMER_IDENTIFIER AS CUSTOMER_NO, (FIN_YEAR_NO*100)+03 AS FIN_MONTH, MONTH_03_TIER AS TIER FROM ANALYTICS.FND_WOD_TIER_MTH_DETAIL UNION
                SELECT PRIMARY_CUSTOMER_IDENTIFIER AS CUSTOMER_NO, (FIN_YEAR_NO*100)+04 AS FIN_MONTH, MONTH_04_TIER AS TIER FROM ANALYTICS.FND_WOD_TIER_MTH_DETAIL UNION
                SELECT PRIMARY_CUSTOMER_IDENTIFIER AS CUSTOMER_NO, (FIN_YEAR_NO*100)+05 AS FIN_MONTH, MONTH_05_TIER AS TIER FROM ANALYTICS.FND_WOD_TIER_MTH_DETAIL UNION
                SELECT PRIMARY_CUSTOMER_IDENTIFIER AS CUSTOMER_NO, (FIN_YEAR_NO*100)+06 AS FIN_MONTH, MONTH_06_TIER AS TIER FROM ANALYTICS.FND_WOD_TIER_MTH_DETAIL UNION
                SELECT PRIMARY_CUSTOMER_IDENTIFIER AS CUSTOMER_NO, (FIN_YEAR_NO*100)+07 AS FIN_MONTH, MONTH_07_TIER AS TIER FROM ANALYTICS.FND_WOD_TIER_MTH_DETAIL UNION
                SELECT PRIMARY_CUSTOMER_IDENTIFIER AS CUSTOMER_NO, (FIN_YEAR_NO*100)+08 AS FIN_MONTH, MONTH_08_TIER AS TIER FROM ANALYTICS.FND_WOD_TIER_MTH_DETAIL UNION
                SELECT PRIMARY_CUSTOMER_IDENTIFIER AS CUSTOMER_NO, (FIN_YEAR_NO*100)+09 AS FIN_MONTH, MONTH_09_TIER AS TIER FROM ANALYTICS.FND_WOD_TIER_MTH_DETAIL UNION
                SELECT PRIMARY_CUSTOMER_IDENTIFIER AS CUSTOMER_NO, (FIN_YEAR_NO*100)+10 AS FIN_MONTH, MONTH_10_TIER AS TIER FROM ANALYTICS.FND_WOD_TIER_MTH_DETAIL UNION
                SELECT PRIMARY_CUSTOMER_IDENTIFIER AS CUSTOMER_NO, (FIN_YEAR_NO*100)+11 AS FIN_MONTH, MONTH_11_TIER AS TIER FROM ANALYTICS.FND_WOD_TIER_MTH_DETAIL UNION
                SELECT PRIMARY_CUSTOMER_IDENTIFIER AS CUSTOMER_NO, (FIN_YEAR_NO*100)+12 AS FIN_MONTH, MONTH_12_TIER AS TIER FROM ANALYTICS.FND_WOD_TIER_MTH_DETAIL) $[vLimit];


DROP TABLE if exists development.wns_kr_tier_year_wise_$[vDayName];

Create Table development.wns_kr_tier_year_wise_$[vDayName] diststyle all as
(select *
from (
      select cast(FIN_MONTH/100 as numeric(5,0)) as fin_year_no,nvl(tier,0) as tier_, b.perm_ucid_hashed as UCID
            ,ROW_NUMBER() OVER(PARTITION BY b.perm_ucid_hashed,fin_year_no ORDER BY tier_ DESC) AS MAX_TIER_RANK
      from development.wns_nm_DD_SHK_TIER_LAST_TIER_RAW_$[vDayName] a
      left join development.dim_customer_card_mapping b
      on a.customer_no = b.customer_no
      where mod(FIN_MONTH,100) = 12
      )
where MAX_TIER_RANK = 1
);


DROP TABLE IF EXISTS development.wns_adj_tier_fh_wise_UCID_$[vDayName];
Create Table development.wns_adj_tier_fh_wise_UCID_$[vDayName] as
select *
from (
      select cast(FIN_MONTH/100 as integer) as fin_year_no,nvl(tier,0) as tier_fh, b.perm_ucid_hashed as UCID
            ,case when mod(fin_month,100)/2 = 1 then 1
                  when mod(fin_month,100)/2 = 2 then 2
             else '0'
             end as half_year
            ,ROW_NUMBER() OVER(PARTITION BY b.perm_ucid_hashed,fin_year_no,half_year ORDER BY tier_fh DESC) AS MAX_TIER_RANK
                                                from development.wns_nm_DD_SHK_TIER_LAST_TIER_RAW_$[vDayName] a
      left join development.dim_customer_card_mapping b --change the mapping table accordingly
      on a.customer_no = b.customer_no
      where half_year in (1,2)
      )
where MAX_TIER_RANK = 1 and UCID is not null
;


Drop table IF Exists development.wns_adj_tier_fq_wise_UCID_$[vDayName];
Create Table development.wns_adj_tier_fq_wise_UCID_$[vDayName] as
select *
from (
      select cast(FIN_MONTH/100 as integer) as fin_year_no,nvl(tier,0) as tier_fq, b.perm_ucid_hashed as UCID
            ,case when mod(fin_month,100)/3 = 1 then 1
                  when mod(fin_month,100)/3 = 2 then 2
                  when mod(fin_month,100)/3 = 3 then 3
                  when mod(fin_month,100)/3 = 4 then 4
             else '0'
             end as quarter
            ,ROW_NUMBER() OVER(PARTITION BY b.perm_ucid_hashed,fin_year_no,quarter ORDER BY tier_fq DESC) AS MAX_TIER_RANK
                                                from development.wns_nm_DD_SHK_TIER_LAST_TIER_RAW_$[vDayName] a
      left join development.dim_customer_card_mapping b --change the mapping table accordingly
      on a.customer_no = b.customer_no
      where quarter in (1,2,3,4)
      )
where MAX_TIER_RANK = 1 and UCID is not null
;



Drop table IF Exists development.wns_adj_tier_fm_wise_UCID_$[vDayName];
Create Table development.wns_adj_tier_fm_wise_UCID_$[vDayName]
diststyle all as
select UCID,fin_year_no,fin_month_no,tier_fm
from (
      select cast(FIN_MONTH/100 as integer) as fin_year_no,nvl(tier,0) as tier_fm, b.perm_ucid_hashed as UCID
           ,mod(FIN_MONTH,100) as fin_month_no
            ,ROW_NUMBER() OVER(PARTITION BY b.perm_ucid_hashed,fin_year_no,fin_month_no ORDER BY tier_fm DESC) AS MAX_TIER_RANK
                                                from development.wns_nm_DD_SHK_TIER_LAST_TIER_RAW_$[vDayName] a
      left join development.dim_customer_card_mapping b --change the mapping table accordingly
      on a.customer_no = b.customer_no
        )
where MAX_TIER_RANK = 1 and UCID is not null ;



DROP TABLE IF EXISTS development.wns_adj_tier_wise$[vDayName];
CREATE TABLE IF NOT EXISTS development.wns_adj_tier_wise$[vDayName]
(
                ucid VARCHAR(100)   ENCODE lzo
                ,fin_year_no smallint   ENCODE az64
                ,fin_month_no smallint   ENCODE az64
                ,tier_fm smallint   ENCODE az64
                ,tier_fq smallint   ENCODE az64
                ,tier_fh smallint   ENCODE az64
                ,tier_fy smallint   ENCODE az64
)
DISTSTYLE ALL
;


grant select on table development.wns_adj_tier_wise$[vDayName] to public;


insert into development.wns_adj_tier_wise$[vDayName] (
select
   A.ucid,A.fin_year_no,A.fin_month_no,A.tier_fm
   ,  b.tier_fq,
   C.tier_fh,
   D.tier_ as tier_fy
from
   (
      select
         ucid,
         fin_year_no,
         fin_month_no,
         tier_fm,
         case
            when
               fin_month_no in
               (
                  '1',
                  '2',
                  '3'
               )
            then
               1
            when
               fin_month_no in
               (
                  '4', '5', '6'
               )
            then
               2
            when
               fin_month_no in
               (
                  '7', '8', '9'
               )
            then
               3
            when
               fin_month_no in
               (
                  '10', '11', '12'
               )
            then
               4
         end
         as fin_qy,
         case
            when
               fin_month_no in
               (
                  '1', '2', '3', '4', '5', '6'
               )
            then
               1
            when
               fin_month_no in
               (
                  '7', '8', '9', '10', '11', '12'
               )
            then
               2
         end
         as fin_hy
      from
         development.wns_adj_tier_fm_wise_UCID_$[vDayName]
   )
   A
   left join
      development.wns_adj_tier_fq_wise_UCID_$[vDayName] B
      on A.fin_year_no = B.fin_year_no
      and A.fin_qy = B.quarter
      and A.ucid = b.ucid
   LEFT JOIN
      development.wns_adj_tier_fh_wise_UCID_$[vDayName] C
      on A.fin_year_no = C.fin_year_no
      and A.fin_hy = C.half_year
      and A.ucid = C.ucid
   LEFT JOIN
      development.wns_kr_tier_year_wise_$[vDayName] D
      on A.fin_year_no = D.fin_year_no
      and A.ucid = D.ucid  where A.fin_year_no >='2018');


drop table if exists development.wns_nm_DD_SHK_TIER_LAST_TIER_RAW_$[vDayName];
drop table if exists development.wns_adj_tier_fm_wise_UCID_$[vDayName];
drop table if exists development.wns_adj_tier_fq_wise_UCID_$[vDayName];
drop table if exists development.wns_adj_tier_fh_wise_UCID_$[vDayName];
drop table if exists development.wns_kr_tier_year_wise_$[vDayName];

---=============================================================  END tier ====================================================


/******************************************************************************************************************************************/
/* SCRIPT C - Preparing Tier Details *******************************************************************************************************/
/******************************************************************************************************************************************/

-- EXTRACT RAW DATA FROM THE TIER TABLE AND PIVOT THE MONTHLY TIER COLUMNS IN TO A SINGLE COLUMN
CREATE TABLE #wns_nm_DD_SHK_TIER_LAST_TIER_RAW AS
  SELECT * FROM (
	SELECT PRIMARY_CUSTOMER_IDENTIFIER AS CUSTOMER_NO, (FIN_YEAR_NO*100)+01 AS FIN_MONTH, MONTH_01_TIER AS TIER FROM ANALYTICS.FND_WOD_TIER_MTH_DETAIL UNION
	SELECT PRIMARY_CUSTOMER_IDENTIFIER AS CUSTOMER_NO, (FIN_YEAR_NO*100)+02 AS FIN_MONTH, MONTH_02_TIER AS TIER FROM ANALYTICS.FND_WOD_TIER_MTH_DETAIL UNION
	SELECT PRIMARY_CUSTOMER_IDENTIFIER AS CUSTOMER_NO, (FIN_YEAR_NO*100)+03 AS FIN_MONTH, MONTH_03_TIER AS TIER FROM ANALYTICS.FND_WOD_TIER_MTH_DETAIL UNION
	SELECT PRIMARY_CUSTOMER_IDENTIFIER AS CUSTOMER_NO, (FIN_YEAR_NO*100)+04 AS FIN_MONTH, MONTH_04_TIER AS TIER FROM ANALYTICS.FND_WOD_TIER_MTH_DETAIL UNION
	SELECT PRIMARY_CUSTOMER_IDENTIFIER AS CUSTOMER_NO, (FIN_YEAR_NO*100)+05 AS FIN_MONTH, MONTH_05_TIER AS TIER FROM ANALYTICS.FND_WOD_TIER_MTH_DETAIL UNION
	SELECT PRIMARY_CUSTOMER_IDENTIFIER AS CUSTOMER_NO, (FIN_YEAR_NO*100)+06 AS FIN_MONTH, MONTH_06_TIER AS TIER FROM ANALYTICS.FND_WOD_TIER_MTH_DETAIL UNION
	SELECT PRIMARY_CUSTOMER_IDENTIFIER AS CUSTOMER_NO, (FIN_YEAR_NO*100)+07 AS FIN_MONTH, MONTH_07_TIER AS TIER FROM ANALYTICS.FND_WOD_TIER_MTH_DETAIL UNION
	SELECT PRIMARY_CUSTOMER_IDENTIFIER AS CUSTOMER_NO, (FIN_YEAR_NO*100)+08 AS FIN_MONTH, MONTH_08_TIER AS TIER FROM ANALYTICS.FND_WOD_TIER_MTH_DETAIL UNION
	SELECT PRIMARY_CUSTOMER_IDENTIFIER AS CUSTOMER_NO, (FIN_YEAR_NO*100)+09 AS FIN_MONTH, MONTH_09_TIER AS TIER FROM ANALYTICS.FND_WOD_TIER_MTH_DETAIL UNION
	SELECT PRIMARY_CUSTOMER_IDENTIFIER AS CUSTOMER_NO, (FIN_YEAR_NO*100)+10 AS FIN_MONTH, MONTH_10_TIER AS TIER FROM ANALYTICS.FND_WOD_TIER_MTH_DETAIL UNION
	SELECT PRIMARY_CUSTOMER_IDENTIFIER AS CUSTOMER_NO, (FIN_YEAR_NO*100)+11 AS FIN_MONTH, MONTH_11_TIER AS TIER FROM ANALYTICS.FND_WOD_TIER_MTH_DETAIL UNION
	SELECT PRIMARY_CUSTOMER_IDENTIFIER AS CUSTOMER_NO, (FIN_YEAR_NO*100)+12 AS FIN_MONTH, MONTH_12_TIER AS TIER FROM ANALYTICS.FND_WOD_TIER_MTH_DETAIL)$[vLimit];
-- Execution time: 20.28s

-- GENERATE PREVIOUS MONTH TIER AT A MONTH LEVEL FOR EVERY CUSTOMER
CREATE TABLE #wns_nm_DD_SHK_TIER_LAST_TIER_LAG AS (
	SELECT CUSTOMER_NO, FIN_MONTH, TIER,
		   LAG(TIER) OVER(PARTITION BY CUSTOMER_NO ORDER BY FIN_MONTH) AS PREV_MNTH_TIER
	FROM #wns_nm_DD_SHK_TIER_LAST_TIER_RAW)$[vLimit];
-- Execution time: 19.82s

--TAKE ALL CUSTOMERS CURRENT TIER ONLY
CREATE TABLE #wns_nm_DD_SHK_CUSTOMER_CURRENT_TIER AS (
	SELECT CUSTOMER_NO, CUSTOMER_CURRENT_TIER_CODE
	FROM (SELECT CUSTOMER_NO, FIN_MONTH, TIER AS CUSTOMER_CURRENT_TIER_CODE,
					ROW_NUMBER() OVER(PARTITION BY CUSTOMER_NO ORDER BY FIN_MONTH DESC) AS LATEST_TIER_RANK
			FROM #wns_nm_DD_SHK_TIER_LAST_TIER_LAG)
	WHERE LATEST_TIER_RANK = 1
	GROUP BY 1,2)$[vLimit];
-- Execution time: 19.82s

--TAKE ALL CUSTOMERS ALONG WITH THEIR PREVIOUS TIER AND THE MONTH IN WHICH THE TIER CHANGE OCCURRED
CREATE TABLE #wns_nm_DD_SHK_TIER_CHNG_MNTH AS (
	SELECT CUSTOMER_NO, FIN_MONTH AS LAST_TIER_CHANGE_MONTH, PREV_MNTH_TIER AS LAST_TIER, TIER AS CUSTOMER_CURRENT_TIER_CODE
	FROM (
		SELECT CUSTOMER_NO, FIN_MONTH, TIER, PREV_MNTH_TIER,
			   ROW_NUMBER() OVER(PARTITION BY CUSTOMER_NO ORDER BY FIN_MONTH DESC) AS LAST_CHNG_MNTH_RANK
		FROM #wns_nm_DD_SHK_TIER_LAST_TIER_LAG
		WHERE PREV_MNTH_TIER-TIER<>0)
	WHERE LAST_CHNG_MNTH_RANK=1
	GROUP BY 1,2,3,4)$[vLimit];
-- Execution time: 15.26s

--ADD LAST TIER AND TIER CHANGE MONTH INFORMATION TO THE TABLE WITH CURRENT TIER
CREATE TABLE #wns_nm_DD_SHK_CUSTOMER_TIER_DETAILS AS
	SELECT A.CUSTOMER_NO, A.CUSTOMER_CURRENT_TIER_CODE, LAST_TIER, LAST_TIER_CHANGE_MONTH
	FROM #wns_nm_DD_SHK_CUSTOMER_CURRENT_TIER A
	LEFT JOIN #wns_nm_DD_SHK_TIER_CHNG_MNTH B
	ON A.CUSTOMER_NO = B.CUSTOMER_NO$[vLimit];
-- Execution time: 7.58s

-- PREPARE LIST OF ALL UCIDS FROM TENDER TRIANGULATION OUTPUT DATA
CREATE TABLE #wns_nm_DD_CA_UCID_LIST AS (
	SELECT perm_ucid_hashed as UCID, CUSTOMER_NO
	FROM DEVELOPMENT.DIM_CUSTOMER_CARD_MAPPING
	WHERE CUSTOMER_NO IS NOT NULL AND UCID_TYPE = 'KNOWN'
	GROUP BY 1,2 )$[vLimit];
-- Execution time: 4.43s

-- ATTACH THE ABOVE CREATED TIER INFORMATION TO THE UCID LIST OF ALL CUSTOMERS
DROP TABLE IF EXISTS DEVELOPMENT.WNS_NM_WNS_SD_TIER_UCID_LEVEL_$[vDayName];
CREATE TABLE DEVELOPMENT.WNS_NM_WNS_SD_TIER_UCID_LEVEL_$[vDayName]
	DISTSTYLE ALL AS (
		SELECT UCID, LAST_TIER_CHANGE_MONTH, LAST_TIER, CUSTOMER_CURRENT_TIER_CODE
		FROM (
			SELECT CAST(A.UCID AS CHARACTER VARYING(30)), A.CUSTOMER_NO, B.LAST_TIER_CHANGE_MONTH, B.LAST_TIER, B.CUSTOMER_CURRENT_TIER_CODE,
				   ROW_NUMBER() OVER(PARTITION BY A.UCID ORDER BY B.CUSTOMER_CURRENT_TIER_CODE DESC, B.LAST_TIER_CHANGE_MONTH DESC, B.LAST_TIER DESC) AS TIER_RANK
			FROM #wns_nm_DD_CA_UCID_LIST A
			INNER JOIN #wns_nm_DD_SHK_CUSTOMER_TIER_DETAILS B
				ON A.CUSTOMER_NO=B.CUSTOMER_NO)
		WHERE TIER_RANK=1)$[vLimit];
-- Execution time: 13.89s



DROP TABLE IF EXISTS DEVELOPMENT.WNS_NM_WNS_DD_CA_TRAN_LEVEL_CAL_JOIN_$[vDayName];
CREATE TABLE DEVELOPMENT.WNS_NM_WNS_DD_CA_TRAN_LEVEL_CAL_JOIN_$[vDayName]
	DISTKEY(TRAN_DATE) COMPOUND SORTKEY(TRAN_DATE, LOCATION_NO, TILL_NO, TRAN_NO) AS (
		SELECT A.*,
				B.LOCATION_NAME, B.AREA_NO,	B.AREA_NAME, B.REGION_NO, B.REGION_NAME, B.CHAIN_NO,
				D.ST_S4S_SHAPE_OF_CHAIN_DESC AS SHAPE_OF_CHAIN_DESC,
				C.LAST_TIER_CHANGE_MONTH, C.LAST_TIER, C.CUSTOMER_CURRENT_TIER_CODE,H.tier_fy
				,H.tier_fq,H.tier_fh,H.tier_fm
		FROM #wns_nm_WNS_DD_CA_TRAN_LEVEL_CAL_JOIN A
		LEFT JOIN DEVELOPMENT.WNS_NM_WNS_SD_TIER_UCID_LEVEL_$[vDayName] C
				ON A.UCID = C.UCID
		LEFT JOIN ANALYTICS.FND_LOCATION B
				ON A.LOCATION_NO = B.LOCATION_NO
		LEFT JOIN DEVELOPMENT.FND_ROG_SOC_LOCATION D
				ON A.LOCATION_NO = D.LOCATION_NO
	/*	LEFT JOIN #wns_kr_tier_year_wise E
				ON A.fin_year_no = E.fin_year_no
					and A.UCID = E.UCID
		LEFT JOIN #wns_adj_tier_fq_wise_UCID F
		        ON A.fin_year_no = F.fin_year_no
		        and A.fin_quarter_no = F.quarter
					and A.UCID = F.UCID
        LEFT JOIN #wns_adj_tier_fh_wise_UCID G
		        ON A.fin_year_no = G.fin_year_no
		        and A.fin_half_no = G.half_year
					and A.UCID = G.UCID*/
        LEFT JOIN (select * from development.wns_adj_tier_wise$[vDayName] where fin_year_no>=2021 and fin_month_no>=3) H
		        ON A.fin_year_no = H.fin_year_no
		        and A.fin_month_no = H.fin_month_no
					and A.UCID = H.UCID

	)$[vLimit];
-- Execution time: 1m 42s

DROP TABLE IF EXISTS #wns_nm_DD_SHK_TIER_LAST_TIER_RAW;
DROP TABLE IF EXISTS #wns_nm_DD_SHK_TIER_LAST_TIER_LAG;
DROP TABLE IF EXISTS #wns_nm_DD_SHK_CUSTOMER_CURRENT_TIER;
DROP TABLE IF EXISTS #wns_nm_DD_SHK_TIER_CHNG_MNTH;
DROP TABLE IF EXISTS #wns_nm_DD_SHK_CUSTOMER_TIER_DETAILS;
DROP TABLE IF EXISTS #wns_nm_DD_CA_UCID_LIST;
DROP TABLE IF EXISTS #wns_nm_WNS_DD_CA_TRAN_LEVEL_CAL_JOIN;

/******************************************************************************************************************************************/
/* SCRIPT C - END                                                                                                         *****************/
/******************************************************************************************************************************************/






/******************************************************************************************************************************************/
/* SCRIPT D - Creating base table from $[vCBI] data with product & category details **********************************************/
/******************************************************************************************************************************************/

CREATE TABLE #wns_nm_DD_SHK_CUST_BASKET_ITEM_SUBSET_TEMP1
	DISTKEY(TRAN_DATE) COMPOUND SORTKEY(TRAN_DATE, LOCATION_NO, TILL_NO, TRAN_NO) AS (
		SELECT
		location_no
		,till_no
		,tran_no
		,tran_date
		,tran_time
		,item_seq_no
		,item_no
		,tran_type
		,item_tran_selling
		,case when vat_rate_perc is null then 0 else vat_rate_perc end as vat_rate_perc1
		,item_tran_qty
		,discount_selling
		,customer_no
		,waste_discount_selling
		,ROW_NUMBER() OVER(PARTITION BY TRAN_DATE, LOCATION_NO, TILL_NO, TRAN_NO, ITEM_SEQ_NO, ITEM_NO ORDER BY LAST_UPDATED_DATE DESC) AS LATEST_FLAG
	    ,vitality_uda_value
		FROM ANALYTICS.FND_CUST_BASKET_ITEM
		WHERE last_updated_date = '$[vlast_updated_date]')$[vLimit];
-- Execution time: 15m 26s

--deleting redundant rows
DELETE FROM #wns_nm_DD_SHK_CUST_BASKET_ITEM_SUBSET_TEMP1 WHERE LATEST_FLAG>1;

--+++++++++++++++++++++++++++++++++++++++++Start of Addition Of Markdown_seq_no++++++++++++++++++++++++++++++----
-- TEMPORARY table for rtl_clearance for zone =1 filter and nxt_active_date logic
drop table if exists #wns_adj_rtl_lag_temp;
create table #wns_adj_rtl_lag_temp as
select * from (
                select item_no,markdown_seq_no,active_date,reset_date,ruling_rsp,
                lag(active_date-1) over (partition by item_no order by active_date desc) as nxt_active_date
                from analytics.fnd_rtl_clearance where zone_no=1
)$[vLimit];
-- joining both above table and making a decision of last next_active_date data which is null.
drop table if exists #wns_adj_cbi_rtl_join;
create table #wns_adj_cbi_rtl_join
DISTKEY(TRAN_DATE) COMPOUND SORTKEY(TRAN_DATE, LOCATION_NO, TILL_NO, TRAN_NO,item_seq_no,item_no) as
select location_no,till_no,tran_no,tran_date,item_seq_no,A.item_no ,markdown_seq_no,active_date ,reset_date,ruling_rsp,
case when ruling_rsp>.01 then nvl(nxt_active_date ,reset_date-1) end as nxt_active_date
from (
      #wns_nm_DD_SHK_CUST_BASKET_ITEM_SUBSET_TEMP1 a
      left join
      #wns_adj_rtl_lag_temp b
      on a.item_no=b.item_no
      )$[vLimit];

drop table if exists #wns_adj_rtl_lag_temp;
-- Main logic of Markdown
drop table if exists #wns_adj_markdown_seq;
create table #wns_adj_markdown_seq
DISTKEY(TRAN_DATE) COMPOUND SORTKEY(TRAN_DATE, LOCATION_NO, TILL_NO, TRAN_NO,item_seq_no,item_no) as
select location_no,till_no,tran_no,tran_date,item_seq_no,item_no  ,nvl(markdown_seq_no,0) as markdown_seq_no from (
                select location_no,till_no,tran_no,tran_date,item_seq_no,item_no  ,max(markdown_seq_no) as markdown_seq_no
                from(
                    select location_no,till_no,tran_no,tran_date,item_seq_no,item_no ,
                    case when reset_date <= nxt_active_date
                              and tran_date between active_date and reset_date-1
                              and ruling_rsp>0.01
                              then markdown_seq_no else
                    case when reset_date > nxt_active_date
                              and tran_date between active_date and nxt_active_date
                              and ruling_rsp>0.01
                              then markdown_seq_no  end
                    end as markdown_seq_no
                    from #wns_adj_cbi_rtl_join
                    )
                group by location_no,till_no,tran_no,tran_date,item_seq_no,item_no
                )$[vLimit];


drop table if exists #wns_adj_cbi_rtl_join;
--+++++++++++++++++++++++++++++++++++++++++End of Addition Of Markdown_seq_no++++++++++++++++++++++++++++++----

drop table if exists #wns_nm_DD_SHK_CUST_BASKET_ITEM_SUBSET_TEMP;
create table #wns_nm_DD_SHK_CUST_BASKET_ITEM_SUBSET_TEMP
DISTKEY(TRAN_DATE) COMPOUND SORTKEY(TRAN_DATE, LOCATION_NO, TILL_NO, TRAN_NO) as
select A.*,B.tran_qty
from(
(select * from #wns_nm_DD_SHK_CUST_BASKET_ITEM_SUBSET_TEMP1) A
left join
(select * from(
select location_no,till_no,tran_no,tran_date,sum(item_tran_qty) as tran_qty from #wns_nm_DD_SHK_CUST_BASKET_ITEM_SUBSET_TEMP1
group by location_no,till_no,tran_no,tran_date
)
) B
ON A.TRAN_DATE = B.TRAN_DATE
AND A.LOCATION_NO = B.LOCATION_NO
AND A.TILL_NO = B.TILL_NO
AND A.TRAN_NO = B.TRAN_NO
)$[vLimit];

DROP TABLE IF EXISTS  #wns_nm_DD_SHK_CUST_BASKET_ITEM_SUBSET_TEMP1;
DROP TABLE IF EXISTS #wns_nm_fnd_item;
--DROP TABLE IF EXISTS #wns_nm_DD_SHK_CUST_BASKET_ITEM_SUBSET_TEMP;

-- Total script execution time: 0.02s
-- changed the code for phase2 promotion_no addition
CREATE TABLE #wns_nm_DD_SHK_CA_AUX_SUBSET
	DISTKEY(TRAN_DATE) COMPOUND SORTKEY(TRAN_DATE, LOCATION_NO, TILL_NO, TRAN_NO, ITEM_SEQ_NO,ITEM_NO) AS (
		SELECT LOCATION_NO, TRAN_DATE, TRAN_NO, TILL_NO, ITEM_NO, ITEM_SEQ_NO,
				1 AS PROMOTION_FLAG,
				TRAN_TYPE_CODE, sum(PROMOTION_DISCOUNT_AMOUNT) as PROMOTION_DISCOUNT_AMOUNT1
		FROM ANALYTICS.FND_CUST_BASKET_AUX
		WHERE last_updated_date = '$[vlast_updated_date]'
				AND PROMOTION_NO IS NOT NULL
				AND PROMOTION_NO <>''
				AND PROMOTION_DISCOUNT_AMOUNT > 0
				--AND TRAN_TYPE_CODE IN ('LOYALTY', 'WFS', 'RMS', 'ATG', 'ATGLOY', 'STAFF', 'EOL', 'FRANCHISE')
		GROUP BY 1,2,3,4,5,6,7,8)$[vLimit];

drop table if exists #wns_nm_DD_SHK_CA_AUX_SUBSET_UNPIVOTTED1 ;
CREATE TABLE #wns_nm_DD_SHK_CA_AUX_SUBSET_UNPIVOTTED1
	DISTKEY(TRAN_DATE) COMPOUND SORTKEY(TRAN_DATE, LOCATION_NO, TILL_NO, TRAN_NO, ITEM_SEQ_NO,ITEM_NO) AS (
		SELECT LOCATION_NO, TRAN_DATE, TRAN_NO, TILL_NO, ITEM_NO, ITEM_SEQ_NO,
				MAX(PROMOTION_FLAG) AS PROMOTION_FLAG,
				MAX(CASE WHEN TRAN_TYPE_CODE = 'LOYALTY' THEN 1 ELSE 0 END) AS LOYALTY_PROMO_FLAG,
				SUM(CASE WHEN TRAN_TYPE_CODE = 'LOYALTY' THEN PROMOTION_DISCOUNT_AMOUNT1 ELSE 0 END) AS LOYALTY_DISCOUNT_SELLING,
				SUM(CASE WHEN TRAN_TYPE_CODE = 'WFS' THEN PROMOTION_DISCOUNT_AMOUNT1 ELSE 0 END) AS WFS_DISCOUNT_SELLING,
				MAX(CASE WHEN TRAN_TYPE_CODE = 'RMS' THEN 1 ELSE 0 END) AS RMS_PROMO_FLAG,
				SUM(CASE WHEN TRAN_TYPE_CODE = 'RMS' THEN PROMOTION_DISCOUNT_AMOUNT1 ELSE 0 END) AS RMS_DISCOUNT_SELLING,
				MAX(CASE WHEN TRAN_TYPE_CODE = 'ATG' THEN 1 ELSE 0 END) AS ATG_PROMO_FLAG,
				SUM(CASE WHEN TRAN_TYPE_CODE = 'ATG' THEN PROMOTION_DISCOUNT_AMOUNT1 ELSE 0 END) AS ATG_DISCOUNT_SELLING,
				MAX(CASE WHEN TRAN_TYPE_CODE = 'ATGLOY' THEN 1 ELSE 0 END) AS ATGLOY_PROMO_FLAG,
				SUM(CASE WHEN TRAN_TYPE_CODE = 'ATGLOY' THEN PROMOTION_DISCOUNT_AMOUNT1 ELSE 0 END) AS ATG_LOYALTY_DISCOUNT_SELLING,
				MAX(CASE WHEN TRAN_TYPE_CODE = 'STAFF' THEN 1 ELSE 0 END) AS STAFF_PROMO_FLAG,
				SUM(CASE WHEN TRAN_TYPE_CODE = 'STAFF' THEN PROMOTION_DISCOUNT_AMOUNT1 ELSE 0 END) AS STAFF_DISCOUNT_SELLING,
				SUM(CASE WHEN TRAN_TYPE_CODE = 'CTV' THEN PROMOTION_DISCOUNT_AMOUNT1 ELSE 0 END) AS VOUCHER_DISCOUNT_SELLING,
				MAX(CASE WHEN TRAN_TYPE_CODE = 'EOL' THEN 1 ELSE 0 END) AS EOL_PROMO_FLAG,
				SUM(CASE WHEN TRAN_TYPE_CODE = 'EOL' THEN PROMOTION_DISCOUNT_AMOUNT1 ELSE 0 END) AS EOL_DISCOUNT_SELLING,
				MAX(CASE WHEN TRAN_TYPE_CODE = 'FRANCHISE' THEN 1 ELSE 0 END) AS FRANCHISE_PROMO_FLAG,
				SUM(CASE WHEN TRAN_TYPE_CODE NOT IN ('ATG', 'LOYALTY', 'ATGLOY', 'STAFF', 'WFS', 'EOL', 'RMS') THEN PROMOTION_DISCOUNT_AMOUNT1 ELSE 0 END) AS OTHER_DISCOUNT_SELLING,
				CASE WHEN (STAFF_DISCOUNT_SELLING = 0 AND ATG_DISCOUNT_SELLING + ATG_LOYALTY_DISCOUNT_SELLING + RMS_DISCOUNT_SELLING + LOYALTY_DISCOUNT_SELLING + EOL_DISCOUNT_SELLING + WFS_DISCOUNT_SELLING + OTHER_DISCOUNT_SELLING = 0) THEN 0
					 WHEN (STAFF_DISCOUNT_SELLING > 0 AND ATG_DISCOUNT_SELLING + ATG_LOYALTY_DISCOUNT_SELLING + RMS_DISCOUNT_SELLING + LOYALTY_DISCOUNT_SELLING + EOL_DISCOUNT_SELLING + WFS_DISCOUNT_SELLING + OTHER_DISCOUNT_SELLING > 0) THEN 1
					 WHEN (STAFF_DISCOUNT_SELLING > 0 AND ATG_DISCOUNT_SELLING + ATG_LOYALTY_DISCOUNT_SELLING + RMS_DISCOUNT_SELLING + LOYALTY_DISCOUNT_SELLING + EOL_DISCOUNT_SELLING + WFS_DISCOUNT_SELLING + OTHER_DISCOUNT_SELLING = 0) THEN 2
					 WHEN (STAFF_DISCOUNT_SELLING = 0 AND ATG_DISCOUNT_SELLING + ATG_LOYALTY_DISCOUNT_SELLING + RMS_DISCOUNT_SELLING + LOYALTY_DISCOUNT_SELLING + EOL_DISCOUNT_SELLING + WFS_DISCOUNT_SELLING + OTHER_DISCOUNT_SELLING > 0) THEN 3 END AS DISCOUNT_CODE
		FROM #wns_nm_DD_SHK_CA_AUX_SUBSET
		GROUP BY 1,2,3,4,5,6)$[vLimit];
-- Execution time: 2m 54s


drop table if exists #WNS_ADJ_PROMOTION_NO ;
create table #WNS_ADJ_PROMOTION_NO
DISTKEY(TRAN_DATE) COMPOUND SORTKEY(TRAN_DATE, LOCATION_NO, TILL_NO, TRAN_NO,ITEM_SEQ_NO,ITEM_NO) AS (
select location_no,till_no,tran_no,tran_date,item_no,item_seq_no,
		max(case when tran_type_code='RMS'  then promotion_no else
				case when tran_type_code='LOYALTY'
				-- check if any loyalty promotion_no is without prefixes also
				 then trim(SUBSTRING(promotion_no ,4,len(promotion_no)))  else
						case when tran_type_code='WFS' 	and trim(SUBSTRING(promotion_no ,0,4)) in ('WFS','888')
							then trim(SUBSTRING(promotion_no ,4,len(promotion_no)))  else
						case when tran_type_code='FRANCHISE'  then promotion_no
						end
					end
				end end) as RMS_PROMOTION_NO,
		max(case when tran_type_code='ATG '
					and trim(SUBSTRING(promotion_no ,0,6))='promo' then trim(SUBSTRING(promotion_no ,6,len(promotion_no)))
				when tran_type_code='ATG '
					and trim(SUBSTRING(promotion_no ,0,8))='bppromo' then trim(SUBSTRING(promotion_no ,8,len(promotion_no)))
				when tran_type_code='ATG '
					and trim(SUBSTRING(promotion_no ,0,3))='cq' then trim(SUBSTRING(promotion_no ,3,len(promotion_no)))
				when tran_type_code='ATG '
					and trim(SUBSTRING(promotion_no ,0,3))='sp' then trim(SUBSTRING(promotion_no ,3,len(promotion_no)	))
				when tran_type_code='ATG '
					and trim(SUBSTRING(promotion_no ,0,3))='bp' then trim(SUBSTRING(promotion_no ,3,len(promotion_no)))
				when tran_type_code='ATG '  then promotion_no
				end) as ATG_PROMOTION_NO ,
	 -- ATGLOY does not have any promotion_no with out "promo' prefix.
		max(case when tran_type_code='ATGLOY '
					and trim(SUBSTRING(promotion_no ,0,6))='promo' then trim(SUBSTRING(promotion_no ,6,len(promotion_no))) else
					case when tran_type_code='WFS '
					and trim(SUBSTRING(promotion_no ,0,6))='promo' then trim(SUBSTRING(promotion_no ,6,len(promotion_no))) end
					end) as ATG_LOYALTY_PROMOTION_NO  ,
		max(case when tran_type_code='EOL '  then promotion_no
		end) as EOL_PROMOTION_NO
from (select * from
		(select location_no,till_no,tran_no,tran_date,item_no,item_seq_no,tran_type_code,aux_seq_no,promotion_no,
          -- adding windowing function for find ing the min and then giving the flag for it.
          row_number() over (partition by location_no,till_no,tran_no,tran_date,item_no,item_seq_no,tran_type_code order by aux_seq_no asc) as aux_seq_no_rank
			from  ANALYTICS.FND_CUST_BASKET_AUX
      -- where location_no='1047' and till_no='11' and tran_no='43' and tran_date='2018-04-16'
			WHERE last_updated_date = '$[vlast_updated_date]'
				AND PROMOTION_NO IS NOT NULL
				AND PROMOTION_NO <>''
				AND PROMOTION_DISCOUNT_AMOUNT > 0
				AND TRAN_TYPE_CODE IN ('LOYALTY', 'WFS', 'RMS', 'ATG', 'ATGLOY', 'STAFF', 'EOL', 'FRANCHISE'))
       where  aux_seq_no_rank=1
	   )
group by location_no,till_no,tran_no,tran_date,item_no,item_seq_no)$[vLimit];

drop table if exists #wns_nm_DD_SHK_CA_AUX_SUBSET_UNPIVOTTED;
create table #wns_nm_DD_SHK_CA_AUX_SUBSET_UNPIVOTTED
DISTKEY(TRAN_DATE) COMPOUND SORTKEY(TRAN_DATE, LOCATION_NO, TILL_NO, TRAN_NO,ITEM_SEQ_NO,ITEM_NO) as
	select A.*,RMS_PROMOTION_NO,ATG_PROMOTION_NO,ATG_LOYALTY_PROMOTION_NO,EOL_PROMOTION_NO from (
	#wns_nm_DD_SHK_CA_AUX_SUBSET_UNPIVOTTED1 A
	left join
	#WNS_ADJ_PROMOTION_NO B
	ON A.TRAN_DATE=B.TRAN_DATE
	AND A.LOCATION_NO=B.LOCATION_NO
	AND A.TILL_NO=B.TILL_NO
	AND A.TRAN_NO=B.TRAN_NO
	AND A.item_seq_no=B.item_seq_no
	AND A.item_no=B.item_no)$[vLimit];


DROP TABLE IF EXISTS #wns_nm_DD_SHK_CA_AUX_SUBSET;

DROP TABLE IF EXISTS DEVELOPMENT.WNS_NM_WNS_DD_SHK_CA_TRAN_ITEM_LEVEL_CAL_JOIN_BU_$[vDayName];
CREATE TABLE DEVELOPMENT.WNS_NM_WNS_DD_SHK_CA_TRAN_ITEM_LEVEL_CAL_JOIN_BU_$[vDayName]
	DISTKEY(TRAN_DATE) COMPOUND SORTKEY(TRAN_DATE, LOCATION_NO, TILL_NO, TRAN_NO, ITEM_SEQ_NO,ITEM_NO) AS (
		SELECT A.*, LOYALTY_PROMO_FLAG, LOYALTY_DISCOUNT_SELLING, WFS_DISCOUNT_SELLING, RMS_PROMO_FLAG, RMS_DISCOUNT_SELLING, ATG_PROMO_FLAG,
				ATG_DISCOUNT_SELLING, ATGLOY_PROMO_FLAG, ATG_LOYALTY_DISCOUNT_SELLING, STAFF_PROMO_FLAG, STAFF_DISCOUNT_SELLING,VOUCHER_DISCOUNT_SELLING, EOL_PROMO_FLAG,
				EOL_DISCOUNT_SELLING, FRANCHISE_PROMO_FLAG, OTHER_DISCOUNT_SELLING,
				CASE WHEN PROMOTION_FLAG = 1 THEN 1 ELSE 0 END AS PROMO_FLAG,
				B.DISCOUNT_CODE,RMS_PROMOTION_NO,ATG_PROMOTION_NO,ATG_LOYALTY_PROMOTION_NO,EOL_PROMOTION_NO,markdown_seq_no
		FROM #wns_nm_DD_SHK_CUST_BASKET_ITEM_SUBSET_TEMP A
		LEFT JOIN #wns_nm_DD_SHK_CA_AUX_SUBSET_UNPIVOTTED B
		ON A.TRAN_DATE = B.TRAN_DATE
			AND A.LOCATION_NO = B.LOCATION_NO
			AND A.TILL_NO = B.TILL_NO
			AND A.TRAN_NO = B.TRAN_NO
			AND  A.ITEM_SEQ_NO = B.ITEM_SEQ_NO
			AND  A.ITEM_NO = B.ITEM_NO
		LEFT JOIN #wns_adj_markdown_seq C
		ON A.TRAN_DATE = C.TRAN_DATE
			AND A.LOCATION_NO = C.LOCATION_NO
			AND A.TILL_NO = C.TILL_NO
			AND A.TRAN_NO = C.TRAN_NO
			AND A.ITEM_SEQ_NO = C.ITEM_SEQ_NO
			AND A.ITEM_NO = C.ITEM_NO)$[vLimit];
-- Execution time: 19m 22s

DROP TABLE IF EXISTS #wns_nm_DD_SHK_CUST_BASKET_ITEM_SUBSET_TEMP;
DROP TABLE IF EXISTS #wns_nm_DD_SHK_CA_AUX_SUBSET_UNPIVOTTED;

/******************************************************************************************************************************************/
/* SCRIPT D - END                                                                                                         *****************/
/******************************************************************************************************************************************/

/******************************************************************************************************************************************/
/* SCRIPT 0 - Removing previous week's Base Table *****************************************************************************************/
/******************************************************************************************************************************************/

-- Moving previous week's Base Table to S3 Development External
-- unload ('select * from development.wns_cust_basket_item') --this part will change for the next wednesday
-- to 's3://woolworths-its-automation/marketing-automation/data/ttci/development/cust_basket_item_{3}'
-- iam_role 'arn:aws:iam::102116558525:role/etl_sulaco'
-- allowoverwrite
-- parallel on
-- partition by(tran_date)
-- parquet;

/******************************************************************************************************************************************/
/* SCRIPT 0 - END                                                                                                         *****************/
/******************************************************************************************************************************************/



/******************************************************************************************************************************************/
/* SCRIPT E - Final inner join of CUST_BASKET & $[vCBI] **************************************************************************/
/******************************************************************************************************************************************/

CREATE TABLE #WNS_CUST_BASKET_ITEM_TEMP
	DISTKEY(TRAN_DATE) COMPOUND SORTKEY(TRAN_DATE, LOCATION_NO, TILL_NO, TRAN_NO, ITEM_SEQ_NO,ITEM_NO) AS
	 (
		SELECT a.location_no, a.till_no, a.tran_no, a.tran_date,
				a.fin_year_no, a.fin_half_no, a.fin_quarter_no, a.fin_month_no, a.fin_week_no, a.fin_day_no,a.season_no,a.weekday_weekend_code,
				a.location_name, a.area_no, a.area_name, a.region_no, a.region_name, a.shape_of_chain_desc as alternate_location_hierarchy1,
				-1 as alternate_location_hierarchy2, -1 as alternate_location_hierarchy3 , -1 as alternate_location_hierarchy4,
				-1 as alternate_location_hierarchy5 , -1 as alternate_location_hierarchy6,
				a.tran_time,
				a.tran_type, a.tran_ind,
				a.tran_selling,
				a.tran_selling/(1+(vat_rate_perc1/100)) as tran_selling_vat_excl,--p2
				a.discount_selling,
				a.discount_selling/(1+(vat_rate_perc1/100)) as DISCOUNT_SELLING_VAT_EXCL,--p2
				a.store_card_tender_count, a.store_card_tran_tender_selling,
				a.credit_card_tender_count, a.credit_card_tran_tender_selling,
				a.gift_card_tender_count, a.gift_card_tran_tender_selling,
				a.voucher_tender_count, a.voucher_tran_tender_selling,
				a.alien_card_tender_count, a.alien_card_tran_tender_selling,
				a.cash_tender_ind, a.cash_tran_tender_selling,
				a.other_tender_count, a.other_tran_tender_selling,
				a.wrewards_swipe_ind, a.myschool_swipe_ind,a.VMP_IND,
				a.ucid,
				/*case when a.ucid_type in ('KNOWN') AND a.customer_current_tier_code IN (3,4) THEN 'WREWARDS Known VIP'
					when a.ucid_type in ('KNOWN') THEN 'WREWARDS Known Base'
					WHEN a.ucid_type in ('ORPHAN') THEN 'WREWARDS Orphan'
					WHEN a.ucid_type in ('NON-REWARDS') THEN 'Non-Rewards'
					else 'CASH'
					END AS CUSTOMER_COHORT,*/
				case when a.ucid_type in ('KNOWN') AND a.tier_fy IN (3,4) THEN 'WREWARDS Known VIP'
					  when a.ucid_type in ('KNOWN') THEN 'WREWARDS Known Base'
					  WHEN a.ucid_type in ('ORPHAN') THEN 'WREWARDS Orphan'
					  WHEN a.ucid_type in ('NON-REWARDS') THEN 'Non-Rewards'
				else 'CASH'
				END AS CUSTOMER_COHORT_FY,
				case when a.ucid_type in ('KNOWN') AND a.tier_fh IN (3,4) THEN 'WREWARDS Known VIP'
					  when a.ucid_type in ('KNOWN') THEN 'WREWARDS Known Base'
					  WHEN a.ucid_type in ('ORPHAN') THEN 'WREWARDS Orphan'
					  WHEN a.ucid_type in ('NON-REWARDS') THEN 'Non-Rewards'
				else 'CASH'
				END AS CUSTOMER_COHORT_FH,
				case when a.ucid_type in ('KNOWN') AND a.tier_fq IN (3,4) THEN 'WREWARDS Known VIP'
					  when a.ucid_type in ('KNOWN') THEN 'WREWARDS Known Base'
					  WHEN a.ucid_type in ('ORPHAN') THEN 'WREWARDS Orphan'
					  WHEN a.ucid_type in ('NON-REWARDS') THEN 'Non-Rewards'
				else 'CASH'
				END AS CUSTOMER_COHORT_FQ,
				case when a.ucid_type in ('KNOWN') AND a.tier_fm IN (3,4) THEN 'WREWARDS Known VIP'
					  when a.ucid_type in ('KNOWN') THEN 'WREWARDS Known Base'
					  WHEN a.ucid_type in ('ORPHAN') THEN 'WREWARDS Orphan'
					  WHEN a.ucid_type in ('NON-REWARDS') THEN 'Non-Rewards'
				else 'CASH'
				END AS CUSTOMER_COHORT_FM,
				a.acquisition_date,
				-1 as foods_life_cycle_code, -1 as fbh_life_cycle_code, -1 as ww_life_cycle_code,
		---1 as LAST_UPDATED_DATE,
				a.age,
				case when a.AGE between 18 and 24 then '18-24'
					 when a.AGE between 25 and 34 then '25-34'
					 when a.AGE between 35 and 44 then '35-44'
					 when a.AGE between 45 and 54 then '45-54'
					 when a.AGE>55 then '55+' else 'No Value' end as AGE_BAND,
				a.race as derived_race, a.gender,
				-1 as HOUSEHOLD_INCOME_BAND_FY,
				-1 as MACRO_SEGMENT_FY ,
				-1 as MICRO_SEGMENT_FY ,
				-1 as EMPLOYEE_STATUS_CODE,-- @adj sep
				b.item_seq_no, b.item_no,
				b.tran_type as item_tran_type,
				b.item_tran_selling,
				b.discount_selling as item_discount_selling,
				b.waste_discount_selling as WASTE_DISCOUNT_PERC,
				b.item_tran_selling/(1+(vat_rate_perc1/100)) as ITEM_TRAN_SELLING_VAT_EXCL,--p2
				b.discount_selling/(1+(vat_rate_perc1/100)) as ITEM_DISCOUNT_SELLING_VAT_EXCL,--p2
				b.vat_rate_perc1 as vat_rate_perc,
				b.vitality_uda_value as VITALITY_UDA_VALUE_NO,
				b.tran_qty,
				b.item_tran_qty,
				b.discount_code,
				b.RMS_PROMOTION_NO,b.ATG_PROMOTION_NO,b.ATG_LOYALTY_PROMOTION_NO,b.EOL_PROMOTION_NO,
				b.loyalty_discount_selling,
				b.rms_discount_selling,
				b.atg_discount_selling,
				b.atg_loyalty_discount_selling,
				b.staff_discount_selling,b.VOUCHER_DISCOUNT_SELLING,
				b.eol_discount_selling,
				b.wfs_discount_selling,
				b.other_discount_selling,
				b.loyalty_discount_selling/(1+(vat_rate_perc1/100)) as LOYALTY_DISCOUNT_SELLING_VAT_EXCL,--p2
				b.rms_discount_selling/(1+(vat_rate_perc1/100)) as RMS_DISCOUNT_SELLING_VAT_EXCL,--p2
				b.atg_discount_selling/(1+(vat_rate_perc1/100)) as ATG_DISCOUNT_SELLING_VAT_EXCL,--p2
				b.atg_loyalty_discount_selling/(1+(vat_rate_perc1/100)) as ATG_LOYALTY_DISCOUNT_SELLING_VAT_EXCL,--p2
				b.VOUCHER_DISCOUNT_SELLING/(1+(vat_rate_perc1/100)) as VOUCHER_DISCOUNT_SELLING_VAT_EXCL,--p2
				b.staff_discount_selling/(1+(vat_rate_perc1/100)) as STAFF_DISCOUNT_SELLING_VAT_EXCL,--p2
				b.eol_discount_selling/(1+(vat_rate_perc1/100)) as EOL_DISCOUNT_SELLING_VAT_EXCL,--p2
				b.wfs_discount_selling/(1+(vat_rate_perc1/100)) as WFS_DISCOUNT_SELLING_VAT_EXCL,--p2
				b.other_discount_selling/(1+(vat_rate_perc1/100)) as OTHER_DISCOUNT_SELLING_VAT_EXCL,--p2
				b.MARKDOWN_SEQ_NO
					FROM DEVELOPMENT.WNS_NM_WNS_DD_CA_TRAN_LEVEL_CAL_JOIN_$[vDayName] a
		INNER JOIN DEVELOPMENT.WNS_NM_WNS_DD_SHK_CA_TRAN_ITEM_LEVEL_CAL_JOIN_BU_$[vDayName] b
				ON A.TRAN_DATE = B.TRAN_DATE
					AND A.LOCATION_NO = B.LOCATION_NO
					AND A.TILL_NO = B.TILL_NO
					AND A.TRAN_NO = B.TRAN_NO
		WHERE a.chain_no<>30
				AND a.tran_type in ('S','V','R','Q'))$[vLimit];

DROP TABLE IF EXISTS DEVELOPMENT.WNS_NM_WNS_DD_SHK_CA_TRAN_ITEM_LEVEL_CAL_JOIN_BU_$[vDayName];
DROP TABLE IF EXISTS DEVELOPMENT.WNS_NM_WNS_DD_CA_TRAN_LEVEL_CAL_JOIN_$[vDayName];


DROP TABLE IF EXISTS #wns_kr_Tran_discount_selling_vat_exc;
Create Table #wns_kr_Tran_discount_selling_vat_exc
	DISTKEY(TRAN_DATE) COMPOUND SORTKEY(TRAN_DATE, LOCATION_NO, TILL_NO, TRAN_NO) as
select location_no,till_no,tran_no,tran_date , sum(ITEM_TRAN_SELLING_VAT_EXCL) as TRAN_SELLING_VAT_EXCL,
		sum(ITEM_DISCOUNT_SELLING_VAT_EXCL) as DISCOUNT_SELLING_VAT_EXCL
from #WNS_CUST_BASKET_ITEM_TEMP
group by 1,2,3,4
$[vLimit];



DROP TABLE IF EXISTS #wns_nm_fnd_item ;
create table #wns_nm_fnd_item diststyle all as (
	select item_no, B.BUSINESS_UNIT_LONG_DESC,B.BUSINESS_UNIT_NO,B.GROUP_NO,B.SUBGROUP_NO,B.DEPARTMENT_NO
			,B.CLASS_NO,B.SUBCLASS_NO,B.BUSINESS_UNIT_NAME,B.GROUP_NAME,B.SUBGROUP_NAME,B.DEPARTMENT_NAME,B.CLASS_NAME
			,B.SUBCLASS_NAME,B.ITEM_LEVEL1_NO,upper(b.ITEM_SHORT_DESC) AS ITEM_SHORT_DESC
			,B.GROUP_LONG_DESC,B.SUBGROUP_LONG_DESC,B.DEPARTMENT_LONG_DESC
	from ANALYTICS.FND_ITEM b
	group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19)$[vLimit];

DROP TABLE IF EXISTS #wns_kr_uda_info ;
Create Table #wns_kr_uda_info
	diststyle all as
(
	select item_no,
		 UDA_104_VALUE_DESC
		,UDA_104_VALUE_NO
		,UDA_300_VALUE_DESC
		,UDA_300_VALUE_NO
		,UDA_306_VALUE_DESC
		,UDA_306_VALUE_NO
		,UDA_310_VALUE_DESC
		,UDA_310_VALUE_NO
		,UDA_316_VALUE_DESC
		,UDA_316_VALUE_NO
		,UDA_320_VALUE_DESC
		,UDA_320_VALUE_NO
		,UDA_327_7703_7707_7708_VALUE_DESC
		,UDA_327_7703_7707_7708_VALUE_NO
		,UDA_2301_VALUE_DESC
		,UDA_2301_VALUE_NO
		,UDA_7702_VALUE_DESC
		,UDA_7702_VALUE_NO
		,UDA_7704_VALUE_DESC
		,UDA_7704_VALUE_NO
	from development.wns_hs_uda_value_and_desc
)
$[vLimit];

DROP TABLE IF EXISTS DEVELOPMENT.CUST_BASKET_ITEM_$[vDayName];
CREATE TABLE DEVELOPMENT.CUST_BASKET_ITEM_$[vDayName](
TRAN_DATE	date	encode zstd	,
LOCATION_NO	smallint	encode zstd	,
TILL_NO	smallint	encode zstd	,
TRAN_NO	integer	encode zstd	,
TRAN_TIME	varchar(8)		,
TRAN_IND	smallint		,
TRAN_TYPE	varchar(4)		,
TRAN_QTY	integer		,
TRAN_SELLING	numeric(14,2)	encode zstd	,
TRAN_SELLING_VAT_EXCL	numeric(14,2)	encode zstd	,
DISCOUNT_SELLING	numeric(14,2)	encode zstd	,
DISCOUNT_SELLING_VAT_EXCL	numeric(14,2)	encode zstd	,
FIN_YEAR_NO	smallint		,
FIN_HALF_NO	smallint		,
FIN_QUARTER_NO	smallint,
FIN_MONTH_NO	smallint		,
FIN_WEEK_NO	smallint		,
FIN_DAY_NO	smallint		,
SEASON_NO	smallint		,
WEEKDAY_WEEKEND_CODE	smallint		,
TIME_OF_DAY_CODE	smallint		,
ITEM_SEQ_NO	smallint	encode zstd	,
ITEM_NO	numeric(18)	encode zstd	,
ITEM_LEVEL1_NO	bigint	encode zstd	,
ITEM_SHORT_DESC	varchar(60)	encode zstd	,
ITEM_TRAN_TYPE	varchar(4)		,
ITEM_TRAN_QTY	integer		,
ITEM_TRAN_SELLING	numeric(14,2)	encode zstd	,
ITEM_TRAN_SELLING_VAT_EXCL	numeric(14,2)	encode zstd	,
ITEM_DISCOUNT_SELLING	numeric(14,2)		,
ITEM_DISCOUNT_SELLING_VAT_EXCL	numeric(14,2)		,
WASTE_DISCOUNT_PERC	numeric(14,2)		,
VAT_RATE_PERC	numeric(4,2)		,
COLOUR_FAMILY	varchar(50)		,
BUSINESS_UNIT_NO	smallint		,
BUSINESS_UNIT_NAME	varchar(40)		,
GROUP_NO	smallint		,
GROUP_NAME	varchar(40)	encode zstd	,
SUBGROUP_NO	smallint		,
SUBGROUP_NAME	varchar(40)	encode zstd	,
DEPARTMENT_NO	smallint		,
DEPARTMENT_NAME	varchar(40)	encode zstd	,
CLASS_NO	smallint	encode zstd	,
CLASS_NAME	varchar(40)	encode zstd	,
SUBCLASS_NO	smallint	encode zstd	,
SUBCLASS_NAME	varchar(40)	encode zstd	,
ALTERNATE_PRODUCT_HIERARCHY1	varchar(15)		,
ALTERNATE_PRODUCT_HIERARCHY2	varchar(9)		,
ALTERNATE_PRODUCT_HIERARCHY3	varchar(31)	encode zstd	,
ALTERNATE_PRODUCT_HIERARCHY4	varchar(35)		,
ALTERNATE_PRODUCT_HIERARCHY5	varchar(6)		,
ALTERNATE_PRODUCT_HIERARCHY6	varchar(36)		,
SALES_CHANNEL_CODE	smallint		,
AREA_NO	smallint		,
AREA_NAME	varchar(40)		,
REGION_NO	smallint		,
REGION_NAME	varchar(40)		,
LOCATION_NAME	varchar(40)		,
ALTERNATE_LOCATION_HIERARCHY1	varchar(40)		,
ALTERNATE_LOCATION_HIERARCHY2	smallint		,
ALTERNATE_LOCATION_HIERARCHY3	smallint		,
ALTERNATE_LOCATION_HIERARCHY4	smallint		,
ALTERNATE_LOCATION_HIERARCHY5	smallint		,
ALTERNATE_LOCATION_HIERARCHY6	smallint		,
DISCOUNT_CODE	smallint		,
RMS_PROMOTION_NO	varchar(25)		,
ATG_PROMOTION_NO	varchar(25)		,
ATG_LOYALTY_PROMOTION_NO	varchar(25)		,
EOL_PROMOTION_NO	varchar(25)		,
RMS_DISCOUNT_SELLING	numeric(14,2)		,
RMS_DISCOUNT_SELLING_VAT_EXCL	numeric(14,2)		,
LOYALTY_DISCOUNT_SELLING	numeric(14,2)		,
LOYALTY_DISCOUNT_SELLING_VAT_EXCL	numeric(14,2)		,
ATG_DISCOUNT_SELLING	numeric(14,2)		,
ATG_DISCOUNT_SELLING_VAT_EXCL	numeric(14,2)		,
ATG_LOYALTY_DISCOUNT_SELLING	numeric(14,2)		,
ATG_LOYALTY_DISCOUNT_SELLING_VAT_EXCL	numeric(14,2)		,
EOL_DISCOUNT_SELLING	numeric(14,2)		,
EOL_DISCOUNT_SELLING_VAT_EXCL	numeric(14,2)		,
WFS_DISCOUNT_SELLING	numeric(14,2)		,
WFS_DISCOUNT_SELLING_VAT_EXCL	numeric(14,2)		,
STAFF_DISCOUNT_SELLING	numeric(14,2)		,
STAFF_DISCOUNT_SELLING_VAT_EXCL	numeric(14,2)		,
VOUCHER_DISCOUNT_SELLING	numeric(14,2)		,
VOUCHER_DISCOUNT_SELLING_VAT_EXCL	numeric(14,2)		,
OTHER_DISCOUNT_SELLING	numeric(14,2)		,
OTHER_DISCOUNT_SELLING_VAT_EXCL	numeric(14,2)		,
MARKDOWN_SEQ_NO	smallint		,
STORE_CARD_TENDER_COUNT	smallint		,
STORE_CARD_TRAN_TENDER_SELLING	numeric(14,2)		,
CREDIT_CARD_TENDER_COUNT	smallint		,
CREDIT_CARD_TRAN_TENDER_SELLING	numeric(14,2)		,
GIFT_CARD_TENDER_COUNT	smallint		,
GIFT_CARD_TRAN_TENDER_SELLING	numeric(14,2)		,
ALIEN_CARD_TENDER_COUNT	smallint		,
ALIEN_CARD_TRAN_TENDER_SELLING	numeric(14,2)	encode zstd	,
CASH_TENDER_IND	integer		,
CASH_TRAN_TENDER_SELLING	numeric(14,2)		,
OTHER_TENDER_COUNT	smallint		,
OTHER_TRAN_TENDER_SELLING	numeric(14,2)		,
--VOUCHER_NO	integer	,
VOUCHER_TENDER_COUNT	smallint		,
VOUCHER_TRAN_TENDER_SELLING	numeric(14,2)		,
UCID	varchar(100)	encode zstd	,
CUSTOMER_COHORT_FY	varchar(19)		,
CUSTOMER_COHORT_FH	varchar(19)		,
CUSTOMER_COHORT_FQ	varchar(19)		,
CUSTOMER_COHORT_FM	varchar(19)		,
CUSTOMER_COHORT_FW	varchar(19)		,
AGE	smallint		,
AGE_BAND_FY	varchar(8)		,
AGE_BAND_FH	varchar(8)		,
AGE_BAND_FQ	varchar(8)		,
AGE_BAND_FM	varchar(8)		,
AGE_BAND_FW	varchar(8)		,
GENDER	varchar(8)		,
DERIVED_RACE	varchar(30)		,
ACQUISITION_DATE	date	encode zstd	,
HOUSEHOLD_INCOME_BAND_FY	smallint		,
MACRO_SEGMENT_FY 	smallint		,
MICRO_SEGMENT_FY 	smallint		,
EMPLOYEE_STATUS_CODE	smallint		,
STORE_CARD_COUNT	smallint		,
WREWARDS_CARD_COUNT	smallint		,
MYSCHOOL_CARD_COUNT	smallint		,
CREDIT_CARD_COUNT	smallint		,
LITTLEWORLD_MEMBERSHIP_COUNT	smallint		,
VITALITY_MEMBERSHIP_COUNT	smallint		,
NON_REWARDS_CARD_COUNT	smallint		,
UDA_104_VALUE_NO	varchar(100)		,
UDA_104_VALUE_DESC	varchar(100)		,
UDA_300_VALUE_NO	varchar(100)		,
UDA_300_VALUE_DESC	varchar(100)		,
UDA_306_VALUE_NO	varchar(100)		,
UDA_306_VALUE_DESC	varchar(100)		,
UDA_310_VALUE_NO	varchar(100)		,
UDA_310_VALUE_DESC	varchar(100)		,
UDA_316_VALUE_NO	varchar(100)		,
UDA_316_VALUE_DESC	varchar(100)		,
UDA_320_VALUE_NO	varchar(100)		,
UDA_320_VALUE_DESC	varchar(100)		,
UDA_327_7703_7707_7708_VALUE_NO	varchar(100)		,
UDA_327_7703_7707_7708_VALUE_DESC	varchar(100)		,
UDA_2301_VALUE_NO	varchar(100)		,
UDA_2301_VALUE_DESC	varchar(100)		,
UDA_7702_VALUE_NO	varchar(100)		,
UDA_7702_VALUE_DESC	varchar(100)		,
UDA_7704_VALUE_NO	varchar(100)		,
UDA_7704_VALUE_DESC	varchar(100)		,
VITALITY_UDA_VALUE_NO	smallint		,
WREWARDS_SWIPE_IND	boolean		,
MYSCHOOL_SWIPE_IND	boolean		,
VMP_IND			smallint,
BASKET_ID	varchar(118)		,
LAST_UPDATED_DATE	date

)
DISTSTYLE KEY
DISTKEY (tran_date)
SORTKEY (tran_date, location_no, till_no, tran_no, item_seq_no, item_no)  ;
-- end of schema
INSERT INTO DEVELOPMENT.CUST_BASKET_ITEM_$[vDayName]
 (
		SELECT a.tran_date, a.location_no, a.till_no, a.tran_no,
				a.tran_time,a.tran_ind,a.tran_type,nvl(a.tran_qty,0) as TRAN_QTY,
				nvl(a.tran_selling,0) as tran_selling ,nvl(e.tran_selling_vat_excl,0) as tran_selling_vat_excl ,--p2
				nvl(a.discount_selling,0) as discount_selling,nvl(e.DISCOUNT_SELLING_VAT_EXCL,0) as DISCOUNT_SELLING_VAT_EXCL,--p2
				a.fin_year_no, a.fin_half_no, a.fin_quarter_no, a.fin_month_no,
				a.fin_week_no, a.fin_day_no,a.season_no,a.weekday_weekend_code,
				case when TRAN_TIME between '07:00:00' and '08:59:59' then 1
					 when TRAN_TIME between '09:00:00' and '11:59:59' then 2
					 when TRAN_TIME between '12:00:00' and '14:59:59' then 3
					 when TRAN_TIME between '15:00:00' and '17:59:59' then 4
					 when TRAN_TIME between '18:00:00' and '20:59:59' then 5
					 when TRAN_TIME between '21:00:00' and '23:59:59' then 6
					 when TRAN_TIME between '00:00:00' and '06:59:59' then 6
					else -1 --[KR]:else condition as 'No Value'
				end as TIME_OF_DAY_CODE,a.item_seq_no,
				nvl(a.item_no,0) as item_no, nvl(b.item_level1_no,0) as item_level1_no,
				nvl(b.ITEM_SHORT_DESC,'NO VALUE') as ITEM_SHORT_DESC,
				a.item_tran_type,nvl(a.item_tran_qty,0) as item_tran_qty,
				nvl(a.item_tran_selling,0) as item_tran_selling,nvl(a.ITEM_TRAN_SELLING_VAT_EXCL,0) as ITEM_TRAN_SELLING_VAT_EXCL,--p2
				nvl(a.item_discount_selling,0) as item_discount_selling, nvl(a.ITEM_DISCOUNT_SELLING_VAT_EXCL,0) as ITEM_DISCOUNT_SELLING_VAT_EXCL,--p2
				nvl(a.WASTE_DISCOUNT_PERC,0) as WASTE_DISCOUNT_PERC,nvl(a.vat_rate_perc,0) as vat_rate_perc,
				nvl(c.DIFF_RANGE_DESC,'NO VALUE') as colour_family ,nvl(B.BUSINESS_UNIT_NO,0) as BUSINESS_UNIT_NO,
				nvl(B.BUSINESS_UNIT_NAME,'NO VALUE') as BUSINESS_UNIT_NAME ,nvl(B.GROUP_NO,0) as GROUP_NO,
				nvl(B.GROUP_NAME,'NO VALUE') as GROUP_NAME,nvl(B.SUBGROUP_NO,0) as SUBGROUP_NO,nvl(B.SUBGROUP_NAME,'NO VALUE') as SUBGROUP_NAME, nvl(B.DEPARTMENT_NO,0) as DEPARTMENT_NO,nvl(B.DEPARTMENT_NAME,'NO VALUE') as DEPARTMENT_NAME,nvl(B.CLASS_NO,0) as CLASS_NO,nvl(B.CLASS_NAME,'NO VALUE') as CLASS_NAME,nvl(B.SUBCLASS_NO,0) as SUBCLASS_NO,nvl(B.SUBCLASS_NAME,'NO VALUE') as SUBCLASS_NAME,
				case when BUSINESS_UNIT_NO=50 then 'Food'
					 when BUSINESS_UNIT_NO in (51,52,53,54,55) then 'FBH'
					 when BUSINESS_UNIT_NO=70 then 'Non-Merchandise'
				else 'Others' end as ALTERNATE_PRODUCT_HIERARCHY1 ,
				case when GROUP_NO in (9000,9001,9002,9010,9041) then 'Long-Life'
					 when GROUP_NO in (9004,9005,9006,9007,9008,9009) then 'Fresh'
					 when BUSINESS_UNIT_NO=51 then 'Fashion'
					 when BUSINESS_UNIT_NO=52 and SUBGROUP_NO<>715 then 'Home'
					 when BUSINESS_UNIT_NO=53 then 'Connect'
					 when BUSINESS_UNIT_NO=54 then 'Beauty'
					 when BUSINESS_UNIT_NO=55 then 'CRG'
				else 'Others' end as ALTERNATE_PRODUCT_HIERARCHY2 ,
				case when GROUP_NO=1 then 'Womens Outerwear'
					 when GROUP_NO=2 then 'Womens Lingerie'
					 when GROUP_NO=3 then 'Kidswear'
					 when GROUP_NO=4 then 'Trenery'
					 when GROUP_NO=5 then 'Menswear'
					 when GROUP_NO=6 then 'Womens Footwear and Accessories'
					 when DEPARTMENT_NO=172 then 'Bathroom'
					 when DEPARTMENT_NO=173 then 'Bedroom'
					 when DEPARTMENT_NO=174 then 'Soft Furnishing'
					 when DEPARTMENT_NO=176 then 'Kitchen'
					 when DEPARTMENT_NO=521 then 'Dining'
					 when DEPARTMENT_NO=544 then 'Wrapping Solutions'
					 when DEPARTMENT_NO in (695,696) then 'Home Brands'
					 when DEPARTMENT_NO=697 then 'Events'
					 when SUBGROUP_NO=280 then 'Beauty Private Label'
					 when SUBGROUP_NO=233 then 'Beauty Brands'
					 when SUBGROUP_NO=212 then 'Airtime'
					 when SUBGROUP_NO=446 then 'Cellular'
					 when GROUP_NO=12 then 'Country Road'
					 when GROUP_NO=13 then 'Witchery'
					 when GROUP_NO=14 then 'Mimco'
					 when GROUP_NO=9000 then 'Groceries'
					 when GROUP_NO=9001 then 'Wine/Beverages/Liquor'
					 when GROUP_NO=9002 then 'Snacking/Gifting'
					 when GROUP_NO=9004 then 'Prepaded/Deli'
					 when GROUP_NO=9005 then 'Bakery'
					 when GROUP_NO=9006 then 'Produce/Horti'
					 when GROUP_NO=9007 then 'Protein'
					 when GROUP_NO=9008 then 'Dairy'
					 when GROUP_NO=9009 then 'Foodservices'
					 when GROUP_NO=9010 then 'Home/Personal/Pet'
					 when GROUP_NO=9041 then 'Frozens'
					 when BUSINESS_UNIT_NO=70 then 'Non-Merchandise'
				else 'Others' end as ALTERNATE_PRODUCT_HIERARCHY3 ,
				case when BUSINESS_UNIT_NO=50 then 'Others'
					 when GROUP_NO=4 then 'Trenery'
					 when GROUP_NO=12 then 'Country Road'
					 when GROUP_NO=13 then 'Witchery'
					 when GROUP_NO=14 then 'Mimco'
					 when SUBGROUP_NO in (93,261) then 'Classic Collection'
					 when DEPARTMENT_NO=684 then 'Classic Collection'
					 when DEPARTMENT_NO in (105,110,147,665,678,682,692,712) then 'EDITION.'
					 when DEPARTMENT_NO in (107,139,519,658,685,695) then 'studio.w'
					 when DEPARTMENT_NO in (109,150,659) then 'RE:'
					 when DEPARTMENT_NO=512 then 'jtone'
					 when DEPARTMENT_NO=698 then 'Distraction'
					 when DEPARTMENT_NO=664 then 'Soft and Flexy'
					 when DEPARTMENT_NO=123 then 'Modern'
					 when DEPARTMENT_NO in (702,704) then 'SAF'
					 when DEPARTMENT_NO in (163,687,158) then '(&US)'
					 when DEPARTMENT_NO=650 then 'Early Learning Centre'
					 when DEPARTMENT_NO in (159,548) and SUBCLASS_NO not in (1274,1987,9229) then 'Schoolwear'
					 when DEPARTMENT_NO in (119,121,126,696) then 'W Collection'
					 when DEPARTMENT_NO=526 then 'Sanctuary'
					 when DEPARTMENT_NO=651 then 'Eye Candy'
					 when DEPARTMENT_NO=654 then 'Fox Box'
					 when DEPARTMENT_NO=707 then 'Clarins'
					 when DEPARTMENT_NO=193 then 'MTN'
					 when DEPARTMENT_NO=194 then 'Vodacom'
					 when DEPARTMENT_NO=195 then 'Cell C'
					 when DEPARTMENT_NO=532 then 'Telkom'
					 when CLASS_NO in (1701,3227,3576,4976,5602) then 'Classic Collection'
					 when CLASS_NO in (1136,1706,2686,3232,4384,4973,5120,5607) then 'Modern'
					 when CLASS_NO in (2229,1285) then 'studio.w'
					 when CLASS_NO in (1255,1266) then 'AU'
					 when CLASS_NO=1132 then 'Lingerie Collection'
					 when CLASS_NO=1608 then 'Premium Collection'
					 when CLASS_NO in (1090,1278) then '(&US)'
					 when CLASS_NO in (1859,1882) then 'Walkmates'
					 when CLASS_NO in (1455,1459,1460) and SUBCLASS_NO not in (3954,9049) then 'W Beauty'
					 when CLASS_NO=1797 then 'Longmarket'
					 when CLASS_NO=4716 then 'QVS'
					 when CLASS_NO=5345 then 'SAVI'
					 when CLASS_NO=1013 then 'Payot'
					 when CLASS_NO=1035 then 'Ciate'
					 when CLASS_NO=1070 then 'MSLONDON'
					 when CLASS_NO=1078 then 'Billion Dollar Brows'
					 when CLASS_NO=1146 then 'Chanel'
					 when CLASS_NO=1170 then 'Glam Glow'
					 when CLASS_NO=1183 then 'Estee Lauder'
					 when CLASS_NO=1188 then 'Clinique'
					 when CLASS_NO=1198 then 'Bobbi Brown'
					 when CLASS_NO=1383 then 'Alaia'
					 when CLASS_NO=1400 then 'Bvlgari'
					 when CLASS_NO=1411 then 'Burberry'
					 when CLASS_NO=1416 then 'Issey Miyake'
					 when CLASS_NO=1436 then 'Coach'
					 when CLASS_NO=1443 then 'Elie Saab'
					 when CLASS_NO=1453 then 'Hermes'
					 when CLASS_NO=1461 then 'Narciso Rodriguez'
					 when CLASS_NO=1474 then 'Clarins'
					 when CLASS_NO=1540 then 'Elizabeth Arden'
					 when CLASS_NO=1550 then 'Lancome'
					 when CLASS_NO=1557 then 'La Prairie'
					 when CLASS_NO=1563 then 'Dr. Hauschka'
					 when CLASS_NO=1568 then 'Hugo Boss'
					 when CLASS_NO=1572 then 'Lacoste'
					 when CLASS_NO=1576 then 'Gucci'
					 when CLASS_NO=1580 then 'Mugler'
					 when CLASS_NO=1584 then 'Azzaro'
					 when CLASS_NO=1588 then 'Calvin Klein'
					 when CLASS_NO=1592 then 'Cartier'
					 when CLASS_NO=1596 then 'Davidoff'
					 when CLASS_NO=1604 then 'Givenchy'
					 when CLASS_NO=1610 then 'Marc Jacobs'
					 when CLASS_NO=1617 then 'Chloe'
					 when CLASS_NO=1627 then 'Joop'
					 when CLASS_NO=1633 then 'Missoni'
					 when CLASS_NO=1657 then 'Paco Rabanne'
					 when CLASS_NO=1661 then 'Valentino'
					 when CLASS_NO=1665 then 'Versace'
					 when CLASS_NO=1669 then 'Donna Karan'
					 when CLASS_NO=1673 then 'Aramis'
					 when CLASS_NO=1676 then 'Michael Kors'
					 when CLASS_NO=1681 then 'Zegna'
					 when CLASS_NO=1684 then 'Lab Series'
					 when CLASS_NO=1688 then 'Jean Paul Gaultier'
					 when CLASS_NO=1692 then 'Zadig&Voltaire'
					 when CLASS_NO=1696 then 'Van Cleef & Arpels'
					 when CLASS_NO=1703 then 'Stella Mccartney'
					 when CLASS_NO=1709 then 'Alexander Mcqueen'
					 when CLASS_NO=1712 then 'Carolina Herrera'
					 when CLASS_NO=1722 then 'Roberto Cavalli'
					 when CLASS_NO=1777 then 'Yves Saint Laurent'
					 when CLASS_NO=1781 then 'Giorgio Armani'
					 when CLASS_NO=1785 then 'Dolce&Gabanna'
					 when CLASS_NO=1801 then 'La Mer'
					 when CLASS_NO=1806 then 'Tom Ford Beauty'
					 when CLASS_NO=1815 then 'Jo Malone London'
					 when CLASS_NO=1825 then 'Salvatore Ferragamo'
					 when CLASS_NO=1848 then 'Cowshed'
					 when CLASS_NO=1855 then 'LOCCITANE'
					 when CLASS_NO=2024 then 'Mont Blanc'
					 when CLASS_NO=2028 then 'Dunhill'
					 when CLASS_NO=2083 then 'Charlotte Rhys'
					 when CLASS_NO=2135 then 'Suki Suki Naturals'
					 when CLASS_NO=2137 then 'Skin Creamery'
					 when CLASS_NO=2139 then 'Acqua Di Parma'
					 when CLASS_NO=2144 then 'Vita Liberata'
					 when CLASS_NO=3527 then 'Nesti Soaps'
					 when CLASS_NO=4118 then 'Dior'
					 when CLASS_NO=4804 then 'Revlon'
					 when CLASS_NO=4820 then 'Stila'
					 when CLASS_NO=5413 then 'Morgan Taylor'
					 when CLASS_NO=5472 then 'Opi'
					 when CLASS_NO=5927 then 'Nuxe'
					 when CLASS_NO=5951 then 'Sampar'
					 when CLASS_NO=9068 then 'Ren'
					 when CLASS_NO=9070 then 'Decleor'
					 when CLASS_NO=9071 then 'Gatineau'
					 when CLASS_NO=9085 then 'Mavala'
					 when CLASS_NO=9122 then 'Vichy'
					 when CLASS_NO=9147 then 'Smashbox'
					 when CLASS_NO=9159 then 'Tommy Hilfiger'
					 when CLASS_NO=9369 then 'Yves Rocher'
					 when CLASS_NO in (5306,5321,5324) then 'Telkom'
					 when CLASS_NO=5310 then 'Cell C'
					 when CLASS_NO=5314 then 'MTN'
					 when CLASS_NO=5318 then 'Neotel'
					 when CLASS_NO=5327 then 'Virgin'
					 when CLASS_NO=5331 then 'Vodacom'
					 when SUBCLASS_NO in (1302,1307,1324,2547,2552,2553,2554,2680,2685,3301,3303,3429,3766,5876,3860,3863,3867,4621,4754,4856,
											 4868,4870,5128,5129,5728,7141) then 'Classic Collection'
					 when SUBCLASS_NO in (2378,2681,2683,2684,3096,3393,3765,3811,3861,3864,3868,3978,4304,5609,5611,5875,7015) then 'Modern'
					 when SUBCLASS_NO in (2548,2550,2551,3012,3010,5126,5125,5132,7146) then 'EDITION.'
					 when SUBCLASS_NO in (1121,1129,1134,1138,1140,1308,1317,1811,2465,3009,4622,5062) then 'studio.w'
					 when SUBCLASS_NO in (1125,1130,1137,1139,1142,1316,1318,1812,2467,3453,7179) then 'RE:'
					 when SUBCLASS_NO in (3954,4214,4467,9163,9049) then 'jtone'
					 when SUBCLASS_NO in (1274,1987,9229) then 'Walkmates'
					 when SUBCLASS_NO in (5157,5158,5159,5160) then 'Heatgen'
					 when SUBCLASS_NO=1814 then 'Branded Kitchen Appliances'
					 when SUBCLASS_NO=5989 then 'Branded Kitchen Cookware'
					 when SUBCLASS_NO=5990 then 'Branded Kitchen Kitchen Accessories'
					 when SUBCLASS_NO=5991 then 'Branded Kitchen Knives'
					 when SUBCLASS_NO=5993 then 'Branded Dining Drinkware'
					 when SUBCLASS_NO=5994 then 'Branded Dining Cutlery'
					 when SUBCLASS_NO=1833 then 'Bath Time'
					 when SUBCLASS_NO=2034 then 'Le Bain'
					 when SUBCLASS_NO=2207 then 'Every Day'
					 when SUBCLASS_NO=3100 then 'Unwind'
					 when SUBCLASS_NO=3403 then 'African'
					 when SUBCLASS_NO=4536 then 'Ingredients'
					 when SUBCLASS_NO=4537 then 'Fresh Delights'
					 when SUBCLASS_NO=4774 then 'Love Your Skin'
					 when SUBCLASS_NO=9025 then 'Extracts From Nature'
					 when SUBCLASS_NO=1253 then 'Simply Florals'
					 when SUBCLASS_NO=2021 then 'Belle Maison'
					 when SUBCLASS_NO=2896 then 'Classic Collection'
					 when SUBCLASS_NO=5154 then 'Bliss'
					 when SUBCLASS_NO=5861 then 'AG Mobile'
					 when SUBCLASS_NO=5862 then 'Mobicel'
					 when SUBCLASS_NO=5955 then 'Hisense'
				else 'Others' end as ALTERNATE_PRODUCT_HIERARCHY4 ,
				case when BUSINESS_UNIT_NO=50 then 'Others'
					 when GROUP_NO in (1,2,6,14) then 'Women'
					 when GROUP_NO=5 then 'Men'
					 when GROUP_NO=3 then 'Kids'
					 when SUBGROUP_NO in (392,422,426) then 'Women'
					 when SUBGROUP_NO in (423,427) then 'Men'
					 when SUBGROUP_NO in (337,393,424) then 'Kids'
					 when DEPARTMENT_NO in (108,112,113,119,121,126,139,514,526,554,610,651,654,683,707) then 'Women'
					 when DEPARTMENT_NO in (141,552,642) then 'Men'
					 when DEPARTMENT_NO=136 then 'Kids'
					 when CLASS_NO in (1013,1035,1070,1078,1170,1198,1383,1421,1443,1451,1455,1540,1550,1557,1563,1610,1617,1633,1703,1709,
										 1797,1801,1855,2135,2137,2144,3527,4118,4820,5413,5472,5927,5951,9068,9071,9085,9147,9369) then 'Women'
					 when CLASS_NO in (1673,1681,1684,2028) then 'Men'
					 when CLASS_NO in (1714,2044,4014,2035,2047) then 'Kids'
					 when SUBCLASS_NO in (1406,1413,1427,1442,1457,1549,1556,1562,1567,1844,1966,2401,2756,3471,4214,4463,4467,4725,4805,4806,
										4807,4808,4809,4810,5293,5857,8698,9020,9021,9022,9049,9081,9082,9126,9163,1467,1570,1574,1578,1582,1586,1590,1594,1606,
										1599,1690,1694,1699,1720,1754,1779,1783,1787,1826,2026,1629,1659,1663,1667,1671,1678,3677,1147,1148,1154,1160,1184,1185,
										1794,1190,1191,1195,1490,1507,1522,1523,1807,1823,1834) then 'Women'
				     when SUBCLASS_NO in (1410,1415,1435,1458,1824,2402,2757,4038,4469,4811,5858,8687,9032,9083,1468,1571,1575,1579,1583,1587,
											1591,1595,1607,1601,1691,1695,1702,1721,1776,1780,1784,1788,1827,2027,1632,1660,1664,1668,1672,1680,3680,1162,1186,1196,
											1537,1809) then 'Men'
				     when SUBCLASS_NO in (2384,4799,6043,9034,9051) then 'Kids'
                else 'Others' end as ALTERNATE_PRODUCT_HIERARCHY5 ,
				case when BUSINESS_UNIT_NO=50 then 'Others'
					 when GROUP_NO=1 then 'Outerwear'
					 when GROUP_NO=14 and CLASS_NO<>5248 then 'Accessories'
					 when GROUP_NO=7 then 'Homeware'
					 when GROUP_NO=9 then 'Cellular and Airtime'
					 when SUBGROUP_NO in (261,750) and CLASS_NO not in (1790,4296,4588) then 'Outerwear'
					 when SUBGROUP_NO=200 then 'Footwear'
					 when SUBGROUP_NO=366 then 'Accessories'
					 when SUBGROUP_NO=290 then 'Underwear'
					 when SUBGROUP_NO in (425,753) then 'Homeware'
					 when SUBGROUP_NO=754 then 'Beauty Services'
					 when DEPARTMENT_NO in (108,112,113,119,121,130,136,141,157,158,159,162,163,514,523,528,537,548,551,552,554,566,570,575,
											 576,577,578,580,583,589,590,610,642,670,673,674,683,687)
					 and CLASS_NO not in (1270,1275,1329,1330,4401,5918,9192,9391,
											 9478,9479,9494,9495,9531,9533,9551,9555) then 'Outerwear'
					 when DEPARTMENT_NO in (123,153,160,165,684) and SUBCLASS_NO not in (4072,4183,6529,6546) then 'Sleepwear'
					 when DEPARTMENT_NO in (128,171,179,185,663,672,711) then 'Footwear'
					 when DEPARTMENT_NO in (124,126,139,154,620) then 'Underwear'
					 when DEPARTMENT_NO in (129,155) then 'Hosiery and Socks'
					 when DEPARTMENT_NO in (555,562,650) then 'Homeware'
					 when DEPARTMENT_NO in (115,116,567,571,581,585,586,653,671,675,677) and CLASS_NO not in (2995,2996,3318,3327,3338,3343,
																												 5274,5349,9451,9453) and SUBCLASS_NO<>5410 then 'Accessories'
					 when CLASS_NO in (1338,1360,4859,5622) then 'Outerwear'
					 when CLASS_NO in (1270,1329,2995,3327,3338,5248,5639,9192,9451) then 'Footwear'
					 when CLASS_NO in (1275,1790,4296,4588,9479,9495,9533,9555) then 'Accessories'
					 when CLASS_NO in (1773,1995,2010,2655,2661,4401,4887,4890,4892,4903,4906,5633,5773) then 'Underwear'
					 when CLASS_NO in (1330,2002,2012,2996,3318,3343,4899,5274,5349,5918,9453) then 'Hosiery and Socks'
					 when CLASS_NO in (1361,1771,2650,5484,5766,9391,9478,9494,9531,9551) then 'Sleepwear'
					 when CLASS_NO=1459 then 'Beauty Skin'
					 when CLASS_NO=1455 then 'Beauty Colour'
					 when CLASS_NO in (2392,9033) then 'Beauty Gifting and Special Occasions'
					 when CLASS_NO in (1763,1764,4716,5345) then 'Beauty Accessories and Bags'
					 when SUBCLASS_NO in (1895,4529,4931,4933,6423,6424) then 'Outerwear'
					 when SUBCLASS_NO in (1352,4072,4183,5410,5620,6529,6546) then 'Footwear'
					 when SUBCLASS_NO in (1359,1852,3740,4932,5621,6421) then 'Accessories'
					 when SUBCLASS_NO in (4525,4526) then 'Underwear'
					 when SUBCLASS_NO in (4078) then 'Hosiery and Socks'
					 when SUBCLASS_NO in (1014,1178,1802,2138,2145,5928,5952,9078,9081,9084,9126,9323,4315,1818,1147,1184,1190,1507,1547,1553,
											 1560,1564,1834,4774,1966,9020,9032,1021,1839,1843,2136,1362,1366,9079,9082,9083,1368,1369,1371,4038,4725,1537) then 'Beauty Skin'
					 when SUBCLASS_NO in (1182,1803,4316,1067,4807,5418,5473,9090,9325,1148,1794,1191,1523,1545,1554,1559,1566,1823,9644,1038,
											 1040,1042,1069,1071,1077,1113,1079,1202,1203,1205,1206,1207,1840,1373,4805,4806,4808,4809,5293,1374,4821,4822,4823,4824,
											 1375,5417,5474,5476,5478,5479,1854,9088,9089,1381,2848,2850,2851,9150) then 'Beauty Colour'
					 when SUBCLASS_NO in (4317,1847,4810,4811,1856,2086,1816,2141,1160,1162,1185,1186,1195,1196,1490,1546,1551,1558,8687,8698,
											 9049,1388,1397,1402,1406,1410,1412,1413,1415,1422,1427,1435,1441,1442,1824,1446,1452,1456,1457,1458,1462,1467,1468,1569,
											 1570,1571,1573,1574,1575,1577,1578,1579,1581,1582,1583,1585,1586,1587,1589,1590,1591,1593,1594,1595,1605,1606,1607,1598,
											 1599,1601,1614,1615,1621,1622,1628,1629,1632,1641,1643,1658,1659,1660,1662,1663,1664,1666,1667,1668,1670,1671,1672,1674,
											 1675,1677,1678,1680,1682,1683,1685,1686,1687,1689,1690,1691,1693,1694,1695,1698,1699,1702,1704,1708,1710,1711,1715,1720,
											 1721,1753,1754,1776,1778,1779,1780,1782,1783,1784,1786,1787,1788,1817,1819,1820,1826,1827,1828,2025,2026,2027,2030,2031,
											 2142,4123,9099,3677,3680,9161,9383,1807,1809) then 'Beauty Fragrance'
					 when SUBCLASS_NO in (1849,1850,1851,1945,2085,2087,3528,4287,9327,1833,2034,2207,3100,3403,4536,4537,9025,1253,2021,2896,
											 5154,7797,4207,4208,2211,4214,1798,1799,1800,1154,1522,1548,1555,1561,1565) then 'Beauty Bath and Body'
				     when SUBCLASS_NO in (1169,1187,1197,1539,1549,1556,1562,1567,1796,1810) then 'Beauty Gifting and Special Occasions'
				else 'Others' end as ALTERNATE_PRODUCT_HIERARCHY6,
				case when a.TILL_NO=997 then 3
					when a.TILL_NO=999 then 2
				else 1 end as SALES_CHANNEL_CODE,
				a.area_no,a.area_name,a.region_no,a.region_name,a.location_name,nvl(a.alternate_location_hierarchy1,'No Value') as alternate_location_hierarchy1,
				a.alternate_location_hierarchy2, a.alternate_location_hierarchy3 , a.alternate_location_hierarchy4,
				a.alternate_location_hierarchy5 , a.alternate_location_hierarchy6,
				nvl(a.discount_code,0) as discount_code,nvl(a.RMS_PROMOTION_NO,'No Value') as RMS_PROMOTION_NO,nvl(a.ATG_PROMOTION_NO,'No Value') as ATG_PROMOTION_NO ,nvl(a.ATG_LOYALTY_PROMOTION_NO,'No Value') as ATG_LOYALTY_PROMOTION_NO,nvl(a.EOL_PROMOTION_NO,'No Value') as EOL_PROMOTION_NO,
				nvl(a.rms_discount_selling,0) as rms_discount_selling,  nvl(a.RMS_DISCOUNT_SELLING_VAT_EXCL,0) as RMS_DISCOUNT_SELLING_VAT_EXCL,--p2
				nvl(a.loyalty_discount_selling,0) as loyalty_discount_selling, nvl(a.LOYALTY_DISCOUNT_SELLING_VAT_EXCL,0) as LOYALTY_DISCOUNT_SELLING_VAT_EXCL,--p2
				nvl(a.atg_discount_selling,0) as atg_discount_selling,  nvl(a.ATG_DISCOUNT_SELLING_VAT_EXCL,0) as ATG_DISCOUNT_SELLING_VAT_EXCL,--p2
				nvl(a.atg_loyalty_discount_selling,0) as atg_loyalty_discount_selling, nvl(a.ATG_LOYALTY_DISCOUNT_SELLING_VAT_EXCL,0) as ATG_LOYALTY_DISCOUNT_SELLING_VAT_EXCL,--p2
				nvl(a.eol_discount_selling,0) as eol_discount_selling, nvl(a.EOL_DISCOUNT_SELLING_VAT_EXCL,0) as EOL_DISCOUNT_SELLING_VAT_EXCL,--p2
				nvl(a.wfs_discount_selling,0) as wfs_discount_selling,  nvl(a.WFS_DISCOUNT_SELLING_VAT_EXCL,0) as WFS_DISCOUNT_SELLING_VAT_EXCL,--p2
				nvl(a.staff_discount_selling,0) as staff_discount_selling, nvl(a.STAFF_DISCOUNT_SELLING_VAT_EXCL,0) as STAFF_DISCOUNT_SELLING_VAT_EXCL,--p2
				nvl(a.VOUCHER_DISCOUNT_SELLING,0) as VOUCHER_DISCOUNT_SELLING, nvl(a.VOUCHER_DISCOUNT_SELLING_VAT_EXCL,0) as VOUCHER_DISCOUNT_SELLING_VAT_EXCL,--p2
				nvl(a.other_discount_selling,0) as other_discount_selling,nvl(a.OTHER_DISCOUNT_SELLING_VAT_EXCL,0) as OTHER_DISCOUNT_SELLING_VAT_EXCL,--p2
				nvl(a.MARKDOWN_SEQ_NO,0) as MARKDOWN_SEQ_NO,nvl(a.store_card_tender_count,0) as store_card_tender_count,nvl(a.store_card_tran_tender_selling,0) as store_card_tran_tender_selling,
				nvl(a.credit_card_tender_count,0) as credit_card_tender_count, nvl(a.credit_card_tran_tender_selling,0) as credit_card_tran_tender_selling,
				nvl(a.gift_card_tender_count,0) as gift_card_tender_count, nvl(a.gift_card_tran_tender_selling,0) as gift_card_tran_tender_selling,
				nvl(a.alien_card_tender_count,0) as alien_card_tender_count, nvl(a.alien_card_tran_tender_selling,0) as alien_card_tran_tender_selling,
				nvl(a.cash_tender_ind,0) as cash_tender_ind, nvl(a.cash_tran_tender_selling,0) as cash_tran_tender_selling,
				nvl(a.other_tender_count,0) as other_tender_count, nvl(a.other_tran_tender_selling,0) as other_tran_tender_selling,
				---1 as voucher_no,
				nvl(a.voucher_tender_count,0) as voucher_tender_count, nvl(a.voucher_tran_tender_selling,0) as voucher_tran_tender_selling,
				nvl(a.ucid,'No Value') as ucid,
			    a.CUSTOMER_COHORT_FY,
				a.customer_cohort_fh,
                a.customer_cohort_fq,
                a.customer_cohort_fm,
                'No Value' as customer_cohort_fw,
				nvl(a.age,0) as age,
				a.age_band as age_band_fy,
				'No Value' as age_band_fh,
			    'No Value' as age_band_fq,
			    'No Value' as age_band_fm,
			    'No Value' as age_band_fw,
				case when a.gender='u' or a.gender is null then 'NO VALUE' else a.gender end as gender,
				case when a.derived_race='RACE UNKNOWN' or a.derived_race is null then 'NO VALUE' else a.derived_race end as derived_race,a.acquisition_date,
				a.HOUSEHOLD_INCOME_BAND_FY, a.MACRO_SEGMENT_FY , a.MICRO_SEGMENT_FY ,
				-1 as EMPLOYEE_STATUS_CODE,
				-1 as store_card_count,             --p2
				-1 as wrewards_card_count,          --p2
				-1 as myschool_card_count,          --p2
				-1 as credit_card_count,            --p2
				-1 as littleworld_membership_count, --p2
				-1 as vitality_membership_count,    --p2
				-1 as non_rewards_card_count       --p2
				,nvl(d.UDA_104_VALUE_NO,'0') as UDA_104_VALUE_NO
				,nvl(d.UDA_104_VALUE_DESC,'No Value') as UDA_104_VALUE_DESC
				,nvl(d.UDA_300_VALUE_NO,'0') as UDA_300_VALUE_NO
				,nvl(d.UDA_300_VALUE_DESC,'No Value') as UDA_300_VALUE_DESC
				,nvl(d.UDA_306_VALUE_NO,'0') as UDA_306_VALUE_NO
				,nvl(d.UDA_306_VALUE_DESC,'No Value') as UDA_306_VALUE_DESC
				,nvl(d.UDA_310_VALUE_NO,'0') as UDA_310_VALUE_NO
				,nvl(d.UDA_310_VALUE_DESC,'No Value') as UDA_310_VALUE_DESC
				,nvl(d.UDA_316_VALUE_NO,'0') as UDA_316_VALUE_NO
				,nvl(d.UDA_316_VALUE_DESC,'No Value') as UDA_316_VALUE_DESC
				,nvl(d.UDA_320_VALUE_NO,'0') as UDA_320_VALUE_NO
				,nvl(d.UDA_320_VALUE_DESC,'No Value') as UDA_320_VALUE_DESC
				,nvl(d.UDA_327_7703_7707_7708_VALUE_NO,'0') as UDA_327_7703_7707_7708_VALUE_NO
				,nvl(d.UDA_327_7703_7707_7708_VALUE_DESC,'No Value') as UDA_327_7703_7707_7708_VALUE_DESC
				,nvl(d.UDA_2301_VALUE_NO,'0') as UDA_2301_VALUE_NO
				,nvl(d.UDA_2301_VALUE_DESC,'No Value') as UDA_2301_VALUE_DESC
				,nvl(d.UDA_7702_VALUE_NO,'0') as UDA_7702_VALUE_NO
				,nvl(d.UDA_7702_VALUE_DESC,'No Value') as UDA_7702_VALUE_DESC
				,nvl(d.UDA_7704_VALUE_NO,'0') as UDA_7704_VALUE_NO
				,nvl(d.UDA_7704_VALUE_DESC,'No Value') as UDA_7704_VALUE_DESC
				,nvl(a.VITALITY_UDA_VALUE_NO,-1) as VITALITY_UDA_VALUE_NO,
				nvl(a.wrewards_swipe_ind,0) as wrewards_swipe_ind, nvl(a.myschool_swipe_ind,0) as myschool_swipe_ind,
				a.VMP_IND,
				a.TRAN_DATE||'-'||a.LOCATION_NO||'-'||a.TILL_NO||'-'||a.TRAN_NO as basket_id,'1900-01-01' as LAST_UPDATED_DATE
				--b.LOYALTY_PROMOTION_NO,  --p2 not there in excel sheet
				--b.WFS_PROMOTION_NO,      --p2  not there in excel sheet
				--b.STAFF_PROMOTION_NO,    --p2  not there in excel sheet
				--b.FRANCHISE_PROMOTION_NO ,--p2  not there in excel sheet
		FROM #WNS_CUST_BASKET_ITEM_TEMP a
		LEFT JOIN #wns_nm_fnd_item b
				ON A.ITEM_NO = B.ITEM_NO
		left join development.wns_hs_Item_Colour_Family c
				ON A.ITEM_NO = c.ITEM_NO
		left join #wns_kr_uda_info d
				ON A.ITEM_NO = d.ITEM_NO
		left join #wns_kr_Tran_discount_selling_vat_exc E
				ON A.TRAN_DATE = E.TRAN_DATE
					AND A.LOCATION_NO = E.LOCATION_NO
					AND A.TILL_NO = E.TILL_NO
					AND A.TRAN_NO = E.TRAN_NO)$[vLimit];

DROP TABLE IF EXISTS #WNS_CUST_BASKET_ITEM_TEMP ;
DROP TABLE IF EXISTS #wns_nm_fnd_item ;
DROP TABLE IF EXISTS #wns_kr_uda_info;
DROP TABLE IF EXISTS #wns_kr_Tran_discount_selling_vat_exc;

/******************************************************************************************************************************************/
/* SCRIPT E - END                                                                                                         *****************/
/******************************************************************************************************************************************/

/******************************************************************************************************************************************/
/* SCRIPT F - Combining One time run Base table with Base_Table_One_Day_Data(formed above)                                  *****************/
/******************************************************************************************************************************************/
DROP TABLE IF EXISTS DEVELOPMENT.TEMP_CONS_CUST_BASKET_ITEM_$[vFinYearWeekNoDay];
CREATE TABLE DEVELOPMENT.TEMP_CONS_CUST_BASKET_ITEM_$[vFinYearWeekNoDay]
AS
(SELECT * FROM DEVELOPMENT.$[vCBI])  --One Time run base table  DEVELOPMENT.CUST_BASKET_ITEM_{3}
UNION ALL
(SELECT * FROM DEVELOPMENT.CUST_BASKET_ITEM_$[vDayName])  --daily run base table
;


-- Drop previous week's Base Table
TRUNCATE DEVELOPMENT.$[vCBI];

/******************************************************************************************************************************************/
/* SCRIPT G - Mapping updated UCIDs and other details in the consolidated base table formed in Script F                                  *****************/
/******************************************************************************************************************************************/
drop table if exists DEVELOPMENT.wns_kr_cust_card_mapping_$[vFinYearWeekNoDay];
Create Table DEVELOPMENT.wns_kr_cust_card_mapping_$[vFinYearWeekNoDay]
diststyle all as
(select perm_ucid_hashed, ucid_type
	from DEVELOPMENT.DIM_CUSTOMER_CARD_MAPPING
	group by 1,2
) $[vLimit];

--Execution time: 22.88s

DROP TABLE IF EXISTS DEVELOPMENT.WNS_ADJ_TRAN_DEMO_AQUI_TYPE_$[vFinYearWeekNoDay];
CREATE TABLE DEVELOPMENT.WNS_ADJ_TRAN_DEMO_AQUI_TYPE_$[vFinYearWeekNoDay] AS
      select
			b.tran_date, b.location_no, b.till_no, b.tran_no, B.perm_ucid_hashed as ucid,c.BIRTH_DATE,
			c.AGE_YEARS	,
			case when c.gender='u' or c.gender is null then 'NO VALUE' else c.gender end as gender,
			case when c.derived_race='RACE UNKNOWN' or c.derived_race is null then 'NO VALUE' else c.derived_race end as derived_race,
			d.ACQUISITION_DATE,f.ucid_type
			from
			development.CUST_BASKET_MAPPING b    -- for current ucid only we need to merge all this.
			left join
			DEVELOPMENT.WNS_NM_SD_DIM_CUSTOMER_DEMO_$[vDayName] c   -- for demographic  we will add age_band here.
			on b.perm_ucid_hashed = c.ucid
			left join
			DEVELOPMENT.WNS_NM_DD_CA_UCID_LEVEL_CUST_ACQ_mapping$[vDayName] d -- for aqusiotion date only
			on b.perm_ucid_hashed = d.ucid
			left join DEVELOPMENT.wns_kr_cust_card_mapping_$[vFinYearWeekNoDay] f  -- using ucid_types we will merge this also. not needed we can take this up from WNS_NM_SD_DIM_CUSTOMER_DEMO_$[vDayName]
			on b.perm_ucid_hashed = f.perm_ucid_hashed $[vLimit];
--Execution time: 32.83s
drop table if exists DEVELOPMENT.wns_kr_cust_card_mapping_$[vFinYearWeekNoDay];


DROP TABLE IF EXISTS DEVELOPMENT.WNS_ADJ_TRAN_DEMO_AQUI_TYPE_CAL_$[vFinYearWeekNoDay];
CREATE TABLE DEVELOPMENT.WNS_ADJ_TRAN_DEMO_AQUI_TYPE_CAL_$[vFinYearWeekNoDay] AS
SELECT *,
(a.tran_date -cast(BIRTH_DATE as date))/365 AS AGE_TD  ,
--- add age_fy this is a year wise age and fixed for each year.
max(AGE_TD) over (partition by ucid,b.fin_year_no ) as age_fy,
max(AGE_TD) over (partition by ucid,b.fin_year_no,b.FIN_HALF_NO ) as age_fh,
max(AGE_TD) over (partition by ucid,b.fin_year_no,b.FIN_HALF_NO,b.FIN_QUARTER_NO ) as age_fq,
max(AGE_TD) over (partition by ucid,b.fin_year_no,b.FIN_HALF_NO,b.FIN_QUARTER_NO,b.fin_month_no ) as age_fm,
max(AGE_TD) over (partition by ucid,b.fin_year_no,b.FIN_HALF_NO,b.FIN_QUARTER_NO,b.fin_month_no,b.FIN_WEEK_NO ) as age_fw
FROM DEVELOPMENT.WNS_ADJ_TRAN_DEMO_AQUI_TYPE_$[vFinYearWeekNoDay] A
LEFT JOIN (SELECT DISTINCT FIN_YEAR_NO, FIN_HALF_NO, FIN_QUARTER_NO, FIN_MONTH_NO, FIN_WEEK_NO ,CALENDAR_DATE FROM ANALYTICS.FND_CALENDAR) B
ON A.TRAN_DATE=B.CALENDAR_DATE
;
delete from DEVELOPMENT.WNS_ADJ_TRAN_DEMO_AQUI_TYPE_CAL_$[vFinYearWeekNoDay] where FIN_YEAR_NO<=2017;

DROP TABLE IF EXISTS DEVELOPMENT.WNS_ADJ_TRAN_DEMO_AQUI_TYPE_$[vFinYearWeekNoDay];
--Execution time: 42.19s
DROP TABLE IF EXISTS DEVELOPMENT.WNS_ADJ_TRAN_DEMO_AQUI_TYPE_CAL_TIER_$[vFinYearWeekNoDay];
CREATE TABLE DEVELOPMENT.WNS_ADJ_TRAN_DEMO_AQUI_TYPE_CAL_TIER_$[vFinYearWeekNoDay] AS
SELECT A.*,j.TIER_FY,j.TIER_FH,j.TIER_Fq,j.TIER_FM
FROM DEVELOPMENT.WNS_ADJ_TRAN_DEMO_AQUI_TYPE_CAL_$[vFinYearWeekNoDay] A
LEFT JOIN  development.wns_adj_tier_wise$[vDayName] j    -- for tier only we need to merge this also
ON A.fin_year_no = j.fin_year_no
AND A.fin_month_no = j.fin_month_no
AND A.ucid = j.ucid
;
create table development.WNS_ADJ_TRAN_DEMO_AQUI_TYPE_CAL_TIER_LUD_$[vFinYearWeekNoDay]
DISTKEY(TRAN_DATE) COMPOUND SORTKEY(TRAN_DATE, LOCATION_NO, TILL_NO, TRAN_NO) as
select A.*,c.effective_from_date
from DEVELOPMENT.WNS_ADJ_TRAN_DEMO_AQUI_TYPE_CAL_TIER_$[vFinYearWeekNoDay] A
  left join (	select
	                        CAST (location_no as SMALLINT) as location_no,
	                        CAST (till_no as SMALLINT) as till_no,
	                        CAST (tran_no as INTEGER ) as tran_no,
	                        tran_date,effective_from_date,effective_to_date
	                        from development.cust_basket_mapping_tracking
	                        where effective_to_date is null and tran_date>='2017-06-26'
	                    ) c
        		ON A.TRAN_DATE = c.TRAN_DATE
					AND A.LOCATION_NO = c.LOCATION_NO
					AND A.TILL_NO = c.TILL_NO
					AND A.TRAN_NO = c.TRAN_NO
$[vLimit];

DROP TABLE IF EXISTS DEVELOPMENT.WNS_ADJ_TRAN_DEMO_AQUI_TYPE_CAL_$[vFinYearWeekNoDay];
DROP TABLE IF EXISTS DEVELOPMENT.WNS_ADJ_TRAN_DEMO_AQUI_TYPE_CAL_TIER_$[vFinYearWeekNoDay];
--Execution time: 37.92s
/******************************************************************************************************************************************/
/* END OF SCRIPT G - Mapping updated UCIDs and other details in the consolidated base table formed in Script F                                  *****************/
/******************************************************************************************************************************************/



INSERT INTO DEVELOPMENT.$[vCBI]
	 (
		SELECT a.tran_date, a.location_no, a.till_no, a.tran_no,
				a.tran_time,a.tran_ind,a.tran_type,a.tran_qty,
				a.tran_selling ,a.tran_selling_vat_excl ,--p2
				a.discount_selling,a.DISCOUNT_SELLING_VAT_EXCL,--p2
				a.fin_year_no, a.fin_half_no, a.fin_quarter_no, a.fin_month_no,
				a.fin_week_no, a.fin_day_no,a.season_no,a.weekday_weekend_code,
				a.TIME_OF_DAY_CODE,a.item_seq_no,
				a.item_no, a.item_level1_no, a.ITEM_SHORT_DESC,a.item_tran_type,
				a.item_tran_qty,a.item_tran_selling,a.ITEM_TRAN_SELLING_VAT_EXCL,
				a.item_discount_selling,a.ITEM_DISCOUNT_SELLING_VAT_EXCL,--p2
				a.WASTE_DISCOUNT_PERC,a.vat_rate_perc,
				a.colour_family,a.BUSINESS_UNIT_NO,a.BUSINESS_UNIT_NAME,a.GROUP_NO,a.GROUP_NAME,
				a.SUBGROUP_NO,a.SUBGROUP_NAME, a.DEPARTMENT_NO,a.DEPARTMENT_NAME,a.CLASS_NO,a.CLASS_NAME,a.SUBCLASS_NO,a.SUBCLASS_NAME,
				a.ALTERNATE_PRODUCT_HIERARCHY1 ,
				a.ALTERNATE_PRODUCT_HIERARCHY2 ,
				a.ALTERNATE_PRODUCT_HIERARCHY3 ,
				a.ALTERNATE_PRODUCT_HIERARCHY4 ,
				a.ALTERNATE_PRODUCT_HIERARCHY5 ,
				a.ALTERNATE_PRODUCT_HIERARCHY6,
				a.SALES_CHANNEL_CODE,
				a.area_no,a.area_name,a.region_no,a.region_name,a.location_name,a.alternate_location_hierarchy1,
				a.alternate_location_hierarchy2, a.alternate_location_hierarchy3 , a.alternate_location_hierarchy4,
				a.alternate_location_hierarchy5 , a.alternate_location_hierarchy6,
				a.discount_code,a.RMS_PROMOTION_NO,a.ATG_PROMOTION_NO,a.ATG_LOYALTY_PROMOTION_NO,a.EOL_PROMOTION_NO,
				a.rms_discount_selling,  a.RMS_DISCOUNT_SELLING_VAT_EXCL,--p2
				a.loyalty_discount_selling, a.LOYALTY_DISCOUNT_SELLING_VAT_EXCL,--p2
				a.atg_discount_selling,  a.ATG_DISCOUNT_SELLING_VAT_EXCL,--p2
				a.atg_loyalty_discount_selling, a.ATG_LOYALTY_DISCOUNT_SELLING_VAT_EXCL,--p2
				a.eol_discount_selling, a.EOL_DISCOUNT_SELLING_VAT_EXCL,--p2
				a.wfs_discount_selling,  a.WFS_DISCOUNT_SELLING_VAT_EXCL,--p2
				a.staff_discount_selling, a.STAFF_DISCOUNT_SELLING_VAT_EXCL,--p2
				a.VOUCHER_DISCOUNT_SELLING,
                a.VOUCHER_DISCOUNT_SELLING_VAT_EXCL,
				a.other_discount_selling,a.OTHER_DISCOUNT_SELLING_VAT_EXCL,--p2
				a.MARKDOWN_SEQ_NO,a.store_card_tender_count,a.store_card_tran_tender_selling,
				a.credit_card_tender_count, a.credit_card_tran_tender_selling,
				a.gift_card_tender_count, a.gift_card_tran_tender_selling,
				a.alien_card_tender_count, a.alien_card_tran_tender_selling,
				a.cash_tender_ind, a.cash_tran_tender_selling,
				a.other_tender_count, a.other_tran_tender_selling,
				--a.voucher_no,
				a.voucher_tender_count, a.voucher_tran_tender_selling,
				nvl(b.ucid ,'No Value') as ucid,
				--case when b.ucid_type in ('KNOWN') AND e.customer_current_tier_code IN (3,4) THEN 'WREWARDS Known VIP'
				--	when b.ucid_type in ('KNOWN') THEN 'WREWARDS Known Base'
				--	WHEN b.ucid_type in ('ORPHAN') THEN 'WREWARDS Orphan'
				--	WHEN b.ucid_type in ('NON-REWARDS') THEN 'Non-Rewards'
				--	else 'CASH'
				--	END AS CUSTOMER_COHORT,--p2
				case when  b.ucid_type in ('KNOWN') AND b.tier_fy IN (3,4) THEN 'WREWARDS Known VIP'
					  when b.ucid_type in ('KNOWN') THEN 'WREWARDS Known Base'
					  WHEN b.ucid_type in ('ORPHAN') THEN 'WREWARDS Orphan'
					  WHEN b.ucid_type in ('NON-REWARDS') THEN 'Non-Rewards'
				else 'CASH'
				END AS CUSTOMER_COHORT_FY,
				case when  b.ucid_type in ('KNOWN') AND b.tier_fh IN (3,4) THEN 'WREWARDS Known VIP'
					  when b.ucid_type in ('KNOWN') THEN 'WREWARDS Known Base'
					  WHEN b.ucid_type in ('ORPHAN') THEN 'WREWARDS Orphan'
					  WHEN b.ucid_type in ('NON-REWARDS') THEN 'Non-Rewards'
				else 'CASH'
				END AS CUSTOMER_COHORT_FH,
				case when  b.ucid_type in ('KNOWN') AND b.tier_fq IN (3,4) THEN 'WREWARDS Known VIP'
					  when b.ucid_type in ('KNOWN') THEN 'WREWARDS Known Base'
					  WHEN b.ucid_type in ('ORPHAN') THEN 'WREWARDS Orphan'
					  WHEN b.ucid_type in ('NON-REWARDS') THEN 'Non-Rewards'
				else 'CASH'
				END AS CUSTOMER_COHORT_FQ,
				case when  b.ucid_type in ('KNOWN') AND b.tier_fm IN (3,4) THEN 'WREWARDS Known VIP'
					  when b.ucid_type in ('KNOWN') THEN 'WREWARDS Known Base'
					  WHEN b.ucid_type in ('ORPHAN') THEN 'WREWARDS Orphan'
					  WHEN b.ucid_type in ('NON-REWARDS') THEN 'Non-Rewards'
				else 'CASH'
				END AS CUSTOMER_COHORT_FM,
	           'No Value' as customer_cohort_fw,
				nvl(b.age_td,0) as age,
				case when b.age_fy between 18 and 24 then '18-24'
					 when b.age_fy between 25 and 34 then '25-34'
					 when b.age_fy between 35 and 44 then '35-44'
					 when b.age_fy between 45 and 54 then '45-54'
					 when b.age_fy>=55 then '55+' else 'No Value' end as AGE_BAND_FY,--p2
                case when b.age_fh between 18 and 24 then '18-24'
					 when b.age_fh between 25 and 34 then '25-34'
					 when b.age_fh between 35 and 44 then '35-44'
					 when b.age_fh between 45 and 54 then '45-54'
					 when b.age_fh>=55 then '55+' else 'No Value' end as AGE_BAND_FH,--p2
                case when b.age_fq between 18 and 24 then '18-24'
					 when b.age_fq between 25 and 34 then '25-34'
					 when b.age_fq between 35 and 44 then '35-44'
					 when b.age_fq between 45 and 54 then '45-54'
					 when b.age_fq>=55 then '55+' else 'No Value' end as AGE_BAND_FQ,--p2
				case when b.age_fm between 18 and 24 then '18-24'
					 when b.age_fm between 25 and 34 then '25-34'
					 when b.age_fm between 35 and 44 then '35-44'
					 when b.age_fm between 45 and 54 then '45-54'
					 when b.age_fm>=55 then '55+' else 'No Value' end as AGE_BAND_FM,--p2
				case when b.age_fw between 18 and 24 then '18-24'
					 when b.age_fw between 25 and 34 then '25-34'
					 when b.age_fw between 35 and 44 then '35-44'
					 when b.age_fw between 45 and 54 then '45-54'
					 when b.age_fw>=55 then '55+' else 'No Value' end as AGE_BAND_FW,--p2
				case when b.gender='u' or b.gender is null then 'NO VALUE' else b.gender end as gender,
				case when b.derived_race='RACE UNKNOWN' or b.derived_race is null then 'NO VALUE' else b.derived_race end as derived_race,
				case WHEN b.ACQUISITION_DATE IS NULL THEN '1999-01-01'
					 WHEN b.ACQUISITION_DATE<'1999-01-01' THEN '1999-01-01' -- THE FIRST DATE IN CUST_BASKET IS 1999-06-04
	                 WHEN b.ACQUISITION_DATE>=(CURRENT_DATE+1) THEN CURRENT_DATE
				ELSE b.ACQUISITION_DATE END AS acquisition_date,
				a.HOUSEHOLD_INCOME_BAND_FY, a.MACRO_SEGMENT_FY , a.MICRO_SEGMENT_FY ,
				a.EMPLOYEE_STATUS_CODE, -- @adj sep
				a.store_card_count,             --p2
				a.wrewards_card_count,          --p2
				a.myschool_card_count,          --p2
				a.credit_card_count,            --p2
				a.littleworld_membership_count, --p2
				a.vitality_membership_count,    --p2
				a.non_rewards_card_count       --p2
				,nvl(a.UDA_104_VALUE_NO,'0') as UDA_104_VALUE_NO
				,nvl(a.UDA_104_VALUE_DESC,'No Value') as UDA_104_VALUE_DESC
				,nvl(a.UDA_300_VALUE_NO,'0') as UDA_300_VALUE_NO
				,nvl(a.UDA_300_VALUE_DESC,'No Value') as UDA_300_VALUE_DESC
				,nvl(a.UDA_306_VALUE_NO,'0') as UDA_306_VALUE_NO
				,nvl(a.UDA_306_VALUE_DESC,'No Value') as UDA_306_VALUE_DESC
				,nvl(a.UDA_310_VALUE_NO,'0') as UDA_310_VALUE_NO
				,nvl(a.UDA_310_VALUE_DESC,'No Value') as UDA_310_VALUE_DESC
				,nvl(a.UDA_316_VALUE_NO,'0') as UDA_316_VALUE_NO
				,nvl(a.UDA_316_VALUE_DESC,'No Value') as UDA_316_VALUE_DESC
				,nvl(a.UDA_320_VALUE_NO,'0') as UDA_320_VALUE_NO
				,nvl(a.UDA_320_VALUE_DESC,'No Value') as UDA_320_VALUE_DESC
				,nvl(a.UDA_327_7703_7707_7708_VALUE_NO,'0') as UDA_327_7703_7707_7708_VALUE_NO
				,nvl(a.UDA_327_7703_7707_7708_VALUE_DESC,'No Value') as UDA_327_7703_7707_7708_VALUE_DESC
				,nvl(a.UDA_2301_VALUE_NO,'0') as UDA_2301_VALUE_NO
				,nvl(a.UDA_2301_VALUE_DESC,'No Value') as UDA_2301_VALUE_DESC
				,nvl(a.UDA_7702_VALUE_NO,'0') as UDA_7702_VALUE_NO
				,nvl(a.UDA_7702_VALUE_DESC,'No Value') as UDA_7702_VALUE_DESC
				,nvl(a.UDA_7704_VALUE_NO,'0') as UDA_7704_VALUE_NO
				,nvl(a.UDA_7704_VALUE_DESC,'No Value') as UDA_7704_VALUE_DESC
				,a.VITALITY_UDA_VALUE_NO,a.wrewards_swipe_ind, a.myschool_swipe_ind,a.VMP_IND,
				a.basket_id,b.effective_from_date as LAST_UPDATED_DATE
				--a.LOYALTY_PROMOTION_NO,  --p2 not there in excel sheet
				--a.WFS_PROMOTION_NO,      --p2  not there in excel sheet
				--a.STAFF_PROMOTION_NO,    --p2  not there in excel sheet
				--a.FRANCHISE_PROMOTION_NO ,--p2  not there in excel sheet
		from
			DEVELOPMENT.TEMP_CONS_CUST_BASKET_ITEM_$[vFinYearWeekNoDay] a
			left join
			development.WNS_ADJ_TRAN_DEMO_AQUI_TYPE_CAL_TIER_LUD_$[vFinYearWeekNoDay] b    --BC UCID gets updated (TTCI)
			on a.tran_date = b.tran_date
			and a.location_no = b.location_no
			and a.till_no = b.till_no
			and a.tran_no = b.tran_no
		   	)$[vLimit];


DROP TABLE IF EXISTS development.wns_adj_tier_wise$[vDayName];
DROP TABLE IF EXISTS #wns_kr_cust_card_mapping;
DROP TABLE IF EXISTS #wns_kr_tier_year_wise;
DROP TABLE IF EXISTS DEVELOPMENT.WNS_NM_WNS_SD_TIER_UCID_LEVEL_$[vDayName];
DROP TABLE IF EXISTS DEVELOPMENT.WNS_NM_DD_CA_UCID_LEVEL_CUST_ACQ_mapping$[vDayName];
DROP TABLE IF EXISTS DEVELOPMENT.WNS_NM_SD_DIM_CUSTOMER_DEMO_$[vDayName] ;
DROP TABLE IF EXISTS DEVELOPMENT.CUST_BASKET_ITEM_$[vDayName] ;
DROP TABLE IF EXISTS DEVELOPMENT.TEMP_CONS_CUST_BASKET_ITEM_$[vFinYearWeekNoDay] ;
DROP TABLE IF EXISTS DEVELOPMENT.WNS_ADJ_TRAN_DEMO_AQUI_TYPE_CAL_TIER_$[vFinYearWeekNoDay];
DROP TABLE IF EXISTS development.WNS_ADJ_TRAN_DEMO_AQUI_TYPE_CAL_TIER_LUD_$[vFinYearWeekNoDay];
grant select on table DEVELOPMENT.$[vCBI] to public ;
  ) ;

2021-01-08 14:09:49.677447 (Thread-1): Postgres error: syntax error at or near "WbVarDef"
LINE 25: WbVarDef vlast_updated_date  = '2020-01-01' ;   --{0}
         ^

2021-01-08 14:09:49.677608 (Thread-1): On model.my_new_project.bar_table_test_cbt: ROLLBACK
2021-01-08 14:09:49.745793 (Thread-1): finished collecting timing info
2021-01-08 14:09:49.746115 (Thread-1): On model.my_new_project.bar_table_test_cbt: Close
2021-01-08 14:09:49.746634 (Thread-1): Database Error in model bar_table_test_cbt (models/example/bar_table_test_cbt.sql)
  syntax error at or near "WbVarDef"
  LINE 25: WbVarDef vlast_updated_date  = '2020-01-01' ;   --{0}
           ^
  compiled SQL at target/run/my_new_project/models/example/bar_table_test_cbt.sql
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/postgres/connections.py", line 46, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 78, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.SyntaxError: syntax error at or near "WbVarDef"
LINE 25: WbVarDef vlast_updated_date  = '2020-01-01' ;   --{0}
         ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 276, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 378, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/run.py", line 233, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 61, in macro
  File "/usr/local/lib/python3.8/dist-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/lib/python3.8/dist-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 224, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 123, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 86, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/postgres/connections.py", line 57, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model bar_table_test_cbt (models/example/bar_table_test_cbt.sql)
  syntax error at or near "WbVarDef"
  LINE 25: WbVarDef vlast_updated_date  = '2020-01-01' ;   --{0}
           ^
  compiled SQL at target/run/my_new_project/models/example/bar_table_test_cbt.sql
2021-01-08 14:09:49.747389 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '21041e39-c71c-40f1-8a03-3dfd99b9104a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd33c2516a0>]}
2021-01-08 14:09:49.748442 (Thread-1): 14:09:49 | 4 of 14 ERROR creating view model development.bar_table_test_cbt..... [ERROR in 1.63s]
2021-01-08 14:09:49.748524 (Thread-1): Finished running node model.my_new_project.bar_table_test_cbt
2021-01-08 14:09:49.748626 (Thread-1): Began running node model.my_new_project.mycustom
2021-01-08 14:09:49.749401 (Thread-1): 14:09:49 | 5 of 14 START table model development.mycustom....................... [RUN]
2021-01-08 14:09:49.749619 (Thread-1): Acquiring new redshift connection "model.my_new_project.mycustom".
2021-01-08 14:09:49.749693 (Thread-1): Compiling model.my_new_project.mycustom
2021-01-08 14:09:49.755870 (Thread-1): Writing injected SQL for node "model.my_new_project.mycustom"
2021-01-08 14:09:49.769239 (Thread-1): finished collecting timing info
2021-01-08 14:09:49.774335 (Thread-1): Using redshift connection "model.my_new_project.mycustom".
2021-01-08 14:09:49.774410 (Thread-1): On model.my_new_project.mycustom: BEGIN
2021-01-08 14:09:49.774466 (Thread-1): Opening a new connection, currently in state closed
2021-01-08 14:09:49.774600 (Thread-1): Connecting to Redshift using 'database' credentials
2021-01-08 14:09:50.283653 (Thread-82): handling poll request
2021-01-08 14:09:50.284197 (Thread-82): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e6127f0>]}
2021-01-08 14:09:50.292037 (Thread-82): sending response (<Response 147059 bytes [200 OK]>) to 10.0.10.76
2021-01-08 14:09:50.456339 (Thread-1): SQL status: BEGIN in 0.68 seconds
2021-01-08 14:09:50.458213 (Thread-1): Using redshift connection "model.my_new_project.mycustom".
2021-01-08 14:09:50.458328 (Thread-1): On model.my_new_project.mycustom: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.mycustom"} */
drop table if exists "dev"."development"."mycustom__dbt_tmp" cascade
2021-01-08 14:09:50.534633 (Thread-1): SQL status: DROP TABLE in 0.08 seconds
2021-01-08 14:09:50.535473 (Thread-1): On model.my_new_project.mycustom: COMMIT
2021-01-08 14:09:50.535561 (Thread-1): Using redshift connection "model.my_new_project.mycustom".
2021-01-08 14:09:50.535607 (Thread-1): On model.my_new_project.mycustom: COMMIT
2021-01-08 14:09:50.613574 (Thread-1): SQL status: COMMIT in 0.08 seconds
2021-01-08 14:09:50.613745 (Thread-1): Using redshift connection "model.my_new_project.mycustom".
2021-01-08 14:09:50.613797 (Thread-1): On model.my_new_project.mycustom: BEGIN
2021-01-08 14:09:50.689854 (Thread-1): SQL status: BEGIN in 0.08 seconds
2021-01-08 14:09:50.690085 (Thread-1): On model.my_new_project.mycustom: COMMIT
2021-01-08 14:09:50.690139 (Thread-1): Using redshift connection "model.my_new_project.mycustom".
2021-01-08 14:09:50.690214 (Thread-1): On model.my_new_project.mycustom: COMMIT
2021-01-08 14:09:50.765958 (Thread-1): SQL status: COMMIT in 0.08 seconds
2021-01-08 14:09:50.766133 (Thread-1): Using redshift connection "model.my_new_project.mycustom".
2021-01-08 14:09:50.766213 (Thread-1): On model.my_new_project.mycustom: BEGIN
2021-01-08 14:09:50.842247 (Thread-1): SQL status: BEGIN in 0.08 seconds
2021-01-08 14:09:50.844178 (Thread-1): Using redshift connection "model.my_new_project.mycustom".
2021-01-08 14:09:50.844266 (Thread-1): On model.my_new_project.mycustom: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.mycustom"} */
drop table if exists "dev"."development"."mycustom__dbt_backup" cascade
2021-01-08 14:09:50.920303 (Thread-1): SQL status: DROP TABLE in 0.08 seconds
2021-01-08 14:09:50.921159 (Thread-1): On model.my_new_project.mycustom: COMMIT
2021-01-08 14:09:50.921249 (Thread-1): Using redshift connection "model.my_new_project.mycustom".
2021-01-08 14:09:50.921298 (Thread-1): On model.my_new_project.mycustom: COMMIT
2021-01-08 14:09:50.999540 (Thread-1): SQL status: COMMIT in 0.08 seconds
2021-01-08 14:09:50.999711 (Thread-1): Using redshift connection "model.my_new_project.mycustom".
2021-01-08 14:09:50.999766 (Thread-1): On model.my_new_project.mycustom: BEGIN
2021-01-08 14:09:51.075768 (Thread-1): SQL status: BEGIN in 0.08 seconds
2021-01-08 14:09:51.076684 (Thread-1): Writing runtime SQL for node "model.my_new_project.mycustom"
2021-01-08 14:09:51.090463 (Thread-1): Using redshift connection "model.my_new_project.mycustom".
2021-01-08 14:09:51.090579 (Thread-1): On model.my_new_project.mycustom: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.mycustom"} */


  create  table
    "dev"."development"."mycustom__dbt_tmp"
    
    
  as (
    /*
   Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
   SPDX-License-Identifier: MIT-0
*/


/*
    Find top 100 customers with the most number of orders
*/



select c_custkey, c_nationkey, count(*) total_order
from customer c left join orders o on c.c_custkey = o.o_custkey
group by c_custkey, c_nationkey
order by total_order desc
limit 110
  );
2021-01-08 14:09:51.985047 (Thread-83): handling poll request
2021-01-08 14:09:51.985479 (Thread-83): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e5e5880>]}
2021-01-08 14:09:51.988610 (Thread-83): sending response (<Response 11358 bytes [200 OK]>) to 10.0.17.213
2021-01-08 14:09:53.398947 (Thread-84): handling poll request
2021-01-08 14:09:53.399396 (Thread-84): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f434730>]}
2021-01-08 14:09:53.400326 (Thread-84): sending response (<Response 289 bytes [200 OK]>) to 10.0.14.17
2021-01-08 14:09:54.790416 (Thread-85): handling poll request
2021-01-08 14:09:54.790839 (Thread-85): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f434100>]}
2021-01-08 14:09:54.791686 (Thread-85): sending response (<Response 289 bytes [200 OK]>) to 10.0.26.143
2021-01-08 14:09:56.193560 (Thread-86): handling poll request
2021-01-08 14:09:56.194019 (Thread-86): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f434490>]}
2021-01-08 14:09:56.194913 (Thread-86): sending response (<Response 288 bytes [200 OK]>) to 10.0.2.160
2021-01-08 14:09:57.604743 (Thread-87): handling poll request
2021-01-08 14:09:57.605150 (Thread-87): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f1e9280>]}
2021-01-08 14:09:57.606017 (Thread-87): sending response (<Response 289 bytes [200 OK]>) to 10.0.35.111
2021-01-08 14:09:59.061639 (Thread-88): handling poll request
2021-01-08 14:09:59.062068 (Thread-88): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f1e90a0>]}
2021-01-08 14:09:59.063001 (Thread-88): sending response (<Response 289 bytes [200 OK]>) to 10.0.14.17
2021-01-08 14:10:00.477625 (Thread-89): handling poll request
2021-01-08 14:10:00.478055 (Thread-89): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f1e9430>]}
2021-01-08 14:10:00.478991 (Thread-89): sending response (<Response 289 bytes [200 OK]>) to 10.0.10.76
2021-01-08 14:10:01.904742 (Thread-90): handling poll request
2021-01-08 14:10:01.905163 (Thread-90): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f1e9d30>]}
2021-01-08 14:10:01.906045 (Thread-90): sending response (<Response 289 bytes [200 OK]>) to 10.0.2.160
2021-01-08 14:10:03.322122 (Thread-91): handling poll request
2021-01-08 14:10:03.322552 (Thread-91): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f1e9b50>]}
2021-01-08 14:10:03.323415 (Thread-91): sending response (<Response 289 bytes [200 OK]>) to 10.0.31.102
2021-01-08 14:10:04.753573 (Thread-92): handling poll request
2021-01-08 14:10:04.753993 (Thread-92): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e575eb0>]}
2021-01-08 14:10:04.754904 (Thread-92): sending response (<Response 289 bytes [200 OK]>) to 10.0.14.17
2021-01-08 14:10:05.585401 (Thread-1): SQL status: SELECT in 14.49 seconds
2021-01-08 14:10:05.588109 (Thread-1): Using redshift connection "model.my_new_project.mycustom".
2021-01-08 14:10:05.588205 (Thread-1): On model.my_new_project.mycustom: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.mycustom"} */
alter table "dev"."development"."mycustom__dbt_tmp" rename to "mycustom"
2021-01-08 14:10:05.664481 (Thread-1): SQL status: ALTER TABLE in 0.08 seconds
2021-01-08 14:10:05.665634 (Thread-1): On model.my_new_project.mycustom: COMMIT
2021-01-08 14:10:05.665725 (Thread-1): Using redshift connection "model.my_new_project.mycustom".
2021-01-08 14:10:05.665769 (Thread-1): On model.my_new_project.mycustom: COMMIT
2021-01-08 14:10:05.797734 (Thread-1): SQL status: COMMIT in 0.13 seconds
2021-01-08 14:10:05.798065 (Thread-1): Using redshift connection "model.my_new_project.mycustom".
2021-01-08 14:10:05.798125 (Thread-1): On model.my_new_project.mycustom: BEGIN
2021-01-08 14:10:05.874421 (Thread-1): SQL status: BEGIN in 0.08 seconds
2021-01-08 14:10:05.876409 (Thread-1): Using redshift connection "model.my_new_project.mycustom".
2021-01-08 14:10:05.876498 (Thread-1): On model.my_new_project.mycustom: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.mycustom"} */
drop table if exists "dev"."development"."mycustom__dbt_backup" cascade
2021-01-08 14:10:05.952339 (Thread-1): SQL status: DROP TABLE in 0.08 seconds
2021-01-08 14:10:05.953171 (Thread-1): On model.my_new_project.mycustom: COMMIT
2021-01-08 14:10:05.953250 (Thread-1): Using redshift connection "model.my_new_project.mycustom".
2021-01-08 14:10:05.953296 (Thread-1): On model.my_new_project.mycustom: COMMIT
2021-01-08 14:10:06.031017 (Thread-1): SQL status: COMMIT in 0.08 seconds
2021-01-08 14:10:06.031180 (Thread-1): Using redshift connection "model.my_new_project.mycustom".
2021-01-08 14:10:06.031231 (Thread-1): On model.my_new_project.mycustom: BEGIN
2021-01-08 14:10:06.107278 (Thread-1): SQL status: BEGIN in 0.08 seconds
2021-01-08 14:10:06.108993 (Thread-1): finished collecting timing info
2021-01-08 14:10:06.109204 (Thread-1): On model.my_new_project.mycustom: ROLLBACK
2021-01-08 14:10:06.165961 (Thread-93): handling poll request
2021-01-08 14:10:06.166633 (Thread-93): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e6059a0>]}
2021-01-08 14:10:06.169165 (Thread-93): sending response (<Response 8267 bytes [200 OK]>) to 10.0.2.160
2021-01-08 14:10:06.184952 (Thread-1): On model.my_new_project.mycustom: Close
2021-01-08 14:10:06.185765 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '21041e39-c71c-40f1-8a03-3dfd99b9104a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd33c2516a0>]}
2021-01-08 14:10:06.186902 (Thread-1): 14:10:06 | 5 of 14 OK created table model development.mycustom.................. [SELECT in 16.44s]
2021-01-08 14:10:06.186993 (Thread-1): Finished running node model.my_new_project.mycustom
2021-01-08 14:10:06.187096 (Thread-1): Began running node model.my_new_project.wns_nm_DD_DEMOGOG_STAGING
2021-01-08 14:10:06.187883 (Thread-1): 14:10:06 | 6 of 14 START view model development.wns_nm_DD_DEMOGOG_STAGING....... [RUN]
2021-01-08 14:10:06.188099 (Thread-1): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_DEMOGOG_STAGING".
2021-01-08 14:10:06.188174 (Thread-1): Compiling model.my_new_project.wns_nm_DD_DEMOGOG_STAGING
2021-01-08 14:10:06.193306 (Thread-1): Writing injected SQL for node "model.my_new_project.wns_nm_DD_DEMOGOG_STAGING"
2021-01-08 14:10:06.210233 (Thread-1): finished collecting timing info
2021-01-08 14:10:06.215883 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_DEMOGOG_STAGING".
2021-01-08 14:10:06.215979 (Thread-1): On model.my_new_project.wns_nm_DD_DEMOGOG_STAGING: BEGIN
2021-01-08 14:10:06.216039 (Thread-1): Opening a new connection, currently in state closed
2021-01-08 14:10:06.216080 (Thread-1): Connecting to Redshift using 'database' credentials
2021-01-08 14:10:06.830613 (Thread-1): SQL status: BEGIN in 0.61 seconds
2021-01-08 14:10:06.832508 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_DEMOGOG_STAGING".
2021-01-08 14:10:06.832602 (Thread-1): On model.my_new_project.wns_nm_DD_DEMOGOG_STAGING: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.wns_nm_DD_DEMOGOG_STAGING"} */
drop view if exists "dev"."development"."wns_nm_DD_DEMOGOG_STAGING__dbt_tmp" cascade
2021-01-08 14:10:06.901278 (Thread-1): SQL status: DROP VIEW in 0.07 seconds
2021-01-08 14:10:06.902213 (Thread-1): On model.my_new_project.wns_nm_DD_DEMOGOG_STAGING: COMMIT
2021-01-08 14:10:06.902304 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_DEMOGOG_STAGING".
2021-01-08 14:10:06.902351 (Thread-1): On model.my_new_project.wns_nm_DD_DEMOGOG_STAGING: COMMIT
2021-01-08 14:10:06.986992 (Thread-1): SQL status: COMMIT in 0.08 seconds
2021-01-08 14:10:06.987171 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_DEMOGOG_STAGING".
2021-01-08 14:10:06.987224 (Thread-1): On model.my_new_project.wns_nm_DD_DEMOGOG_STAGING: BEGIN
2021-01-08 14:10:07.055729 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:10:07.055949 (Thread-1): On model.my_new_project.wns_nm_DD_DEMOGOG_STAGING: COMMIT
2021-01-08 14:10:07.056003 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_DEMOGOG_STAGING".
2021-01-08 14:10:07.056044 (Thread-1): On model.my_new_project.wns_nm_DD_DEMOGOG_STAGING: COMMIT
2021-01-08 14:10:07.124422 (Thread-1): SQL status: COMMIT in 0.07 seconds
2021-01-08 14:10:07.124593 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_DEMOGOG_STAGING".
2021-01-08 14:10:07.124643 (Thread-1): On model.my_new_project.wns_nm_DD_DEMOGOG_STAGING: BEGIN
2021-01-08 14:10:07.193114 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:10:07.195133 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_DEMOGOG_STAGING".
2021-01-08 14:10:07.195223 (Thread-1): On model.my_new_project.wns_nm_DD_DEMOGOG_STAGING: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.wns_nm_DD_DEMOGOG_STAGING"} */
drop view if exists "dev"."development"."wns_nm_DD_DEMOGOG_STAGING__dbt_backup" cascade
2021-01-08 14:10:07.263665 (Thread-1): SQL status: DROP VIEW in 0.07 seconds
2021-01-08 14:10:07.264521 (Thread-1): On model.my_new_project.wns_nm_DD_DEMOGOG_STAGING: COMMIT
2021-01-08 14:10:07.264607 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_DEMOGOG_STAGING".
2021-01-08 14:10:07.264653 (Thread-1): On model.my_new_project.wns_nm_DD_DEMOGOG_STAGING: COMMIT
2021-01-08 14:10:07.358259 (Thread-1): SQL status: COMMIT in 0.09 seconds
2021-01-08 14:10:07.358437 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_DEMOGOG_STAGING".
2021-01-08 14:10:07.358491 (Thread-1): On model.my_new_project.wns_nm_DD_DEMOGOG_STAGING: BEGIN
2021-01-08 14:10:07.427066 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:10:07.427710 (Thread-1): Writing runtime SQL for node "model.my_new_project.wns_nm_DD_DEMOGOG_STAGING"
2021-01-08 14:10:07.447572 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_DEMOGOG_STAGING".
2021-01-08 14:10:07.447711 (Thread-1): On model.my_new_project.wns_nm_DD_DEMOGOG_STAGING: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.wns_nm_DD_DEMOGOG_STAGING"} */


  create view "dev"."development"."wns_nm_DD_DEMOGOG_STAGING__dbt_tmp" as (
    CREATE TABLE wns_nm_DD_DEMOGOG_STAGING AS (
	SELECT SUBSCRIBER_KEY,CUSTOMER_NO,CARD_ID,GENDER,TRUNC(DOB) AS DOB,
			(CURRENT_DATE-TRUNC(DOB)) AS AGE,
			(CURRENT_DATE-TRUNC(DOB))/365 AS AGE_YEARS
	FROM (
		SELECT SUBSCRIBER_KEY,CUSTOMER_NO,CARD_ID,
				CASE WHEN GEND_IND BETWEEN 0000 AND 4999 THEN 'F'
					 WHEN GEND_IND BETWEEN 5000 AND 9999 THEN 'M'
					 ELSE 'UNKNOWN' END AS GENDER,
				CASE WHEN DATE_PART_YEAR(BIRTH_DATE) BETWEEN 2000 AND 2019 THEN BIRTH_DATE
					 WHEN DATE_PART_YEAR(BIRTH_DATE)BETWEEN 1900 AND 1919 THEN  DATEADD(YEAR,100,BIRTH_DATE)
					 WHEN DATE_PART_YEAR(BIRTH_DATE) BETWEEN 1920 AND 1999 THEN BIRTH_DATE
					 ELSE DATEADD(YEAR,-100,BIRTH_DATE) END AS DOB
		FROM (
			SELECT SUBSCRIBER_KEY,CUSTOMER_NO,CARD_ID,TRUNC(TO_DATE(LEFT(CARD_ID,6),'YYMMDD'))AS BIRTH_DATE,SUBSTRING(CARD_ID,7,4) AS GEND_IND
			FROM (
				SELECT SUBSCRIBER_KEY,CUSTOMER_NO,MAX(CARD_ID) AS CARD_ID
				FROM (
					SELECT SUBSCRIBER_KEY ,CUSTOMER_NO , CARDHOLDER_IDENTITY_NO AS CARD_ID
					FROM DEVELOPMENT.DIM_CUSTOMER_CARD_MAPPING
					WHERE CARD_ID IS NOT NULL AND CARD_ID <> -1)
					GROUP BY 1,2))));
  ) ;

2021-01-08 14:10:07.517067 (Thread-1): Postgres error: syntax error at or near "CREATE"
LINE 5:     CREATE TABLE wns_nm_DD_DEMOGOG_STAGING AS (
            ^

2021-01-08 14:10:07.517227 (Thread-1): On model.my_new_project.wns_nm_DD_DEMOGOG_STAGING: ROLLBACK
2021-01-08 14:10:07.585465 (Thread-1): finished collecting timing info
2021-01-08 14:10:07.585785 (Thread-1): On model.my_new_project.wns_nm_DD_DEMOGOG_STAGING: Close
2021-01-08 14:10:07.586298 (Thread-1): Database Error in model wns_nm_DD_DEMOGOG_STAGING (models/example/wns_nm_DD_DEMOGOG_STAGING.sql)
  syntax error at or near "CREATE"
  LINE 5:     CREATE TABLE wns_nm_DD_DEMOGOG_STAGING AS (
              ^
  compiled SQL at target/run/my_new_project/models/example/wns_nm_DD_DEMOGOG_STAGING.sql
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/postgres/connections.py", line 46, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 78, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.SyntaxError: syntax error at or near "CREATE"
LINE 5:     CREATE TABLE wns_nm_DD_DEMOGOG_STAGING AS (
            ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 276, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 378, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/run.py", line 233, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 61, in macro
  File "/usr/local/lib/python3.8/dist-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/lib/python3.8/dist-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 224, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 123, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 86, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/postgres/connections.py", line 57, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model wns_nm_DD_DEMOGOG_STAGING (models/example/wns_nm_DD_DEMOGOG_STAGING.sql)
  syntax error at or near "CREATE"
  LINE 5:     CREATE TABLE wns_nm_DD_DEMOGOG_STAGING AS (
              ^
  compiled SQL at target/run/my_new_project/models/example/wns_nm_DD_DEMOGOG_STAGING.sql
2021-01-08 14:10:07.586827 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '21041e39-c71c-40f1-8a03-3dfd99b9104a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd33c581790>]}
2021-01-08 14:10:07.587844 (Thread-1): 14:10:07 | 6 of 14 ERROR creating view model development.wns_nm_DD_DEMOGOG_STAGING [ERROR in 1.40s]
2021-01-08 14:10:07.587922 (Thread-1): Finished running node model.my_new_project.wns_nm_DD_DEMOGOG_STAGING
2021-01-08 14:10:07.588025 (Thread-1): Began running node model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1
2021-01-08 14:10:07.588816 (Thread-1): 14:10:07 | 7 of 14 START view model development.wns_nm_DD_UCID_HHI_DEMO_TEMP1... [RUN]
2021-01-08 14:10:07.589020 (Thread-1): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1".
2021-01-08 14:10:07.589093 (Thread-1): Compiling model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1
2021-01-08 14:10:07.594165 (Thread-1): Writing injected SQL for node "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1"
2021-01-08 14:10:07.599053 (Thread-94): handling poll request
2021-01-08 14:10:07.599415 (Thread-94): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e575d00>]}
2021-01-08 14:10:07.604538 (Thread-94): sending response (<Response 28824 bytes [200 OK]>) to 10.0.40.118
2021-01-08 14:10:07.606012 (Thread-1): finished collecting timing info
2021-01-08 14:10:07.611277 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1".
2021-01-08 14:10:07.611479 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1: BEGIN
2021-01-08 14:10:07.611539 (Thread-1): Opening a new connection, currently in state closed
2021-01-08 14:10:07.611580 (Thread-1): Connecting to Redshift using 'database' credentials
2021-01-08 14:10:08.228525 (Thread-1): SQL status: BEGIN in 0.62 seconds
2021-01-08 14:10:08.231703 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1".
2021-01-08 14:10:08.231812 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1"} */
drop view if exists "dev"."development"."wns_nm_DD_UCID_HHI_DEMO_TEMP1__dbt_tmp" cascade
2021-01-08 14:10:08.300691 (Thread-1): SQL status: DROP VIEW in 0.07 seconds
2021-01-08 14:10:08.301569 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1: COMMIT
2021-01-08 14:10:08.301695 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1".
2021-01-08 14:10:08.301786 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1: COMMIT
2021-01-08 14:10:08.386820 (Thread-1): SQL status: COMMIT in 0.08 seconds
2021-01-08 14:10:08.386996 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1".
2021-01-08 14:10:08.387049 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1: BEGIN
2021-01-08 14:10:08.455815 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:10:08.456017 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1: COMMIT
2021-01-08 14:10:08.456069 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1".
2021-01-08 14:10:08.456110 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1: COMMIT
2021-01-08 14:10:08.524571 (Thread-1): SQL status: COMMIT in 0.07 seconds
2021-01-08 14:10:08.524708 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1".
2021-01-08 14:10:08.524756 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1: BEGIN
2021-01-08 14:10:08.593546 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:10:08.595385 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1".
2021-01-08 14:10:08.595470 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1"} */
drop view if exists "dev"."development"."wns_nm_DD_UCID_HHI_DEMO_TEMP1__dbt_backup" cascade
2021-01-08 14:10:08.664166 (Thread-1): SQL status: DROP VIEW in 0.07 seconds
2021-01-08 14:10:08.665052 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1: COMMIT
2021-01-08 14:10:08.665142 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1".
2021-01-08 14:10:08.665190 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1: COMMIT
2021-01-08 14:10:08.759619 (Thread-1): SQL status: COMMIT in 0.09 seconds
2021-01-08 14:10:08.759850 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1".
2021-01-08 14:10:08.759930 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1: BEGIN
2021-01-08 14:10:08.828754 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:10:08.829636 (Thread-1): Writing runtime SQL for node "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1"
2021-01-08 14:10:08.844426 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1".
2021-01-08 14:10:08.844611 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1"} */


  create view "dev"."development"."wns_nm_DD_UCID_HHI_DEMO_TEMP1__dbt_tmp" as (
    CREATE TABLE wns_nm_DD_UCID_HHI_DEMO_TEMP1 AS (
	SELECT A.*,GENDER AS GENDER,BIRTH_DATE,DERIVED_RACE,AGE_DAYS,AGE_YEARS,LAST_UPDATED_DATE AS INFO_CHANGED_DATE, CURRENT_DATE AS CREATED_DATE
	FROM wns_nm_DD_UCID_HHI_INFO A
	LEFT JOIN (
		SELECT A.*,
				UPPER(DERIVED_RACE)  AS DERIVED_RACE,
				(CURRENT_DATE -A.BIRTH_DATE) AS AGE_DAYS,
				(CURRENT_DATE -A.BIRTH_DATE)/365 AS AGE_YEARS
		FROM ANALYTICS.FND_CUSTOMER_MASTER A
		LEFT JOIN DEVELOPMENT.FND_CUST_DERIVED_RACE_REF B
			ON UPPER(A.LAST_NAME)=UPPER(B.SURNAME)) B
		ON A.SUBSCRIBER_KEY=B.MASTER_SUBSCRIBER_KEY);
  ) ;

2021-01-08 14:10:08.914034 (Thread-1): Postgres error: syntax error at or near "CREATE"
LINE 5:     CREATE TABLE wns_nm_DD_UCID_HHI_DEMO_TEMP1 AS (
            ^

2021-01-08 14:10:08.914247 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1: ROLLBACK
2021-01-08 14:10:08.982872 (Thread-1): finished collecting timing info
2021-01-08 14:10:08.983205 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1: Close
2021-01-08 14:10:09.030738 (Thread-95): handling poll request
2021-01-08 14:10:09.031157 (Thread-95): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e432a90>]}
2021-01-08 14:10:09.034839 (Thread-95): sending response (<Response 16357 bytes [200 OK]>) to 10.0.32.130
2021-01-08 14:10:08.983716 (Thread-1): Database Error in model wns_nm_DD_UCID_HHI_DEMO_TEMP1 (models/example/wns_nm_DD_UCID_HHI_DEMO_TEMP1.sql)
  syntax error at or near "CREATE"
  LINE 5:     CREATE TABLE wns_nm_DD_UCID_HHI_DEMO_TEMP1 AS (
              ^
  compiled SQL at target/run/my_new_project/models/example/wns_nm_DD_UCID_HHI_DEMO_TEMP1.sql
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/postgres/connections.py", line 46, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 78, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.SyntaxError: syntax error at or near "CREATE"
LINE 5:     CREATE TABLE wns_nm_DD_UCID_HHI_DEMO_TEMP1 AS (
            ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 276, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 378, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/run.py", line 233, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 61, in macro
  File "/usr/local/lib/python3.8/dist-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/lib/python3.8/dist-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 224, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 123, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 86, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/postgres/connections.py", line 57, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model wns_nm_DD_UCID_HHI_DEMO_TEMP1 (models/example/wns_nm_DD_UCID_HHI_DEMO_TEMP1.sql)
  syntax error at or near "CREATE"
  LINE 5:     CREATE TABLE wns_nm_DD_UCID_HHI_DEMO_TEMP1 AS (
              ^
  compiled SQL at target/run/my_new_project/models/example/wns_nm_DD_UCID_HHI_DEMO_TEMP1.sql
2021-01-08 14:10:09.031810 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '21041e39-c71c-40f1-8a03-3dfd99b9104a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd33d93a190>]}
2021-01-08 14:10:09.032866 (Thread-1): 14:10:09 | 7 of 14 ERROR creating view model development.wns_nm_DD_UCID_HHI_DEMO_TEMP1 [ERROR in 1.44s]
2021-01-08 14:10:09.032958 (Thread-1): Finished running node model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1
2021-01-08 14:10:09.033057 (Thread-1): Began running node model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2
2021-01-08 14:10:09.033815 (Thread-1): 14:10:09 | 8 of 14 START view model development.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2. [RUN]
2021-01-08 14:10:09.034051 (Thread-1): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2".
2021-01-08 14:10:09.034123 (Thread-1): Compiling model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2
2021-01-08 14:10:09.039133 (Thread-1): Writing injected SQL for node "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2"
2021-01-08 14:10:09.050043 (Thread-1): finished collecting timing info
2021-01-08 14:10:09.055594 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2".
2021-01-08 14:10:09.055715 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2: BEGIN
2021-01-08 14:10:09.055795 (Thread-1): Opening a new connection, currently in state closed
2021-01-08 14:10:09.055839 (Thread-1): Connecting to Redshift using 'database' credentials
2021-01-08 14:10:09.666947 (Thread-1): SQL status: BEGIN in 0.61 seconds
2021-01-08 14:10:09.668888 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2".
2021-01-08 14:10:09.668981 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2"} */
drop view if exists "dev"."development"."wns_nm_DD_UCID_HHI_DEMO_TEMP1_2__dbt_tmp" cascade
2021-01-08 14:10:09.737143 (Thread-1): SQL status: DROP VIEW in 0.07 seconds
2021-01-08 14:10:09.738009 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2: COMMIT
2021-01-08 14:10:09.738095 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2".
2021-01-08 14:10:09.738141 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2: COMMIT
2021-01-08 14:10:09.825540 (Thread-1): SQL status: COMMIT in 0.09 seconds
2021-01-08 14:10:09.825700 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2".
2021-01-08 14:10:09.825750 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2: BEGIN
2021-01-08 14:10:09.893969 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:10:09.894212 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2: COMMIT
2021-01-08 14:10:09.894267 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2".
2021-01-08 14:10:09.894310 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2: COMMIT
2021-01-08 14:10:09.962133 (Thread-1): SQL status: COMMIT in 0.07 seconds
2021-01-08 14:10:09.962333 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2".
2021-01-08 14:10:09.962387 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2: BEGIN
2021-01-08 14:10:10.030652 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:10:10.032582 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2".
2021-01-08 14:10:10.032675 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2"} */
drop view if exists "dev"."development"."wns_nm_DD_UCID_HHI_DEMO_TEMP1_2__dbt_backup" cascade
2021-01-08 14:10:10.100678 (Thread-1): SQL status: DROP VIEW in 0.07 seconds
2021-01-08 14:10:10.101474 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2: COMMIT
2021-01-08 14:10:10.101550 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2".
2021-01-08 14:10:10.101597 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2: COMMIT
2021-01-08 14:10:10.195939 (Thread-1): SQL status: COMMIT in 0.09 seconds
2021-01-08 14:10:10.196121 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2".
2021-01-08 14:10:10.196173 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2: BEGIN
2021-01-08 14:10:10.264238 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:10:10.264880 (Thread-1): Writing runtime SQL for node "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2"
2021-01-08 14:10:10.276558 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2".
2021-01-08 14:10:10.276660 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2"} */


  create view "dev"."development"."wns_nm_DD_UCID_HHI_DEMO_TEMP1_2__dbt_tmp" as (
    CREATE TABLE wns_nm_DD_UCID_HHI_DEMO_TEMP1_2 AS (
	SELECT A.UCID, A.SUBSCRIBER_KEY , A.CUSTOMER_NO,A.CARD_TYPE,A.EA_CODE,A.INCOME_CLASS,A.HOUSEHOLD_INCOME_SUBRANGE,A.DERIVED_RACE,
			CASE WHEN B.AGE IS NULL THEN A.AGE_DAYS ELSE B.AGE END AS AGE_DAYS,
			CASE WHEN B.AGE_YEARS IS NULL THEN A.AGE_YEARS ELSE B.AGE_YEARS END AS AGE_YEARS,
			CASE WHEN B.GENDER IS NULL THEN A.GENDER ELSE B.GENDER END AS GENDER,
			CASE WHEN B.DOB IS NULL THEN A.BIRTH_DATE ELSE B.DOB END AS BIRTH_DATE,
			INFO_CHANGED_DATE,
			CREATED_DATE
	FROM wns_nm_DD_UCID_HHI_DEMO_TEMP1 A
	LEFT JOIN #wns_nm_DD_DEMOGOG_STAGING B
		ON A.SUBSCRIBER_KEY=B.SUBSCRIBER_KEY
			AND A.CUSTOMER_NO=B.CUSTOMER_NO);
  ) ;

2021-01-08 14:10:10.345426 (Thread-1): Postgres error: syntax error at or near "CREATE"
LINE 5:     CREATE TABLE wns_nm_DD_UCID_HHI_DEMO_TEMP1_2 AS (
            ^

2021-01-08 14:10:10.345565 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2: ROLLBACK
2021-01-08 14:10:10.413385 (Thread-1): finished collecting timing info
2021-01-08 14:10:10.413714 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2: Close
2021-01-08 14:10:10.414279 (Thread-1): Database Error in model wns_nm_DD_UCID_HHI_DEMO_TEMP1_2 (models/example/wns_nm_DD_UCID_HHI_DEMO_TEMP1_2.sql)
  syntax error at or near "CREATE"
  LINE 5:     CREATE TABLE wns_nm_DD_UCID_HHI_DEMO_TEMP1_2 AS (
              ^
  compiled SQL at target/run/my_new_project/models/example/wns_nm_DD_UCID_HHI_DEMO_TEMP1_2.sql
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/postgres/connections.py", line 46, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 78, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.SyntaxError: syntax error at or near "CREATE"
LINE 5:     CREATE TABLE wns_nm_DD_UCID_HHI_DEMO_TEMP1_2 AS (
            ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 276, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 378, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/run.py", line 233, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 61, in macro
  File "/usr/local/lib/python3.8/dist-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/lib/python3.8/dist-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 224, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 123, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 86, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/postgres/connections.py", line 57, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model wns_nm_DD_UCID_HHI_DEMO_TEMP1_2 (models/example/wns_nm_DD_UCID_HHI_DEMO_TEMP1_2.sql)
  syntax error at or near "CREATE"
  LINE 5:     CREATE TABLE wns_nm_DD_UCID_HHI_DEMO_TEMP1_2 AS (
              ^
  compiled SQL at target/run/my_new_project/models/example/wns_nm_DD_UCID_HHI_DEMO_TEMP1_2.sql
2021-01-08 14:10:10.414828 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '21041e39-c71c-40f1-8a03-3dfd99b9104a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd33c218550>]}
2021-01-08 14:10:10.415864 (Thread-1): 14:10:10 | 8 of 14 ERROR creating view model development.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2 [ERROR in 1.38s]
2021-01-08 14:10:10.415947 (Thread-1): Finished running node model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2
2021-01-08 14:10:10.416047 (Thread-1): Began running node model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2
2021-01-08 14:10:10.416823 (Thread-1): 14:10:10 | 9 of 14 START view model development.wns_nm_DD_UCID_HHI_DEMO_TEMP2... [RUN]
2021-01-08 14:10:10.417027 (Thread-1): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2".
2021-01-08 14:10:10.417099 (Thread-1): Compiling model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2
2021-01-08 14:10:10.422201 (Thread-1): Writing injected SQL for node "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2"
2021-01-08 14:10:10.438925 (Thread-96): handling poll request
2021-01-08 14:10:10.434133 (Thread-1): finished collecting timing info
2021-01-08 14:10:10.439616 (Thread-96): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e5a2b50>]}
2021-01-08 14:10:10.438984 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2".
2021-01-08 14:10:10.445098 (Thread-96): sending response (<Response 34394 bytes [200 OK]>) to 10.0.22.169
2021-01-08 14:10:10.439054 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2: BEGIN
2021-01-08 14:10:10.439110 (Thread-1): Opening a new connection, currently in state closed
2021-01-08 14:10:10.439151 (Thread-1): Connecting to Redshift using 'database' credentials
2021-01-08 14:10:11.062352 (Thread-1): SQL status: BEGIN in 0.62 seconds
2021-01-08 14:10:11.064322 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2".
2021-01-08 14:10:11.064407 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2"} */
drop view if exists "dev"."development"."wns_nm_DD_UCID_HHI_DEMO_TEMP2__dbt_tmp" cascade
2021-01-08 14:10:11.133908 (Thread-1): SQL status: DROP VIEW in 0.07 seconds
2021-01-08 14:10:11.134713 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2: COMMIT
2021-01-08 14:10:11.134785 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2".
2021-01-08 14:10:11.134831 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2: COMMIT
2021-01-08 14:10:11.223177 (Thread-1): SQL status: COMMIT in 0.09 seconds
2021-01-08 14:10:11.223352 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2".
2021-01-08 14:10:11.223404 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2: BEGIN
2021-01-08 14:10:11.292950 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:10:11.293169 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2: COMMIT
2021-01-08 14:10:11.293222 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2".
2021-01-08 14:10:11.293265 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2: COMMIT
2021-01-08 14:10:11.362397 (Thread-1): SQL status: COMMIT in 0.07 seconds
2021-01-08 14:10:11.362571 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2".
2021-01-08 14:10:11.362622 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2: BEGIN
2021-01-08 14:10:11.431986 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:10:11.433903 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2".
2021-01-08 14:10:11.433991 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2"} */
drop view if exists "dev"."development"."wns_nm_DD_UCID_HHI_DEMO_TEMP2__dbt_backup" cascade
2021-01-08 14:10:11.503345 (Thread-1): SQL status: DROP VIEW in 0.07 seconds
2021-01-08 14:10:11.504172 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2: COMMIT
2021-01-08 14:10:11.504256 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2".
2021-01-08 14:10:11.504304 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2: COMMIT
2021-01-08 14:10:11.599229 (Thread-1): SQL status: COMMIT in 0.09 seconds
2021-01-08 14:10:11.599404 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2".
2021-01-08 14:10:11.599457 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2: BEGIN
2021-01-08 14:10:11.668807 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:10:11.669451 (Thread-1): Writing runtime SQL for node "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2"
2021-01-08 14:10:11.682203 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2".
2021-01-08 14:10:11.682325 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2"} */


  create view "dev"."development"."wns_nm_DD_UCID_HHI_DEMO_TEMP2__dbt_tmp" as (
    CREATE TABLE  wns_nm_DD_UCID_HHI_DEMO_TEMP2 AS
	SELECT UCID,SUBSCRIBER_KEY,CARD_TYPE,EA_CODE,INCOME_CLASS,HOUSEHOLD_INCOME_SUBRANGE,
			DERIVED_RACE,BIRTH_DATE,AGE_DAYS,AGE_YEARS,GENDER,INFO_CHANGED_DATE,CREATED_DATE
	FROM
		(SELECT UCID,SUBSCRIBER_KEY,CARD_TYPE,EA_CODE,INCOME_CLASS,HOUSEHOLD_INCOME_SUBRANGE,
				DERIVED_RACE,BIRTH_DATE,AGE_DAYS,AGE_YEARS,GENDER,INFO_CHANGED_DATE,CREATED_DATE
		FROM wns_nm_DD_UCID_HHI_DEMO_TEMP1_2
		WHERE UCID IN (
			SELECT UCID FROM (
				SELECT UCID, SUBSCRIBER_KEY, COUNT(*)AS CNT
				FROM wns_nm_DD_UCID_HHI_DEMO_TEMP1_2
				GROUP BY 1,2)
			WHERE CNT=1)
		ORDER BY UCID)
		UNION
		(SELECT UCID,SUBSCRIBER_KEY,CARD_TYPE,EA_CODE,INCOME_CLASS,HOUSEHOLD_INCOME_SUBRANGE,
				DERIVED_RACE,BIRTH_DATE,AGE_DAYS,AGE_YEARS,GENDER,INFO_CHANGED_DATE,CREATED_DATE
		FROM wns_nm_DD_UCID_HHI_DEMO_TEMP1_2
		WHERE UCID IN (
			SELECT UCID FROM (
				SELECT UCID, SUBSCRIBER_KEY, COUNT(*)AS CNT
				FROM wns_nm_DD_UCID_HHI_DEMO_TEMP1_2
				GROUP BY 1,2)
			WHERE CNT>1)
			AND CUSTOMER_NO IS NOT NULL
		GROUP BY UCID,SUBSCRIBER_KEY,CARD_TYPE,EA_CODE,INCOME_CLASS,HOUSEHOLD_INCOME_SUBRANGE,
				DERIVED_RACE,BIRTH_DATE,AGE_DAYS,AGE_YEARS,GENDER,INFO_CHANGED_DATE,CREATED_DATE
		ORDER BY UCID);
  ) ;

2021-01-08 14:10:11.752650 (Thread-1): Postgres error: syntax error at or near "CREATE"
LINE 5:     CREATE TABLE  wns_nm_DD_UCID_HHI_DEMO_TEMP2 AS
            ^

2021-01-08 14:10:11.752792 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2: ROLLBACK
2021-01-08 14:10:11.821935 (Thread-1): finished collecting timing info
2021-01-08 14:10:11.822295 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2: Close
2021-01-08 14:10:11.822806 (Thread-1): Database Error in model wns_nm_DD_UCID_HHI_DEMO_TEMP2 (models/example/wns_nm_DD_UCID_HHI_DEMO_TEMP2.sql)
  syntax error at or near "CREATE"
  LINE 5:     CREATE TABLE  wns_nm_DD_UCID_HHI_DEMO_TEMP2 AS
              ^
  compiled SQL at target/run/my_new_project/models/example/wns_nm_DD_UCID_HHI_DEMO_TEMP2.sql
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/postgres/connections.py", line 46, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 78, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.SyntaxError: syntax error at or near "CREATE"
LINE 5:     CREATE TABLE  wns_nm_DD_UCID_HHI_DEMO_TEMP2 AS
            ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 276, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 378, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/run.py", line 233, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 61, in macro
  File "/usr/local/lib/python3.8/dist-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/lib/python3.8/dist-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 224, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 123, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 86, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/postgres/connections.py", line 57, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model wns_nm_DD_UCID_HHI_DEMO_TEMP2 (models/example/wns_nm_DD_UCID_HHI_DEMO_TEMP2.sql)
  syntax error at or near "CREATE"
  LINE 5:     CREATE TABLE  wns_nm_DD_UCID_HHI_DEMO_TEMP2 AS
              ^
  compiled SQL at target/run/my_new_project/models/example/wns_nm_DD_UCID_HHI_DEMO_TEMP2.sql
2021-01-08 14:10:11.823362 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '21041e39-c71c-40f1-8a03-3dfd99b9104a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd33d6ce4f0>]}
2021-01-08 14:10:11.824418 (Thread-1): 14:10:11 | 9 of 14 ERROR creating view model development.wns_nm_DD_UCID_HHI_DEMO_TEMP2 [ERROR in 1.41s]
2021-01-08 14:10:11.824500 (Thread-1): Finished running node model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2
2021-01-08 14:10:11.824603 (Thread-1): Began running node model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3
2021-01-08 14:10:11.825373 (Thread-1): 14:10:11 | 10 of 14 START view model development.wns_nm_DD_UCID_HHI_DEMO_TEMP3.. [RUN]
2021-01-08 14:10:11.825589 (Thread-1): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3".
2021-01-08 14:10:11.825662 (Thread-1): Compiling model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3
2021-01-08 14:10:11.831530 (Thread-1): Writing injected SQL for node "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3"
2021-01-08 14:10:11.842364 (Thread-1): finished collecting timing info
2021-01-08 14:10:11.847497 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3".
2021-01-08 14:10:11.847575 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3: BEGIN
2021-01-08 14:10:11.847737 (Thread-1): Opening a new connection, currently in state closed
2021-01-08 14:10:11.847784 (Thread-1): Connecting to Redshift using 'database' credentials
2021-01-08 14:10:11.875164 (Thread-97): handling poll request
2021-01-08 14:10:11.875554 (Thread-97): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f219220>]}
2021-01-08 14:10:11.880186 (Thread-97): sending response (<Response 26584 bytes [200 OK]>) to 10.0.2.160
2021-01-08 14:10:12.462299 (Thread-1): SQL status: BEGIN in 0.61 seconds
2021-01-08 14:10:12.464125 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3".
2021-01-08 14:10:12.464217 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3"} */
drop view if exists "dev"."development"."wns_nm_DD_UCID_HHI_DEMO_TEMP3__dbt_tmp" cascade
2021-01-08 14:10:12.532964 (Thread-1): SQL status: DROP VIEW in 0.07 seconds
2021-01-08 14:10:12.533811 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3: COMMIT
2021-01-08 14:10:12.533896 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3".
2021-01-08 14:10:12.533942 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3: COMMIT
2021-01-08 14:10:12.618938 (Thread-1): SQL status: COMMIT in 0.08 seconds
2021-01-08 14:10:12.619126 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3".
2021-01-08 14:10:12.619179 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3: BEGIN
2021-01-08 14:10:12.687680 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:10:12.687888 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3: COMMIT
2021-01-08 14:10:12.687940 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3".
2021-01-08 14:10:12.687983 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3: COMMIT
2021-01-08 14:10:12.756310 (Thread-1): SQL status: COMMIT in 0.07 seconds
2021-01-08 14:10:12.756496 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3".
2021-01-08 14:10:12.756549 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3: BEGIN
2021-01-08 14:10:12.826341 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:10:12.829140 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3".
2021-01-08 14:10:12.829276 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3"} */
drop view if exists "dev"."development"."wns_nm_DD_UCID_HHI_DEMO_TEMP3__dbt_backup" cascade
2021-01-08 14:10:12.898080 (Thread-1): SQL status: DROP VIEW in 0.07 seconds
2021-01-08 14:10:12.898974 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3: COMMIT
2021-01-08 14:10:12.899060 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3".
2021-01-08 14:10:12.899107 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3: COMMIT
2021-01-08 14:10:12.996911 (Thread-1): SQL status: COMMIT in 0.10 seconds
2021-01-08 14:10:12.997081 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3".
2021-01-08 14:10:12.997133 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3: BEGIN
2021-01-08 14:10:13.065619 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:10:13.066244 (Thread-1): Writing runtime SQL for node "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3"
2021-01-08 14:10:13.077166 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3".
2021-01-08 14:10:13.077266 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3"} */


  create view "dev"."development"."wns_nm_DD_UCID_HHI_DEMO_TEMP3__dbt_tmp" as (
    CREATE TABLE  wns_nm_DD_UCID_HHI_DEMO_TEMP3 AS
	SELECT UCID,CARD_TYPE,INCOME_CLASS,HOUSEHOLD_INCOME_SUBRANGE,DERIVED_RACE,
			BIRTH_DATE,AGE_DAYS,AGE_YEARS,GENDER,INFO_CHANGED_DATE,CREATED_DATE
	FROM
		(SELECT UCID,CARD_TYPE,INCOME_CLASS,HOUSEHOLD_INCOME_SUBRANGE,DERIVED_RACE,
				BIRTH_DATE,AGE_DAYS,AGE_YEARS,GENDER,INFO_CHANGED_DATE,CREATED_DATE
		FROM wns_nm_DD_UCID_HHI_DEMO_TEMP2
		WHERE UCID IN (
			SELECT UCID FROM (
				SELECT UCID, COUNT(*)AS CNT
				FROM wns_nm_DD_UCID_HHI_DEMO_TEMP2
				GROUP BY 1)
			WHERE CNT=1)
		ORDER BY UCID)
		UNION
		(SELECT UCID,CARD_TYPE,INCOME_CLASS,HOUSEHOLD_INCOME_SUBRANGE,DERIVED_RACE,
				BIRTH_DATE,AGE_DAYS,AGE_YEARS,GENDER,INFO_CHANGED_DATE,CREATED_DATE
		FROM wns_nm_DD_UCID_HHI_DEMO_TEMP2
		WHERE UCID IN (
			SELECT UCID FROM (
				SELECT UCID, COUNT(*)AS CNT
				FROM wns_nm_DD_UCID_HHI_DEMO_TEMP2
				GROUP BY 1)
			WHERE CNT>1)
		AND SUBSCRIBER_KEY IS NOT NULL
		GROUP BY UCID,CARD_TYPE,INCOME_CLASS,HOUSEHOLD_INCOME_SUBRANGE,DERIVED_RACE,
				BIRTH_DATE,AGE_DAYS,AGE_YEARS,GENDER,INFO_CHANGED_DATE,CREATED_DATE
		ORDER BY UCID);
  ) ;

2021-01-08 14:10:13.146751 (Thread-1): Postgres error: syntax error at or near "CREATE"
LINE 5:     CREATE TABLE  wns_nm_DD_UCID_HHI_DEMO_TEMP3 AS
            ^

2021-01-08 14:10:13.146900 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3: ROLLBACK
2021-01-08 14:10:13.215146 (Thread-1): finished collecting timing info
2021-01-08 14:10:13.215475 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3: Close
2021-01-08 14:10:13.216007 (Thread-1): Database Error in model wns_nm_DD_UCID_HHI_DEMO_TEMP3 (models/wns_nm_DD_UCID_HHI_DEMO_TEMP3.sql)
  syntax error at or near "CREATE"
  LINE 5:     CREATE TABLE  wns_nm_DD_UCID_HHI_DEMO_TEMP3 AS
              ^
  compiled SQL at target/run/my_new_project/models/wns_nm_DD_UCID_HHI_DEMO_TEMP3.sql
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/postgres/connections.py", line 46, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 78, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.SyntaxError: syntax error at or near "CREATE"
LINE 5:     CREATE TABLE  wns_nm_DD_UCID_HHI_DEMO_TEMP3 AS
            ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 276, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 378, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/run.py", line 233, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 61, in macro
  File "/usr/local/lib/python3.8/dist-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/lib/python3.8/dist-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 224, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 123, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 86, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/postgres/connections.py", line 57, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model wns_nm_DD_UCID_HHI_DEMO_TEMP3 (models/wns_nm_DD_UCID_HHI_DEMO_TEMP3.sql)
  syntax error at or near "CREATE"
  LINE 5:     CREATE TABLE  wns_nm_DD_UCID_HHI_DEMO_TEMP3 AS
              ^
  compiled SQL at target/run/my_new_project/models/wns_nm_DD_UCID_HHI_DEMO_TEMP3.sql
2021-01-08 14:10:13.216545 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '21041e39-c71c-40f1-8a03-3dfd99b9104a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd33d8e82b0>]}
2021-01-08 14:10:13.217695 (Thread-1): 14:10:13 | 10 of 14 ERROR creating view model development.wns_nm_DD_UCID_HHI_DEMO_TEMP3 [ERROR in 1.39s]
2021-01-08 14:10:13.217781 (Thread-1): Finished running node model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3
2021-01-08 14:10:13.217897 (Thread-1): Began running node model.my_new_project.wns_nm_DD_UCID_HHI_INFO
2021-01-08 14:10:13.218990 (Thread-1): 14:10:13 | 11 of 14 START view model development.wns_nm_DD_UCID_HHI_INFO........ [RUN]
2021-01-08 14:10:13.219207 (Thread-1): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_INFO".
2021-01-08 14:10:13.219281 (Thread-1): Compiling model.my_new_project.wns_nm_DD_UCID_HHI_INFO
2021-01-08 14:10:13.224213 (Thread-1): Writing injected SQL for node "model.my_new_project.wns_nm_DD_UCID_HHI_INFO"
2021-01-08 14:10:13.237442 (Thread-1): finished collecting timing info
2021-01-08 14:10:13.242506 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_INFO".
2021-01-08 14:10:13.242581 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_INFO: BEGIN
2021-01-08 14:10:13.242639 (Thread-1): Opening a new connection, currently in state closed
2021-01-08 14:10:13.242797 (Thread-1): Connecting to Redshift using 'database' credentials
2021-01-08 14:10:13.309993 (Thread-98): handling poll request
2021-01-08 14:10:13.310434 (Thread-98): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f206bb0>]}
2021-01-08 14:10:13.314788 (Thread-98): sending response (<Response 25240 bytes [200 OK]>) to 10.0.35.111
2021-01-08 14:10:13.857743 (Thread-1): SQL status: BEGIN in 0.62 seconds
2021-01-08 14:10:13.859606 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_INFO".
2021-01-08 14:10:13.859694 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_INFO: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.wns_nm_DD_UCID_HHI_INFO"} */
drop view if exists "dev"."development"."wns_nm_DD_UCID_HHI_INFO__dbt_tmp" cascade
2021-01-08 14:10:13.928439 (Thread-1): SQL status: DROP VIEW in 0.07 seconds
2021-01-08 14:10:13.929289 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_INFO: COMMIT
2021-01-08 14:10:13.929373 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_INFO".
2021-01-08 14:10:13.929420 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_INFO: COMMIT
2021-01-08 14:10:14.013826 (Thread-1): SQL status: COMMIT in 0.08 seconds
2021-01-08 14:10:14.014002 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_INFO".
2021-01-08 14:10:14.014054 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_INFO: BEGIN
2021-01-08 14:10:14.082656 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:10:14.082878 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_INFO: COMMIT
2021-01-08 14:10:14.082932 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_INFO".
2021-01-08 14:10:14.082975 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_INFO: COMMIT
2021-01-08 14:10:14.151311 (Thread-1): SQL status: COMMIT in 0.07 seconds
2021-01-08 14:10:14.151485 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_INFO".
2021-01-08 14:10:14.151536 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_INFO: BEGIN
2021-01-08 14:10:14.220127 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:10:14.222885 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_INFO".
2021-01-08 14:10:14.223048 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_INFO: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.wns_nm_DD_UCID_HHI_INFO"} */
drop view if exists "dev"."development"."wns_nm_DD_UCID_HHI_INFO__dbt_backup" cascade
2021-01-08 14:10:14.291485 (Thread-1): SQL status: DROP VIEW in 0.07 seconds
2021-01-08 14:10:14.292355 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_INFO: COMMIT
2021-01-08 14:10:14.292449 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_INFO".
2021-01-08 14:10:14.292495 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_INFO: COMMIT
2021-01-08 14:10:14.386622 (Thread-1): SQL status: COMMIT in 0.09 seconds
2021-01-08 14:10:14.386797 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_INFO".
2021-01-08 14:10:14.386849 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_INFO: BEGIN
2021-01-08 14:10:14.455486 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:10:14.456127 (Thread-1): Writing runtime SQL for node "model.my_new_project.wns_nm_DD_UCID_HHI_INFO"
2021-01-08 14:10:14.468648 (Thread-1): Using redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_INFO".
2021-01-08 14:10:14.468771 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_INFO: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.wns_nm_DD_UCID_HHI_INFO"} */


  create view "dev"."development"."wns_nm_DD_UCID_HHI_INFO__dbt_tmp" as (
    CREATE TABLE wns_nm_DD_UCID_HHI_INFO AS (
	SELECT A.*, B.EA_CODE,INCOME_CLASS,HOUSEHOLD_INCOME_SUBRANGE
	FROM (
		SELECT UCID,SUBSCRIBER_KEY,CUSTOMER_NO,CARD_TYPE
		FROM wns_nm_DD_TT_UCID_REFTABLE
		GROUP BY 1,2,3,4) A
	LEFT JOIN (
		SELECT CUSTOMER_NO, EA_CODE
		FROM ANALYTICS.FND_CUSTOMER
		GROUP BY 1,2) B
	ON A.CUSTOMER_NO=B.CUSTOMER_NO
	LEFT JOIN (
		SELECT EA_CODE,RACE_CODE,INCOME_CLASS,HOUSEHOLD_INCOME_SUBRANGE,AVERAGE_ADULT_AGE
		FROM DEVELOPMENT.FND_LST_EA_CODES
		GROUP BY 1,2,3,4,5) C
	ON B.EA_CODE=C.EA_CODE);
-- Execution time: 16.48s
  ) ;

2021-01-08 14:10:14.537820 (Thread-1): Postgres error: syntax error at or near "CREATE"
LINE 5:     CREATE TABLE wns_nm_DD_UCID_HHI_INFO AS (
            ^

2021-01-08 14:10:14.537973 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_INFO: ROLLBACK
2021-01-08 14:10:14.606209 (Thread-1): finished collecting timing info
2021-01-08 14:10:14.606514 (Thread-1): On model.my_new_project.wns_nm_DD_UCID_HHI_INFO: Close
2021-01-08 14:10:14.607014 (Thread-1): Database Error in model wns_nm_DD_UCID_HHI_INFO (models/example/wns_nm_DD_UCID_HHI_INFO.sql)
  syntax error at or near "CREATE"
  LINE 5:     CREATE TABLE wns_nm_DD_UCID_HHI_INFO AS (
              ^
  compiled SQL at target/run/my_new_project/models/example/wns_nm_DD_UCID_HHI_INFO.sql
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/postgres/connections.py", line 46, in exception_handler
    yield
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 78, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.SyntaxError: syntax error at or near "CREATE"
LINE 5:     CREATE TABLE wns_nm_DD_UCID_HHI_INFO AS (
            ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 276, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/base.py", line 378, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/dist-packages/dbt/task/run.py", line 233, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 61, in macro
  File "/usr/local/lib/python3.8/dist-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/lib/python3.8/dist-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/base/impl.py", line 224, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 123, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/sql/connections.py", line 86, in add_query
    return connection, cursor
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/dist-packages/dbt/adapters/postgres/connections.py", line 57, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model wns_nm_DD_UCID_HHI_INFO (models/example/wns_nm_DD_UCID_HHI_INFO.sql)
  syntax error at or near "CREATE"
  LINE 5:     CREATE TABLE wns_nm_DD_UCID_HHI_INFO AS (
              ^
  compiled SQL at target/run/my_new_project/models/example/wns_nm_DD_UCID_HHI_INFO.sql
2021-01-08 14:10:14.607548 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '21041e39-c71c-40f1-8a03-3dfd99b9104a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd33d8ae280>]}
2021-01-08 14:10:14.608644 (Thread-1): 14:10:14 | 11 of 14 ERROR creating view model development.wns_nm_DD_UCID_HHI_INFO [ERROR in 1.39s]
2021-01-08 14:10:14.608728 (Thread-1): Finished running node model.my_new_project.wns_nm_DD_UCID_HHI_INFO
2021-01-08 14:10:14.608831 (Thread-1): Began running node model.my_new_project.top_nations
2021-01-08 14:10:14.609897 (Thread-1): 14:10:14 | 12 of 14 START table model development.top_nations................... [RUN]
2021-01-08 14:10:14.610112 (Thread-1): Acquiring new redshift connection "model.my_new_project.top_nations".
2021-01-08 14:10:14.610207 (Thread-1): Compiling model.my_new_project.top_nations
2021-01-08 14:10:14.617100 (Thread-1): Writing injected SQL for node "model.my_new_project.top_nations"
2021-01-08 14:10:14.629101 (Thread-1): finished collecting timing info
2021-01-08 14:10:14.633983 (Thread-1): Using redshift connection "model.my_new_project.top_nations".
2021-01-08 14:10:14.634054 (Thread-1): On model.my_new_project.top_nations: BEGIN
2021-01-08 14:10:14.634110 (Thread-1): Opening a new connection, currently in state closed
2021-01-08 14:10:14.634152 (Thread-1): Connecting to Redshift using 'database' credentials
2021-01-08 14:10:14.729350 (Thread-99): handling poll request
2021-01-08 14:10:14.729753 (Thread-99): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e61c9a0>]}
2021-01-08 14:10:14.734103 (Thread-99): sending response (<Response 23972 bytes [200 OK]>) to 10.0.22.169
2021-01-08 14:10:15.252168 (Thread-1): SQL status: BEGIN in 0.62 seconds
2021-01-08 14:10:15.254157 (Thread-1): Using redshift connection "model.my_new_project.top_nations".
2021-01-08 14:10:15.254301 (Thread-1): On model.my_new_project.top_nations: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.top_nations"} */
drop table if exists "dev"."development"."top_nations__dbt_tmp" cascade
2021-01-08 14:10:15.323623 (Thread-1): SQL status: DROP TABLE in 0.07 seconds
2021-01-08 14:10:15.324458 (Thread-1): On model.my_new_project.top_nations: COMMIT
2021-01-08 14:10:15.324540 (Thread-1): Using redshift connection "model.my_new_project.top_nations".
2021-01-08 14:10:15.324587 (Thread-1): On model.my_new_project.top_nations: COMMIT
2021-01-08 14:10:15.395471 (Thread-1): SQL status: COMMIT in 0.07 seconds
2021-01-08 14:10:15.395642 (Thread-1): Using redshift connection "model.my_new_project.top_nations".
2021-01-08 14:10:15.395695 (Thread-1): On model.my_new_project.top_nations: BEGIN
2021-01-08 14:10:15.464467 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:10:15.464680 (Thread-1): On model.my_new_project.top_nations: COMMIT
2021-01-08 14:10:15.464732 (Thread-1): Using redshift connection "model.my_new_project.top_nations".
2021-01-08 14:10:15.464776 (Thread-1): On model.my_new_project.top_nations: COMMIT
2021-01-08 14:10:15.533313 (Thread-1): SQL status: COMMIT in 0.07 seconds
2021-01-08 14:10:15.533480 (Thread-1): Using redshift connection "model.my_new_project.top_nations".
2021-01-08 14:10:15.533531 (Thread-1): On model.my_new_project.top_nations: BEGIN
2021-01-08 14:10:15.602271 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:10:15.604069 (Thread-1): Using redshift connection "model.my_new_project.top_nations".
2021-01-08 14:10:15.604165 (Thread-1): On model.my_new_project.top_nations: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.top_nations"} */
drop table if exists "dev"."development"."top_nations__dbt_backup" cascade
2021-01-08 14:10:15.672885 (Thread-1): SQL status: DROP TABLE in 0.07 seconds
2021-01-08 14:10:15.673709 (Thread-1): On model.my_new_project.top_nations: COMMIT
2021-01-08 14:10:15.673796 (Thread-1): Using redshift connection "model.my_new_project.top_nations".
2021-01-08 14:10:15.673862 (Thread-1): On model.my_new_project.top_nations: COMMIT
2021-01-08 14:10:15.744509 (Thread-1): SQL status: COMMIT in 0.07 seconds
2021-01-08 14:10:15.744687 (Thread-1): Using redshift connection "model.my_new_project.top_nations".
2021-01-08 14:10:15.744739 (Thread-1): On model.my_new_project.top_nations: BEGIN
2021-01-08 14:10:15.813662 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:10:15.814577 (Thread-1): Writing runtime SQL for node "model.my_new_project.top_nations"
2021-01-08 14:10:15.826065 (Thread-1): Using redshift connection "model.my_new_project.top_nations".
2021-01-08 14:10:15.826155 (Thread-1): On model.my_new_project.top_nations: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.top_nations"} */


  create  table
    "dev"."development"."top_nations__dbt_tmp"
    
    
  as (
    /*
   Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
   SPDX-License-Identifier: MIT-0
*/


/*
    Find 3 nations with the most active customers
*/



select n_name, n_comment, count(*) as active_buyers
from nation n left join "dev"."development"."top_customers" c on n.n_nationkey = c.c_nationkey
group by n_name, n_comment
order by active_buyers desc
limit 5
  );
2021-01-08 14:10:16.215065 (Thread-100): handling poll request
2021-01-08 14:10:16.215495 (Thread-100): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f46abe0>]}
2021-01-08 14:10:16.218557 (Thread-100): sending response (<Response 11560 bytes [200 OK]>) to 10.0.43.37
2021-01-08 14:10:16.460674 (Thread-1): SQL status: SELECT in 0.63 seconds
2021-01-08 14:10:16.463478 (Thread-1): Using redshift connection "model.my_new_project.top_nations".
2021-01-08 14:10:16.463570 (Thread-1): On model.my_new_project.top_nations: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.top_nations"} */
alter table "dev"."development"."top_nations__dbt_tmp" rename to "top_nations"
2021-01-08 14:10:16.532833 (Thread-1): SQL status: ALTER TABLE in 0.07 seconds
2021-01-08 14:10:16.533964 (Thread-1): On model.my_new_project.top_nations: COMMIT
2021-01-08 14:10:16.534054 (Thread-1): Using redshift connection "model.my_new_project.top_nations".
2021-01-08 14:10:16.534097 (Thread-1): On model.my_new_project.top_nations: COMMIT
2021-01-08 14:10:16.635025 (Thread-1): SQL status: COMMIT in 0.10 seconds
2021-01-08 14:10:16.635379 (Thread-1): Using redshift connection "model.my_new_project.top_nations".
2021-01-08 14:10:16.635442 (Thread-1): On model.my_new_project.top_nations: BEGIN
2021-01-08 14:10:16.705007 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:10:16.707855 (Thread-1): Using redshift connection "model.my_new_project.top_nations".
2021-01-08 14:10:16.707949 (Thread-1): On model.my_new_project.top_nations: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.top_nations"} */
drop table if exists "dev"."development"."top_nations__dbt_backup" cascade
2021-01-08 14:10:16.777165 (Thread-1): SQL status: DROP TABLE in 0.07 seconds
2021-01-08 14:10:16.778036 (Thread-1): On model.my_new_project.top_nations: COMMIT
2021-01-08 14:10:16.778122 (Thread-1): Using redshift connection "model.my_new_project.top_nations".
2021-01-08 14:10:16.778169 (Thread-1): On model.my_new_project.top_nations: COMMIT
2021-01-08 14:10:16.849223 (Thread-1): SQL status: COMMIT in 0.07 seconds
2021-01-08 14:10:16.849456 (Thread-1): Using redshift connection "model.my_new_project.top_nations".
2021-01-08 14:10:16.849536 (Thread-1): On model.my_new_project.top_nations: BEGIN
2021-01-08 14:10:16.918540 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:10:16.920215 (Thread-1): finished collecting timing info
2021-01-08 14:10:16.920430 (Thread-1): On model.my_new_project.top_nations: ROLLBACK
2021-01-08 14:10:16.989137 (Thread-1): On model.my_new_project.top_nations: Close
2021-01-08 14:10:16.990268 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '21041e39-c71c-40f1-8a03-3dfd99b9104a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd33da3f730>]}
2021-01-08 14:10:16.991940 (Thread-1): 14:10:16 | 12 of 14 OK created table model development.top_nations.............. [SELECT in 2.38s]
2021-01-08 14:10:16.992072 (Thread-1): Finished running node model.my_new_project.top_nations
2021-01-08 14:10:16.992238 (Thread-1): Began running node model.my_new_project.foobar-script-a
2021-01-08 14:10:16.992382 (Thread-1): 14:10:16 | 13 of 14 SKIP relation development.foobar-script-a................... [SKIP]
2021-01-08 14:10:16.992479 (Thread-1): Finished running node model.my_new_project.foobar-script-a
2021-01-08 14:10:16.993354 (Thread-1): Began running node model.my_new_project.top_customers_rs
2021-01-08 14:10:16.994743 (Thread-1): 14:10:16 | 14 of 14 START table model development.top_customers_rs.............. [RUN]
2021-01-08 14:10:16.995085 (Thread-1): Acquiring new redshift connection "model.my_new_project.top_customers_rs".
2021-01-08 14:10:16.995207 (Thread-1): Compiling model.my_new_project.top_customers_rs
2021-01-08 14:10:17.004954 (Thread-1): Writing injected SQL for node "model.my_new_project.top_customers_rs"
2021-01-08 14:10:17.017352 (Thread-1): finished collecting timing info
2021-01-08 14:10:17.022421 (Thread-1): Using redshift connection "model.my_new_project.top_customers_rs".
2021-01-08 14:10:17.022494 (Thread-1): On model.my_new_project.top_customers_rs: BEGIN
2021-01-08 14:10:17.022552 (Thread-1): Opening a new connection, currently in state closed
2021-01-08 14:10:17.022593 (Thread-1): Connecting to Redshift using 'database' credentials
2021-01-08 14:10:17.635788 (Thread-1): SQL status: BEGIN in 0.61 seconds
2021-01-08 14:10:17.637631 (Thread-1): Using redshift connection "model.my_new_project.top_customers_rs".
2021-01-08 14:10:17.637728 (Thread-1): On model.my_new_project.top_customers_rs: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.top_customers_rs"} */
drop table if exists "dev"."development"."top_customers_rs__dbt_tmp" cascade
2021-01-08 14:10:17.693081 (Thread-101): handling poll request
2021-01-08 14:10:17.693477 (Thread-101): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e23e130>]}
2021-01-08 14:10:17.697376 (Thread-101): sending response (<Response 16682 bytes [200 OK]>) to 10.0.22.169
2021-01-08 14:10:17.706385 (Thread-1): SQL status: DROP TABLE in 0.07 seconds
2021-01-08 14:10:17.707228 (Thread-1): On model.my_new_project.top_customers_rs: COMMIT
2021-01-08 14:10:17.707313 (Thread-1): Using redshift connection "model.my_new_project.top_customers_rs".
2021-01-08 14:10:17.707361 (Thread-1): On model.my_new_project.top_customers_rs: COMMIT
2021-01-08 14:10:17.777968 (Thread-1): SQL status: COMMIT in 0.07 seconds
2021-01-08 14:10:17.778133 (Thread-1): Using redshift connection "model.my_new_project.top_customers_rs".
2021-01-08 14:10:17.778208 (Thread-1): On model.my_new_project.top_customers_rs: BEGIN
2021-01-08 14:10:17.846650 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:10:17.846856 (Thread-1): On model.my_new_project.top_customers_rs: COMMIT
2021-01-08 14:10:17.846909 (Thread-1): Using redshift connection "model.my_new_project.top_customers_rs".
2021-01-08 14:10:17.846950 (Thread-1): On model.my_new_project.top_customers_rs: COMMIT
2021-01-08 14:10:17.915105 (Thread-1): SQL status: COMMIT in 0.07 seconds
2021-01-08 14:10:17.915331 (Thread-1): Using redshift connection "model.my_new_project.top_customers_rs".
2021-01-08 14:10:17.915412 (Thread-1): On model.my_new_project.top_customers_rs: BEGIN
2021-01-08 14:10:17.983744 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:10:17.985712 (Thread-1): Using redshift connection "model.my_new_project.top_customers_rs".
2021-01-08 14:10:17.985804 (Thread-1): On model.my_new_project.top_customers_rs: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.top_customers_rs"} */
drop table if exists "dev"."development"."top_customers_rs__dbt_backup" cascade
2021-01-08 14:10:18.054197 (Thread-1): SQL status: DROP TABLE in 0.07 seconds
2021-01-08 14:10:18.055008 (Thread-1): On model.my_new_project.top_customers_rs: COMMIT
2021-01-08 14:10:18.055083 (Thread-1): Using redshift connection "model.my_new_project.top_customers_rs".
2021-01-08 14:10:18.055130 (Thread-1): On model.my_new_project.top_customers_rs: COMMIT
2021-01-08 14:10:18.125305 (Thread-1): SQL status: COMMIT in 0.07 seconds
2021-01-08 14:10:18.125473 (Thread-1): Using redshift connection "model.my_new_project.top_customers_rs".
2021-01-08 14:10:18.125525 (Thread-1): On model.my_new_project.top_customers_rs: BEGIN
2021-01-08 14:10:18.193714 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:10:18.194605 (Thread-1): Writing runtime SQL for node "model.my_new_project.top_customers_rs"
2021-01-08 14:10:18.210575 (Thread-1): Using redshift connection "model.my_new_project.top_customers_rs".
2021-01-08 14:10:18.210718 (Thread-1): On model.my_new_project.top_customers_rs: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.top_customers_rs"} */


  create  table
    "dev"."development"."top_customers_rs__dbt_tmp"
    
    
  as (
    /*
   Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
   SPDX-License-Identifier: MIT-0
*/


/*
    Find 3 nations with the most active customers
*/



select n_name, active_buyers
from "dev"."development"."top_nations"
group by n_name, active_buyers
order by active_buyers desc
limit 1
  );
2021-01-08 14:10:18.889214 (Thread-1): SQL status: SELECT in 0.68 seconds
2021-01-08 14:10:18.891943 (Thread-1): Using redshift connection "model.my_new_project.top_customers_rs".
2021-01-08 14:10:18.892035 (Thread-1): On model.my_new_project.top_customers_rs: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.top_customers_rs"} */
alter table "dev"."development"."top_customers_rs__dbt_tmp" rename to "top_customers_rs"
2021-01-08 14:10:18.960799 (Thread-1): SQL status: ALTER TABLE in 0.07 seconds
2021-01-08 14:10:18.961884 (Thread-1): On model.my_new_project.top_customers_rs: COMMIT
2021-01-08 14:10:18.961968 (Thread-1): Using redshift connection "model.my_new_project.top_customers_rs".
2021-01-08 14:10:18.962011 (Thread-1): On model.my_new_project.top_customers_rs: COMMIT
2021-01-08 14:10:19.064383 (Thread-1): SQL status: COMMIT in 0.10 seconds
2021-01-08 14:10:19.064705 (Thread-1): Using redshift connection "model.my_new_project.top_customers_rs".
2021-01-08 14:10:19.064765 (Thread-1): On model.my_new_project.top_customers_rs: BEGIN
2021-01-08 14:10:19.133705 (Thread-102): handling poll request
2021-01-08 14:10:19.134114 (Thread-102): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f446c70>]}
2021-01-08 14:10:19.138902 (Thread-102): sending response (<Response 14142 bytes [200 OK]>) to 10.0.40.118
2021-01-08 14:10:19.133261 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:10:19.136371 (Thread-1): Using redshift connection "model.my_new_project.top_customers_rs".
2021-01-08 14:10:19.136497 (Thread-1): On model.my_new_project.top_customers_rs: /* {"app": "dbt", "dbt_version": "0.18.1", "profile_name": "user", "target_name": "default", "node_id": "model.my_new_project.top_customers_rs"} */
drop table if exists "dev"."development"."top_customers_rs__dbt_backup" cascade
2021-01-08 14:10:19.204829 (Thread-1): SQL status: DROP TABLE in 0.07 seconds
2021-01-08 14:10:19.206034 (Thread-1): On model.my_new_project.top_customers_rs: COMMIT
2021-01-08 14:10:19.206154 (Thread-1): Using redshift connection "model.my_new_project.top_customers_rs".
2021-01-08 14:10:19.206255 (Thread-1): On model.my_new_project.top_customers_rs: COMMIT
2021-01-08 14:10:19.276401 (Thread-1): SQL status: COMMIT in 0.07 seconds
2021-01-08 14:10:19.276626 (Thread-1): Using redshift connection "model.my_new_project.top_customers_rs".
2021-01-08 14:10:19.276701 (Thread-1): On model.my_new_project.top_customers_rs: BEGIN
2021-01-08 14:10:19.345031 (Thread-1): SQL status: BEGIN in 0.07 seconds
2021-01-08 14:10:19.346785 (Thread-1): finished collecting timing info
2021-01-08 14:10:19.347009 (Thread-1): On model.my_new_project.top_customers_rs: ROLLBACK
2021-01-08 14:10:19.415129 (Thread-1): On model.my_new_project.top_customers_rs: Close
2021-01-08 14:10:19.415988 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '21041e39-c71c-40f1-8a03-3dfd99b9104a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd33d93a760>]}
2021-01-08 14:10:19.417056 (Thread-1): 14:10:19 | 14 of 14 OK created table model development.top_customers_rs......... [SELECT in 2.42s]
2021-01-08 14:10:19.417143 (Thread-1): Finished running node model.my_new_project.top_customers_rs
2021-01-08 14:10:19.418586 (MainThread): Acquiring new redshift connection "master".
2021-01-08 14:10:19.418709 (MainThread): Using redshift connection "master".
2021-01-08 14:10:19.418757 (MainThread): On master: BEGIN
2021-01-08 14:10:19.418813 (MainThread): Opening a new connection, currently in state closed
2021-01-08 14:10:19.418855 (MainThread): Connecting to Redshift using 'database' credentials
2021-01-08 14:10:20.036199 (MainThread): SQL status: BEGIN in 0.62 seconds
2021-01-08 14:10:20.036361 (MainThread): On master: COMMIT
2021-01-08 14:10:20.036409 (MainThread): Using redshift connection "master".
2021-01-08 14:10:20.036454 (MainThread): On master: COMMIT
2021-01-08 14:10:20.104991 (MainThread): SQL status: COMMIT in 0.07 seconds
2021-01-08 14:10:20.105214 (MainThread): On master: Close
2021-01-08 14:10:20.105988 (MainThread): 14:10:20 | 
2021-01-08 14:10:20.106125 (MainThread): 14:10:20 | Finished running 4 table models, 10 view models in 54.68s.
2021-01-08 14:10:20.106232 (MainThread): Connection 'master' was properly closed.
2021-01-08 14:10:20.106296 (MainThread): Connection 'model.my_new_project.top_customers_rs' was properly closed.
2021-01-08 14:10:20.171897 (MainThread): 
2021-01-08 14:10:20.172034 (MainThread): Completed with 9 errors and 0 warnings:
2021-01-08 14:10:20.172089 (MainThread): 
2021-01-08 14:10:20.172140 (MainThread): Database Error in model wns_nm_DD_TT_UCID_REFTABLE (models/example/wns_nm_DD_TT_UCID_REFTABLE.sql)
2021-01-08 14:10:20.172182 (MainThread):   syntax error at or near "CREATE"
2021-01-08 14:10:20.172218 (MainThread):   LINE 5:     CREATE TABLE wns_nm_DD_TT_UCID_REFTABLE AS (
2021-01-08 14:10:20.172254 (MainThread):               ^
2021-01-08 14:10:20.172289 (MainThread):   compiled SQL at target/run/my_new_project/models/example/wns_nm_DD_TT_UCID_REFTABLE.sql
2021-01-08 14:10:20.172327 (MainThread): 
2021-01-08 14:10:20.172371 (MainThread): Database Error in model WNS_NM_SD_DIM_CUSTOMER_DEMO (models/example/WNS_NM_SD_DIM_CUSTOMER_DEMO.sql)
2021-01-08 14:10:20.172409 (MainThread):   syntax error at or near "DROP"
2021-01-08 14:10:20.172444 (MainThread):   LINE 5:     DROP TABLE IF EXISTS DEVELOPMENT.WNS_NM_SD_DIM_CUSTOMER_...
2021-01-08 14:10:20.172478 (MainThread):               ^
2021-01-08 14:10:20.172511 (MainThread):   compiled SQL at target/run/my_new_project/models/example/WNS_NM_SD_DIM_CUSTOMER_DEMO.sql
2021-01-08 14:10:20.172548 (MainThread): 
2021-01-08 14:10:20.172590 (MainThread): Database Error in model bar_table_test_cbt (models/example/bar_table_test_cbt.sql)
2021-01-08 14:10:20.172628 (MainThread):   syntax error at or near "WbVarDef"
2021-01-08 14:10:20.172662 (MainThread):   LINE 25: WbVarDef vlast_updated_date  = '2020-01-01' ;   --{0}
2021-01-08 14:10:20.172697 (MainThread):            ^
2021-01-08 14:10:20.172769 (MainThread):   compiled SQL at target/run/my_new_project/models/example/bar_table_test_cbt.sql
2021-01-08 14:10:20.172809 (MainThread): 
2021-01-08 14:10:20.172887 (MainThread): Database Error in model wns_nm_DD_DEMOGOG_STAGING (models/example/wns_nm_DD_DEMOGOG_STAGING.sql)
2021-01-08 14:10:20.172953 (MainThread):   syntax error at or near "CREATE"
2021-01-08 14:10:20.172989 (MainThread):   LINE 5:     CREATE TABLE wns_nm_DD_DEMOGOG_STAGING AS (
2021-01-08 14:10:20.173024 (MainThread):               ^
2021-01-08 14:10:20.173058 (MainThread):   compiled SQL at target/run/my_new_project/models/example/wns_nm_DD_DEMOGOG_STAGING.sql
2021-01-08 14:10:20.173096 (MainThread): 
2021-01-08 14:10:20.173140 (MainThread): Database Error in model wns_nm_DD_UCID_HHI_DEMO_TEMP1 (models/example/wns_nm_DD_UCID_HHI_DEMO_TEMP1.sql)
2021-01-08 14:10:20.173178 (MainThread):   syntax error at or near "CREATE"
2021-01-08 14:10:20.173213 (MainThread):   LINE 5:     CREATE TABLE wns_nm_DD_UCID_HHI_DEMO_TEMP1 AS (
2021-01-08 14:10:20.173247 (MainThread):               ^
2021-01-08 14:10:20.173281 (MainThread):   compiled SQL at target/run/my_new_project/models/example/wns_nm_DD_UCID_HHI_DEMO_TEMP1.sql
2021-01-08 14:10:20.173318 (MainThread): 
2021-01-08 14:10:20.173361 (MainThread): Database Error in model wns_nm_DD_UCID_HHI_DEMO_TEMP1_2 (models/example/wns_nm_DD_UCID_HHI_DEMO_TEMP1_2.sql)
2021-01-08 14:10:20.173398 (MainThread):   syntax error at or near "CREATE"
2021-01-08 14:10:20.173433 (MainThread):   LINE 5:     CREATE TABLE wns_nm_DD_UCID_HHI_DEMO_TEMP1_2 AS (
2021-01-08 14:10:20.173467 (MainThread):               ^
2021-01-08 14:10:20.173501 (MainThread):   compiled SQL at target/run/my_new_project/models/example/wns_nm_DD_UCID_HHI_DEMO_TEMP1_2.sql
2021-01-08 14:10:20.173537 (MainThread): 
2021-01-08 14:10:20.173578 (MainThread): Database Error in model wns_nm_DD_UCID_HHI_DEMO_TEMP2 (models/example/wns_nm_DD_UCID_HHI_DEMO_TEMP2.sql)
2021-01-08 14:10:20.173616 (MainThread):   syntax error at or near "CREATE"
2021-01-08 14:10:20.173651 (MainThread):   LINE 5:     CREATE TABLE  wns_nm_DD_UCID_HHI_DEMO_TEMP2 AS
2021-01-08 14:10:20.173684 (MainThread):               ^
2021-01-08 14:10:20.173717 (MainThread):   compiled SQL at target/run/my_new_project/models/example/wns_nm_DD_UCID_HHI_DEMO_TEMP2.sql
2021-01-08 14:10:20.173753 (MainThread): 
2021-01-08 14:10:20.173794 (MainThread): Database Error in model wns_nm_DD_UCID_HHI_DEMO_TEMP3 (models/wns_nm_DD_UCID_HHI_DEMO_TEMP3.sql)
2021-01-08 14:10:20.173831 (MainThread):   syntax error at or near "CREATE"
2021-01-08 14:10:20.173865 (MainThread):   LINE 5:     CREATE TABLE  wns_nm_DD_UCID_HHI_DEMO_TEMP3 AS
2021-01-08 14:10:20.173898 (MainThread):               ^
2021-01-08 14:10:20.173931 (MainThread):   compiled SQL at target/run/my_new_project/models/wns_nm_DD_UCID_HHI_DEMO_TEMP3.sql
2021-01-08 14:10:20.173967 (MainThread): 
2021-01-08 14:10:20.174007 (MainThread): Database Error in model wns_nm_DD_UCID_HHI_INFO (models/example/wns_nm_DD_UCID_HHI_INFO.sql)
2021-01-08 14:10:20.174043 (MainThread):   syntax error at or near "CREATE"
2021-01-08 14:10:20.174077 (MainThread):   LINE 5:     CREATE TABLE wns_nm_DD_UCID_HHI_INFO AS (
2021-01-08 14:10:20.174110 (MainThread):               ^
2021-01-08 14:10:20.174143 (MainThread):   compiled SQL at target/run/my_new_project/models/example/wns_nm_DD_UCID_HHI_INFO.sql
2021-01-08 14:10:20.174211 (MainThread): 
Done. PASS=4 WARN=0 ERROR=9 SKIP=1 TOTAL=14
2021-01-08 14:10:20.679064 (Thread-103): handling poll request
2021-01-08 14:10:20.679810 (Thread-103): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f19e0d0>]}
2021-01-08 14:10:20.743893 (Thread-103): sending response (<Response 475836 bytes [200 OK]>) to 10.0.31.102
2021-01-08 14:10:22.318472 (Thread-104): handling status request
2021-01-08 14:10:22.318886 (Thread-104): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f440130>]}
2021-01-08 14:10:22.319779 (Thread-104): sending response (<Response 753 bytes [200 OK]>) to 10.0.14.17
2021-01-08 14:18:20.742396 (Thread-105): Got an acceptable cached parse result
2021-01-08 14:18:20.807031 (Thread-105): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_INFO".
2021-01-08 14:18:21.655060 (Thread-106): handling status request
2021-01-08 14:18:21.655490 (Thread-106): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e4414c0>]}
2021-01-08 14:18:21.656383 (Thread-106): sending response (<Response 763 bytes [200 OK]>) to 10.0.15.240
2021-01-08 15:06:54.190432 (MainThread): Connection 'model.my_new_project.wns_nm_DD_UCID_HHI_INFO' was properly closed.
2021-01-08 15:06:54.257969 (Thread-107): Got an acceptable cached parse result
2021-01-08 15:06:55.144348 (Thread-108): handling status request
2021-01-08 15:06:55.144785 (Thread-108): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e3c1b80>]}
2021-01-08 15:06:55.145596 (Thread-108): sending response (<Response 448 bytes [200 OK]>) to 10.0.29.161
2021-01-08 15:07:47.462273 (Thread-109): Got an acceptable cached parse result
2021-01-08 15:07:47.544379 (Thread-109): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1".
2021-01-08 15:07:47.872395 (Thread-110): handling status request
2021-01-08 15:07:47.872883 (Thread-110): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f1b3730>]}
2021-01-08 15:07:47.873787 (Thread-110): sending response (<Response 769 bytes [200 OK]>) to 10.0.14.37
2021-01-08 15:08:53.414065 (MainThread): Connection 'model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1' was properly closed.
2021-01-08 15:08:53.503560 (Thread-111): Got an acceptable cached parse result
2021-01-08 15:08:59.922527 (Thread-112): handling status request
2021-01-08 15:08:59.922966 (Thread-112): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e1a7070>]}
2021-01-08 15:08:59.923785 (Thread-112): sending response (<Response 448 bytes [200 OK]>) to 10.0.44.142
2021-01-08 15:09:44.420624 (Thread-113): Got an acceptable cached parse result
2021-01-08 15:09:44.476796 (Thread-113): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2".
2021-01-08 15:09:45.103551 (Thread-114): handling status request
2021-01-08 15:09:45.103989 (Thread-114): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f2bb040>]}
2021-01-08 15:09:45.125421 (Thread-114): sending response (<Response 771 bytes [200 OK]>) to 10.0.16.243
2021-01-08 15:11:11.444517 (MainThread): Connection 'model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2' was properly closed.
2021-01-08 15:11:11.508328 (Thread-115): Got an acceptable cached parse result
2021-01-08 15:11:11.567734 (Thread-115): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2".
2021-01-08 15:11:12.595999 (Thread-116): handling status request
2021-01-08 15:11:12.596443 (Thread-116): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f297dc0>]}
2021-01-08 15:11:12.597394 (Thread-116): sending response (<Response 769 bytes [200 OK]>) to 10.0.8.15
2021-01-08 15:11:56.851248 (MainThread): Connection 'model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2' was properly closed.
2021-01-08 15:11:56.913378 (Thread-117): Got an acceptable cached parse result
2021-01-08 15:11:56.950818 (Thread-117): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3".
2021-01-08 15:11:57.307290 (Thread-118): handling status request
2021-01-08 15:11:57.307762 (Thread-118): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f1b21c0>]}
2021-01-08 15:11:57.308719 (Thread-118): sending response (<Response 769 bytes [200 OK]>) to 10.0.8.15
2021-01-08 15:14:04.608305 (MainThread): Connection 'model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3' was properly closed.
2021-01-08 15:14:04.670919 (Thread-119): Got an acceptable cached parse result
2021-01-08 15:14:04.714241 (Thread-119): Acquiring new redshift connection "model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO".
2021-01-08 15:14:05.644349 (Thread-120): handling status request
2021-01-08 15:14:05.644805 (Thread-120): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f3e1fa0>]}
2021-01-08 15:14:05.645677 (Thread-120): sending response (<Response 767 bytes [200 OK]>) to 10.0.45.44
2021-01-08 15:19:24.113598 (MainThread): Connection 'model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO' was properly closed.
2021-01-08 15:19:24.177221 (Thread-121): Got an acceptable cached parse result
2021-01-08 15:19:24.216051 (Thread-121): Acquiring new redshift connection "model.my_new_project.foobar-script-a".
2021-01-08 15:19:25.316854 (Thread-122): handling status request
2021-01-08 15:19:25.317334 (Thread-122): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e6122e0>]}
2021-01-08 15:19:25.318260 (Thread-122): sending response (<Response 755 bytes [200 OK]>) to 10.0.2.182
2021-01-08 15:20:09.004840 (MainThread): Connection 'model.my_new_project.foobar-script-a' was properly closed.
2021-01-08 15:20:09.065420 (Thread-123): Got an acceptable cached parse result
2021-01-08 15:20:09.517614 (Thread-124): handling status request
2021-01-08 15:20:09.518096 (Thread-124): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e563130>]}
2021-01-08 15:20:09.519022 (Thread-124): sending response (<Response 448 bytes [200 OK]>) to 10.0.14.37
2021-01-08 15:20:26.297338 (Thread-125): Got an acceptable cached parse result
2021-01-08 15:20:26.568699 (Thread-126): handling status request
2021-01-08 15:20:26.569091 (Thread-126): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e2671f0>]}
2021-01-08 15:20:26.569856 (Thread-126): sending response (<Response 448 bytes [200 OK]>) to 10.0.2.182
2021-01-08 15:21:50.583079 (Thread-127): Got an acceptable cached parse result
2021-01-08 15:21:51.486320 (Thread-128): handling status request
2021-01-08 15:21:51.486738 (Thread-128): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e69de20>]}
2021-01-08 15:21:51.487537 (Thread-128): sending response (<Response 448 bytes [200 OK]>) to 10.0.2.182
2021-01-08 15:22:52.077642 (Thread-129): handling status request
2021-01-08 15:22:52.079579 (Thread-129): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e69dc10>]}
2021-01-08 15:22:52.080381 (Thread-129): sending response (<Response 448 bytes [200 OK]>) to 10.0.45.44
2021-01-08 15:22:52.498375 (Thread-130): handling compile_sql request
2021-01-08 15:22:52.498786 (Thread-130): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e37b8b0>]}
2021-01-08 15:22:53.315545 (Thread-130): sending response (<Response 138 bytes [200 OK]>) to 10.0.8.15
2021-01-08 15:22:53.332849 (MainThread): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-08 15:22:53.355126 (MainThread): Found 13 models, 0 tests, 0 snapshots, 0 analyses, 163 macros, 0 operations, 0 seed files, 0 sources
2021-01-08 15:22:53.355581 (Thread-1): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-08 15:22:53.355685 (Thread-1): Compiling rpc.my_new_project.request
2021-01-08 15:22:53.397305 (Thread-1): finished collecting timing info
2021-01-08 15:22:53.397521 (Thread-1): finished collecting timing info
2021-01-08 15:22:53.722867 (Thread-131): handling poll request
2021-01-08 15:22:53.723310 (Thread-131): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e69d2e0>]}
2021-01-08 15:22:53.727786 (Thread-131): sending response (<Response 4871 bytes [200 OK]>) to 10.0.18.208
2021-01-08 15:22:58.657921 (Thread-132): handling status request
2021-01-08 15:22:58.658389 (Thread-132): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f4404c0>]}
2021-01-08 15:22:58.659227 (Thread-132): sending response (<Response 448 bytes [200 OK]>) to 10.0.14.37
2021-01-08 15:22:59.038764 (Thread-133): handling compile_sql request
2021-01-08 15:22:59.039185 (Thread-133): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f168d90>]}
2021-01-08 15:22:59.880930 (Thread-133): sending response (<Response 138 bytes [200 OK]>) to 10.0.23.166
2021-01-08 15:22:59.897397 (MainThread): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-08 15:22:59.941999 (MainThread): Found 13 models, 0 tests, 0 snapshots, 0 analyses, 163 macros, 0 operations, 0 seed files, 0 sources
2021-01-08 15:22:59.942481 (Thread-1): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-08 15:22:59.942576 (Thread-1): Compiling rpc.my_new_project.request
2021-01-08 15:22:59.956700 (Thread-1): finished collecting timing info
2021-01-08 15:22:59.956902 (Thread-1): finished collecting timing info
2021-01-08 15:23:00.293519 (Thread-134): handling poll request
2021-01-08 15:23:00.293961 (Thread-134): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f168160>]}
2021-01-08 15:23:00.298769 (Thread-134): sending response (<Response 7056 bytes [200 OK]>) to 10.0.8.15
2021-01-08 15:23:19.224168 (Thread-135): handling status request
2021-01-08 15:23:19.224574 (Thread-135): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f168a30>]}
2021-01-08 15:23:19.225439 (Thread-135): sending response (<Response 448 bytes [200 OK]>) to 10.0.16.243
2021-01-08 15:23:19.618139 (Thread-136): handling compile_sql request
2021-01-08 15:23:19.618609 (Thread-136): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f21a700>]}
2021-01-08 15:23:20.461062 (Thread-136): sending response (<Response 138 bytes [200 OK]>) to 10.0.16.243
2021-01-08 15:23:20.478303 (MainThread): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-08 15:23:20.497702 (MainThread): Found 13 models, 0 tests, 0 snapshots, 0 analyses, 163 macros, 0 operations, 0 seed files, 0 sources
2021-01-08 15:23:20.498144 (Thread-1): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-08 15:23:20.498270 (Thread-1): Compiling rpc.my_new_project.request
2021-01-08 15:23:20.542483 (Thread-1): finished collecting timing info
2021-01-08 15:23:20.542744 (Thread-1): finished collecting timing info
2021-01-08 15:23:20.867497 (Thread-137): handling poll request
2021-01-08 15:23:20.867929 (Thread-137): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f168580>]}
2021-01-08 15:23:20.872236 (Thread-137): sending response (<Response 7121 bytes [200 OK]>) to 10.0.2.182
2021-01-08 15:23:32.670369 (Thread-138): handling status request
2021-01-08 15:23:32.670883 (Thread-138): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e5c0820>]}
2021-01-08 15:23:32.671698 (Thread-138): sending response (<Response 448 bytes [200 OK]>) to 10.0.29.161
2021-01-08 15:23:33.065140 (Thread-139): handling compile_sql request
2021-01-08 15:23:33.065584 (Thread-139): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f2f7ca0>]}
2021-01-08 15:23:33.884318 (Thread-139): sending response (<Response 138 bytes [200 OK]>) to 10.0.18.208
2021-01-08 15:23:33.900987 (MainThread): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-08 15:23:33.918728 (MainThread): Found 13 models, 0 tests, 0 snapshots, 0 analyses, 163 macros, 0 operations, 0 seed files, 0 sources
2021-01-08 15:23:33.919187 (Thread-1): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-08 15:23:33.919287 (Thread-1): Compiling rpc.my_new_project.request
2021-01-08 15:23:33.962879 (Thread-1): finished collecting timing info
2021-01-08 15:23:33.963107 (Thread-1): finished collecting timing info
2021-01-08 15:23:34.330645 (Thread-140): handling poll request
2021-01-08 15:23:34.331112 (Thread-140): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f2f7220>]}
2021-01-08 15:23:34.335804 (Thread-140): sending response (<Response 10130 bytes [200 OK]>) to 10.0.36.51
2021-01-08 15:23:43.235332 (Thread-141): handling status request
2021-01-08 15:23:43.235746 (Thread-141): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f223460>]}
2021-01-08 15:23:43.236582 (Thread-141): sending response (<Response 448 bytes [200 OK]>) to 10.0.36.51
2021-01-08 15:23:43.644520 (Thread-142): handling compile_sql request
2021-01-08 15:23:43.644931 (Thread-142): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e27a7c0>]}
2021-01-08 15:23:44.464707 (Thread-142): sending response (<Response 138 bytes [200 OK]>) to 10.0.19.92
2021-01-08 15:23:44.481271 (MainThread): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-08 15:23:44.528215 (MainThread): Found 13 models, 0 tests, 0 snapshots, 0 analyses, 163 macros, 0 operations, 0 seed files, 0 sources
2021-01-08 15:23:44.528706 (Thread-1): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-08 15:23:44.528810 (Thread-1): Compiling rpc.my_new_project.request
2021-01-08 15:23:44.543277 (Thread-1): finished collecting timing info
2021-01-08 15:23:44.543488 (Thread-1): finished collecting timing info
2021-01-08 15:23:44.936568 (Thread-143): handling poll request
2021-01-08 15:23:44.937060 (Thread-143): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f223e50>]}
2021-01-08 15:23:44.941507 (Thread-143): sending response (<Response 7665 bytes [200 OK]>) to 10.0.44.27
2021-01-08 15:23:50.554055 (Thread-144): handling status request
2021-01-08 15:23:50.554500 (Thread-144): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e274f10>]}
2021-01-08 15:23:50.555335 (Thread-144): sending response (<Response 448 bytes [200 OK]>) to 10.0.13.33
2021-01-08 15:23:50.942355 (Thread-145): handling compile_sql request
2021-01-08 15:23:50.942776 (Thread-145): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e4eee80>]}
2021-01-08 15:23:51.749604 (Thread-145): sending response (<Response 138 bytes [200 OK]>) to 10.0.19.92
2021-01-08 15:23:51.766506 (MainThread): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-08 15:23:51.812873 (MainThread): Found 13 models, 0 tests, 0 snapshots, 0 analyses, 163 macros, 0 operations, 0 seed files, 0 sources
2021-01-08 15:23:51.813308 (Thread-1): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-08 15:23:51.813406 (Thread-1): Compiling rpc.my_new_project.request
2021-01-08 15:23:51.830419 (Thread-1): finished collecting timing info
2021-01-08 15:23:51.830629 (Thread-1): finished collecting timing info
2021-01-08 15:23:52.164353 (Thread-146): handling poll request
2021-01-08 15:23:52.164815 (Thread-146): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f223dc0>]}
2021-01-08 15:23:52.169557 (Thread-146): sending response (<Response 11395 bytes [200 OK]>) to 10.0.36.51
2021-01-08 15:23:56.523228 (Thread-147): handling status request
2021-01-08 15:23:56.523645 (Thread-147): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e5560d0>]}
2021-01-08 15:23:56.524488 (Thread-147): sending response (<Response 448 bytes [200 OK]>) to 10.0.8.15
2021-01-08 15:23:56.943228 (Thread-148): handling compile_sql request
2021-01-08 15:23:56.943636 (Thread-148): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e4116d0>]}
2021-01-08 15:23:57.811819 (Thread-148): sending response (<Response 138 bytes [200 OK]>) to 10.0.45.44
2021-01-08 15:23:57.828436 (MainThread): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-08 15:23:57.881264 (MainThread): Found 13 models, 0 tests, 0 snapshots, 0 analyses, 163 macros, 0 operations, 0 seed files, 0 sources
2021-01-08 15:23:57.881728 (Thread-1): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-08 15:23:57.881827 (Thread-1): Compiling rpc.my_new_project.request
2021-01-08 15:23:57.899048 (Thread-1): finished collecting timing info
2021-01-08 15:23:57.899262 (Thread-1): finished collecting timing info
2021-01-08 15:23:58.227465 (Thread-149): handling poll request
2021-01-08 15:23:58.227920 (Thread-149): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e556ca0>]}
2021-01-08 15:23:58.232267 (Thread-149): sending response (<Response 10710 bytes [200 OK]>) to 10.0.2.182
2021-01-08 15:24:03.470468 (Thread-150): handling status request
2021-01-08 15:24:03.470887 (Thread-150): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f2fa040>]}
2021-01-08 15:24:03.471717 (Thread-150): sending response (<Response 448 bytes [200 OK]>) to 10.0.12.132
2021-01-08 15:24:03.916491 (Thread-151): handling compile_sql request
2021-01-08 15:24:03.916924 (Thread-151): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f179340>]}
2021-01-08 15:24:04.773603 (Thread-151): sending response (<Response 138 bytes [200 OK]>) to 10.0.38.238
2021-01-08 15:24:04.790922 (MainThread): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-08 15:24:04.843123 (MainThread): Found 13 models, 0 tests, 0 snapshots, 0 analyses, 163 macros, 0 operations, 0 seed files, 0 sources
2021-01-08 15:24:04.843596 (Thread-1): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-08 15:24:04.843696 (Thread-1): Compiling rpc.my_new_project.request
2021-01-08 15:24:04.866124 (Thread-1): finished collecting timing info
2021-01-08 15:24:04.866361 (Thread-1): finished collecting timing info
2021-01-08 15:24:05.196945 (Thread-152): handling poll request
2021-01-08 15:24:05.197418 (Thread-152): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f2fa220>]}
2021-01-08 15:24:05.202272 (Thread-152): sending response (<Response 16728 bytes [200 OK]>) to 10.0.36.51
2021-01-08 15:24:35.717187 (Thread-153): Got an acceptable cached parse result
2021-01-08 15:24:39.191961 (Thread-154): handling status request
2021-01-08 15:24:39.192398 (Thread-154): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e0eda30>]}
2021-01-08 15:24:39.193263 (Thread-154): sending response (<Response 448 bytes [200 OK]>) to 10.0.45.44
2021-01-08 15:24:59.377722 (Thread-155): Got an acceptable cached parse result
2021-01-08 15:25:00.057021 (Thread-156): handling status request
2021-01-08 15:25:00.057578 (Thread-156): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f155bb0>]}
2021-01-08 15:25:00.058693 (Thread-156): sending response (<Response 448 bytes [200 OK]>) to 10.0.29.161
2021-01-08 15:26:11.433724 (Thread-157): Got an acceptable cached parse result
2021-01-08 15:26:11.515129 (Thread-157): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3".
2021-01-08 15:26:12.630469 (Thread-158): handling status request
2021-01-08 15:26:12.630893 (Thread-158): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e0f59d0>]}
2021-01-08 15:26:12.631879 (Thread-158): sending response (<Response 1284 bytes [200 OK]>) to 10.0.45.44
2021-01-08 15:26:32.553067 (MainThread): Connection 'model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3' was properly closed.
2021-01-08 15:26:32.613401 (Thread-159): Got an acceptable cached parse result
2021-01-08 15:26:32.785840 (Thread-159): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3".
2021-01-08 15:26:33.003653 (Thread-160): handling status request
2021-01-08 15:26:33.004058 (Thread-160): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f46f9a0>]}
2021-01-08 15:26:33.004950 (Thread-160): sending response (<Response 769 bytes [200 OK]>) to 10.0.19.92
2021-01-08 15:27:19.211824 (MainThread): Connection 'model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3' was properly closed.
2021-01-08 15:27:19.270963 (Thread-161): Got an acceptable cached parse result
2021-01-08 15:27:19.653957 (Thread-162): handling status request
2021-01-08 15:27:19.654429 (Thread-162): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e559c70>]}
2021-01-08 15:27:19.655271 (Thread-162): sending response (<Response 448 bytes [200 OK]>) to 10.0.44.142
2021-01-08 15:27:24.636592 (Thread-163): Got an acceptable cached parse result
2021-01-08 15:27:24.962196 (Thread-164): handling status request
2021-01-08 15:27:24.962580 (Thread-164): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d87e8db80>]}
2021-01-08 15:27:24.963366 (Thread-164): sending response (<Response 667 bytes [200 OK]>) to 10.0.19.92
2021-01-08 15:27:39.514849 (Thread-165): Got an acceptable cached parse result
2021-01-08 15:27:39.877278 (Thread-166): handling status request
2021-01-08 15:27:39.877697 (Thread-166): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e56f430>]}
2021-01-08 15:27:39.878763 (Thread-166): sending response (<Response 667 bytes [200 OK]>) to 10.0.23.166
2021-01-08 15:27:50.959789 (Thread-167): Got an acceptable cached parse result
2021-01-08 15:27:51.651459 (Thread-168): handling status request
2021-01-08 15:27:51.651899 (Thread-168): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d87e799a0>]}
2021-01-08 15:27:51.652757 (Thread-168): sending response (<Response 448 bytes [200 OK]>) to 10.0.13.33
2021-01-08 15:28:44.921448 (Thread-169): handling status request
2021-01-08 15:28:44.921889 (Thread-169): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d87e79ac0>]}
2021-01-08 15:28:44.922914 (Thread-169): sending response (<Response 448 bytes [200 OK]>) to 10.0.29.161
2021-01-08 15:28:52.405435 (Thread-170): Parsing macros/relations.sql
2021-01-08 15:28:52.406259 (Thread-170): Parsing macros/adapters.sql
2021-01-08 15:28:52.431776 (Thread-170): Parsing macros/catalog.sql
2021-01-08 15:28:52.444225 (Thread-170): Parsing macros/materializations/snapshot_merge.sql
2021-01-08 15:28:52.445151 (Thread-170): Parsing macros/relations.sql
2021-01-08 15:28:52.446538 (Thread-170): Parsing macros/adapters.sql
2021-01-08 15:28:52.466945 (Thread-170): Parsing macros/catalog.sql
2021-01-08 15:28:52.469188 (Thread-170): Parsing macros/materializations/snapshot_merge.sql
2021-01-08 15:28:52.471758 (Thread-170): Parsing macros/core.sql
2021-01-08 15:28:52.475260 (Thread-170): Parsing macros/adapters/common.sql
2021-01-08 15:28:52.517529 (Thread-170): Parsing macros/materializations/helpers.sql
2021-01-08 15:28:52.526847 (Thread-170): Parsing macros/materializations/table/table.sql
2021-01-08 15:28:52.533235 (Thread-170): Parsing macros/materializations/seed/seed.sql
2021-01-08 15:28:52.553057 (Thread-170): Parsing macros/materializations/view/view.sql
2021-01-08 15:28:52.559005 (Thread-170): Parsing macros/materializations/view/create_or_replace_view.sql
2021-01-08 15:28:52.563750 (Thread-170): Parsing macros/materializations/incremental/helpers.sql
2021-01-08 15:28:52.565520 (Thread-170): Parsing macros/materializations/incremental/incremental.sql
2021-01-08 15:28:52.571227 (Thread-170): Parsing macros/materializations/common/merge.sql
2021-01-08 15:28:52.584936 (Thread-170): Parsing macros/materializations/snapshot/strategies.sql
2021-01-08 15:28:52.600582 (Thread-170): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-01-08 15:28:52.602288 (Thread-170): Parsing macros/materializations/snapshot/snapshot.sql
2021-01-08 15:28:52.630279 (Thread-170): Parsing macros/schema_tests/relationships.sql
2021-01-08 15:28:52.632090 (Thread-170): Parsing macros/schema_tests/not_null.sql
2021-01-08 15:28:52.633541 (Thread-170): Parsing macros/schema_tests/unique.sql
2021-01-08 15:28:52.635245 (Thread-170): Parsing macros/schema_tests/accepted_values.sql
2021-01-08 15:28:52.637851 (Thread-170): Parsing macros/etc/get_custom_database.sql
2021-01-08 15:28:52.639469 (Thread-170): Parsing macros/etc/query.sql
2021-01-08 15:28:52.640508 (Thread-170): Parsing macros/etc/datetime.sql
2021-01-08 15:28:52.648963 (Thread-170): Parsing macros/etc/get_custom_alias.sql
2021-01-08 15:28:52.649886 (Thread-170): Parsing macros/etc/is_incremental.sql
2021-01-08 15:28:52.651451 (Thread-170): Parsing macros/etc/get_custom_schema.sql
2021-01-08 15:28:52.692837 (Thread-170): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_DEMOGOG_STAGING".
2021-01-08 15:28:52.705232 (Thread-170): Acquiring new redshift connection "model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO".
2021-01-08 15:28:52.722532 (Thread-170): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE".
2021-01-08 15:28:52.734939 (Thread-170): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2".
2021-01-08 15:28:52.750277 (Thread-170): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2".
2021-01-08 15:28:52.769516 (Thread-170): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_INFO".
2021-01-08 15:28:52.783753 (Thread-170): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1".
2021-01-08 15:28:52.797960 (Thread-170): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3".
2021-01-08 15:28:53.090083 (Thread-171): handling status request
2021-01-08 15:28:53.090523 (Thread-171): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f396310>]}
2021-01-08 15:28:53.093844 (Thread-171): sending response (<Response 11204 bytes [200 OK]>) to 10.0.16.243
2021-01-08 15:39:51.454831 (Thread-172): handling status request
2021-01-08 15:39:51.455257 (Thread-172): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e24e100>]}
2021-01-08 15:39:51.458633 (Thread-172): sending response (<Response 11204 bytes [200 OK]>) to 10.0.12.132
2021-01-08 15:39:51.879670 (Thread-173): handling ps request
2021-01-08 15:39:51.880118 (Thread-173): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f399340>]}
2021-01-08 15:39:51.884210 (Thread-173): sending response (<Response 7468 bytes [200 OK]>) to 10.0.12.132
2021-01-08 15:39:52.297459 (Thread-174): handling poll request
2021-01-08 15:39:52.297886 (Thread-174): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f41b430>]}
2021-01-08 15:39:52.390280 (Thread-174): sending response (<Response 944575 bytes [200 OK]>) to 10.0.16.243
2021-01-08 15:39:53.716674 (Thread-175): handling status request
2021-01-08 15:39:53.717093 (Thread-175): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e6b0f40>]}
2021-01-08 15:39:53.720506 (Thread-175): sending response (<Response 11204 bytes [200 OK]>) to 10.0.29.161
2021-01-08 15:40:23.076724 (MainThread): Connection 'model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3' was properly closed.
2021-01-08 15:40:23.137596 (Thread-176): Got an acceptable cached parse result
2021-01-08 15:40:23.171599 (Thread-176): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_DEMOGOG_STAGING".
2021-01-08 15:40:23.590551 (Thread-177): handling status request
2021-01-08 15:40:23.591005 (Thread-177): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f252d30>]}
2021-01-08 15:40:23.591900 (Thread-177): sending response (<Response 765 bytes [200 OK]>) to 10.0.8.15
2021-01-08 15:40:28.212831 (MainThread): Connection 'model.my_new_project.wns_nm_DD_DEMOGOG_STAGING' was properly closed.
2021-01-08 15:40:28.275852 (Thread-178): Got an acceptable cached parse result
2021-01-08 15:40:28.703708 (Thread-179): handling status request
2021-01-08 15:40:28.704150 (Thread-179): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e126fd0>]}
2021-01-08 15:40:28.704992 (Thread-179): sending response (<Response 448 bytes [200 OK]>) to 10.0.45.44
2021-01-08 15:40:44.398127 (Thread-180): Got an acceptable cached parse result
2021-01-08 15:40:44.439593 (Thread-180): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE".
2021-01-08 15:40:44.783454 (Thread-181): handling status request
2021-01-08 15:40:44.783904 (Thread-181): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f2253a0>]}
2021-01-08 15:40:44.784858 (Thread-181): sending response (<Response 766 bytes [200 OK]>) to 10.0.14.37
2021-01-08 15:40:49.778984 (Thread-182): handling status request
2021-01-08 15:40:49.779405 (Thread-182): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f19eac0>]}
2021-01-08 15:40:49.780337 (Thread-182): sending response (<Response 766 bytes [200 OK]>) to 10.0.44.142
2021-01-08 15:40:50.166747 (Thread-183): handling compile_sql request
2021-01-08 15:40:50.167179 (Thread-183): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f19e880>]}
2021-01-08 15:40:50.168405 (Thread-183): Connection 'model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE' was properly closed.
2021-01-08 15:40:51.009561 (Thread-183): sending response (<Response 138 bytes [200 OK]>) to 10.0.23.166
2021-01-08 15:40:51.026571 (MainThread): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-08 15:40:51.044150 (MainThread): Found 8 models, 0 tests, 0 snapshots, 0 analyses, 163 macros, 0 operations, 0 seed files, 0 sources
2021-01-08 15:40:51.044581 (Thread-1): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-08 15:40:51.044687 (Thread-1): Compiling rpc.my_new_project.request
2021-01-08 15:40:51.089282 (Thread-1): finished collecting timing info
2021-01-08 15:40:51.089520 (Thread-1): finished collecting timing info
2021-01-08 15:40:51.487486 (Thread-184): handling poll request
2021-01-08 15:40:51.487938 (Thread-184): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f19e0a0>]}
2021-01-08 15:40:51.492331 (Thread-184): sending response (<Response 4621 bytes [200 OK]>) to 10.0.45.44
2021-01-08 15:41:17.158499 (Thread-185): Got an acceptable cached parse result
2021-01-08 15:41:17.338152 (Thread-185): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1".
2021-01-08 15:41:17.526775 (Thread-186): handling status request
2021-01-08 15:41:17.527177 (Thread-186): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f291eb0>]}
2021-01-08 15:41:17.528008 (Thread-186): sending response (<Response 769 bytes [200 OK]>) to 10.0.29.161
2021-01-08 15:41:30.284900 (MainThread): Connection 'model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1' was properly closed.
2021-01-08 15:41:30.345967 (Thread-187): Got an acceptable cached parse result
2021-01-08 15:41:30.390979 (Thread-187): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2".
2021-01-08 15:41:30.737056 (Thread-188): handling status request
2021-01-08 15:41:30.737565 (Thread-188): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e367e50>]}
2021-01-08 15:41:30.738758 (Thread-188): sending response (<Response 771 bytes [200 OK]>) to 10.0.44.27
2021-01-08 15:41:49.485788 (MainThread): Connection 'model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2' was properly closed.
2021-01-08 15:41:49.552341 (Thread-189): Got an acceptable cached parse result
2021-01-08 15:41:49.611818 (Thread-189): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2".
2021-01-08 15:41:50.054751 (Thread-190): handling status request
2021-01-08 15:41:50.055205 (Thread-190): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e507670>]}
2021-01-08 15:41:50.056143 (Thread-190): sending response (<Response 769 bytes [200 OK]>) to 10.0.38.238
2021-01-08 15:42:22.976794 (MainThread): Connection 'model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2' was properly closed.
2021-01-08 15:42:23.037694 (Thread-191): Got an acceptable cached parse result
2021-01-08 15:42:23.089889 (Thread-191): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_INFO".
2021-01-08 15:42:23.487651 (Thread-192): handling status request
2021-01-08 15:42:23.488091 (Thread-192): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e38dca0>]}
2021-01-08 15:42:23.489011 (Thread-192): sending response (<Response 763 bytes [200 OK]>) to 10.0.38.238
2021-01-08 15:42:57.636932 (MainThread): Connection 'model.my_new_project.wns_nm_DD_UCID_HHI_INFO' was properly closed.
2021-01-08 15:42:57.700982 (Thread-193): Got an acceptable cached parse result
2021-01-08 15:42:57.739393 (Thread-193): Acquiring new redshift connection "model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO".
2021-01-08 15:42:58.097397 (Thread-194): handling status request
2021-01-08 15:42:58.097825 (Thread-194): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f2484c0>]}
2021-01-08 15:42:58.098789 (Thread-194): sending response (<Response 767 bytes [200 OK]>) to 10.0.38.238
2021-01-08 15:43:02.697556 (MainThread): Connection 'model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO' was properly closed.
2021-01-08 15:43:02.758595 (Thread-195): Got an acceptable cached parse result
2021-01-08 15:43:03.148407 (Thread-196): handling status request
2021-01-08 15:43:03.148827 (Thread-196): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f32d460>]}
2021-01-08 15:43:03.149649 (Thread-196): sending response (<Response 448 bytes [200 OK]>) to 10.0.2.182
2021-01-08 15:43:29.923548 (Thread-197): handling status request
2021-01-08 15:43:29.923989 (Thread-197): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e639910>]}
2021-01-08 15:43:29.924849 (Thread-197): sending response (<Response 448 bytes [200 OK]>) to 10.0.14.37
2021-01-08 15:43:36.296825 (Thread-198): Parsing macros/relations.sql
2021-01-08 15:43:36.297645 (Thread-198): Parsing macros/adapters.sql
2021-01-08 15:43:36.326195 (Thread-198): Parsing macros/catalog.sql
2021-01-08 15:43:36.338719 (Thread-198): Parsing macros/materializations/snapshot_merge.sql
2021-01-08 15:43:36.339704 (Thread-198): Parsing macros/relations.sql
2021-01-08 15:43:36.341097 (Thread-198): Parsing macros/adapters.sql
2021-01-08 15:43:36.361184 (Thread-198): Parsing macros/catalog.sql
2021-01-08 15:43:36.363483 (Thread-198): Parsing macros/materializations/snapshot_merge.sql
2021-01-08 15:43:36.366105 (Thread-198): Parsing macros/core.sql
2021-01-08 15:43:36.369675 (Thread-198): Parsing macros/adapters/common.sql
2021-01-08 15:43:36.412734 (Thread-198): Parsing macros/materializations/helpers.sql
2021-01-08 15:43:36.421374 (Thread-198): Parsing macros/materializations/table/table.sql
2021-01-08 15:43:36.428050 (Thread-198): Parsing macros/materializations/seed/seed.sql
2021-01-08 15:43:36.448008 (Thread-198): Parsing macros/materializations/view/view.sql
2021-01-08 15:43:36.454036 (Thread-198): Parsing macros/materializations/view/create_or_replace_view.sql
2021-01-08 15:43:36.458842 (Thread-198): Parsing macros/materializations/incremental/helpers.sql
2021-01-08 15:43:36.460610 (Thread-198): Parsing macros/materializations/incremental/incremental.sql
2021-01-08 15:43:36.466605 (Thread-198): Parsing macros/materializations/common/merge.sql
2021-01-08 15:43:36.479995 (Thread-198): Parsing macros/materializations/snapshot/strategies.sql
2021-01-08 15:43:36.495898 (Thread-198): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-01-08 15:43:36.497628 (Thread-198): Parsing macros/materializations/snapshot/snapshot.sql
2021-01-08 15:43:36.525854 (Thread-198): Parsing macros/schema_tests/relationships.sql
2021-01-08 15:43:36.527785 (Thread-198): Parsing macros/schema_tests/not_null.sql
2021-01-08 15:43:36.529275 (Thread-198): Parsing macros/schema_tests/unique.sql
2021-01-08 15:43:36.530985 (Thread-198): Parsing macros/schema_tests/accepted_values.sql
2021-01-08 15:43:36.533605 (Thread-198): Parsing macros/etc/get_custom_database.sql
2021-01-08 15:43:36.535296 (Thread-198): Parsing macros/etc/query.sql
2021-01-08 15:43:36.536332 (Thread-198): Parsing macros/etc/datetime.sql
2021-01-08 15:43:36.544856 (Thread-198): Parsing macros/etc/get_custom_alias.sql
2021-01-08 15:43:36.545838 (Thread-198): Parsing macros/etc/is_incremental.sql
2021-01-08 15:43:36.547488 (Thread-198): Parsing macros/etc/get_custom_schema.sql
2021-01-08 15:43:36.589892 (Thread-198): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_DEMOGOG_STAGING".
2021-01-08 15:43:36.603234 (Thread-198): Acquiring new redshift connection "model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO".
2021-01-08 15:43:36.622167 (Thread-198): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE".
2021-01-08 15:43:36.634700 (Thread-198): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2".
2021-01-08 15:43:36.645066 (Thread-199): handling status request
2021-01-08 15:43:36.645384 (Thread-199): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f1f3880>]}
2021-01-08 15:43:36.645985 (Thread-199): sending response (<Response 185 bytes [200 OK]>) to 10.0.29.161
2021-01-08 15:43:36.651358 (Thread-198): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2".
2021-01-08 15:43:36.668333 (Thread-198): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_INFO".
2021-01-08 15:43:36.685295 (Thread-198): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1".
2021-01-08 15:43:36.699789 (Thread-198): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3".
2021-01-08 15:43:38.099813 (Thread-200): handling status request
2021-01-08 15:43:38.100269 (Thread-200): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e32b220>]}
2021-01-08 15:43:38.126041 (Thread-200): sending response (<Response 11204 bytes [200 OK]>) to 10.0.45.44
2021-01-08 15:48:33.385906 (MainThread): Connection 'model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3' was properly closed.
2021-01-08 15:48:33.451227 (Thread-201): Got an acceptable cached parse result
2021-01-08 15:48:33.484643 (Thread-201): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_DEMOGOG_STAGING".
2021-01-08 15:48:34.342800 (Thread-202): handling status request
2021-01-08 15:48:34.343239 (Thread-202): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e449190>]}
2021-01-08 15:48:34.344162 (Thread-202): sending response (<Response 765 bytes [200 OK]>) to 10.0.12.132
2021-01-08 15:48:43.771685 (MainThread): Connection 'model.my_new_project.wns_nm_DD_DEMOGOG_STAGING' was properly closed.
2021-01-08 15:48:43.835429 (Thread-203): Got an acceptable cached parse result
2021-01-08 15:48:43.886922 (Thread-203): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE".
2021-01-08 15:48:44.195550 (Thread-204): handling status request
2021-01-08 15:48:44.195996 (Thread-204): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6ffd8e80>]}
2021-01-08 15:48:44.196915 (Thread-204): sending response (<Response 766 bytes [200 OK]>) to 10.0.18.208
2021-01-08 15:48:53.825532 (MainThread): Connection 'model.my_new_project.wns_nm_DD_TT_UCID_REFTABLE' was properly closed.
2021-01-08 15:48:53.886783 (Thread-205): Got an acceptable cached parse result
2021-01-08 15:48:53.943007 (Thread-205): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1".
2021-01-08 15:48:54.256961 (Thread-206): handling status request
2021-01-08 15:48:54.259285 (Thread-206): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d75258df0>]}
2021-01-08 15:48:54.260161 (Thread-206): sending response (<Response 769 bytes [200 OK]>) to 10.0.16.243
2021-01-08 15:49:01.403864 (MainThread): Connection 'model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1' was properly closed.
2021-01-08 15:49:01.463983 (Thread-207): Got an acceptable cached parse result
2021-01-08 15:49:01.508782 (Thread-207): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2".
2021-01-08 15:49:01.827575 (Thread-208): handling status request
2021-01-08 15:49:01.827991 (Thread-208): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e5565b0>]}
2021-01-08 15:49:01.828873 (Thread-208): sending response (<Response 771 bytes [200 OK]>) to 10.0.23.166
2021-01-08 15:49:11.363753 (MainThread): Connection 'model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP1_2' was properly closed.
2021-01-08 15:49:11.424580 (Thread-209): Got an acceptable cached parse result
2021-01-08 15:49:11.473137 (Thread-209): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2".
2021-01-08 15:49:11.800674 (Thread-210): handling status request
2021-01-08 15:49:11.801102 (Thread-210): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e237f10>]}
2021-01-08 15:49:11.802077 (Thread-210): sending response (<Response 769 bytes [200 OK]>) to 10.0.29.161
2021-01-08 15:49:26.869894 (MainThread): Connection 'model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP2' was properly closed.
2021-01-08 15:49:26.929930 (Thread-211): Got an acceptable cached parse result
2021-01-08 15:49:27.095010 (Thread-211): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_INFO".
2021-01-08 15:49:27.528394 (Thread-212): handling status request
2021-01-08 15:49:27.528839 (Thread-212): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e042a00>]}
2021-01-08 15:49:27.529730 (Thread-212): sending response (<Response 763 bytes [200 OK]>) to 10.0.44.27
2021-01-08 15:49:37.816536 (MainThread): Connection 'model.my_new_project.wns_nm_DD_UCID_HHI_INFO' was properly closed.
2021-01-08 15:49:37.880462 (Thread-213): Got an acceptable cached parse result
2021-01-08 15:49:37.919134 (Thread-213): Acquiring new redshift connection "model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO".
2021-01-08 15:49:38.265738 (Thread-214): handling status request
2021-01-08 15:49:38.266201 (Thread-214): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e224460>]}
2021-01-08 15:49:38.267105 (Thread-214): sending response (<Response 767 bytes [200 OK]>) to 10.0.44.27
2021-01-08 15:52:33.523323 (MainThread): Connection 'model.my_new_project.WNS_NM_SD_DIM_CUSTOMER_DEMO' was properly closed.
2021-01-08 15:52:33.586979 (Thread-215): Got an acceptable cached parse result
2021-01-08 15:52:33.751835 (Thread-215): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3".
2021-01-08 15:52:34.503553 (Thread-216): handling status request
2021-01-08 15:52:34.503979 (Thread-216): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f336790>]}
2021-01-08 15:52:34.504878 (Thread-216): sending response (<Response 769 bytes [200 OK]>) to 10.0.12.132
2021-01-08 15:52:43.994164 (MainThread): Connection 'model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3' was properly closed.
2021-01-08 15:52:44.058654 (Thread-217): Got an acceptable cached parse result
2021-01-08 15:52:44.122190 (Thread-217): Acquiring new redshift connection "model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3".
2021-01-08 15:52:44.457551 (Thread-218): handling status request
2021-01-08 15:52:44.457976 (Thread-218): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f4167f0>]}
2021-01-08 15:52:44.458946 (Thread-218): sending response (<Response 769 bytes [200 OK]>) to 10.0.44.27
2021-01-08 15:52:49.920320 (Thread-219): handling status request
2021-01-08 15:52:49.920758 (Thread-219): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f416dc0>]}
2021-01-08 15:52:49.921661 (Thread-219): sending response (<Response 769 bytes [200 OK]>) to 10.0.44.27
2021-01-08 15:52:50.345558 (Thread-220): handling compile_sql request
2021-01-08 15:52:50.345990 (Thread-220): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f350850>]}
2021-01-08 15:52:50.347173 (Thread-220): Connection 'model.my_new_project.wns_nm_DD_UCID_HHI_DEMO_TEMP3' was properly closed.
2021-01-08 15:52:51.173640 (Thread-220): sending response (<Response 138 bytes [200 OK]>) to 10.0.44.142
2021-01-08 15:52:51.190806 (MainThread): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-08 15:52:51.243431 (MainThread): Found 8 models, 0 tests, 0 snapshots, 0 analyses, 163 macros, 0 operations, 0 seed files, 0 sources
2021-01-08 15:52:51.243928 (Thread-1): Acquiring new redshift connection "rpc.my_new_project.request".
2021-01-08 15:52:51.244030 (Thread-1): Compiling rpc.my_new_project.request
2021-01-08 15:52:51.260914 (Thread-1): finished collecting timing info
2021-01-08 15:52:51.261122 (Thread-1): finished collecting timing info
2021-01-08 15:52:51.605489 (Thread-221): handling poll request
2021-01-08 15:52:51.605946 (Thread-221): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6f416e80>]}
2021-01-08 15:52:51.610396 (Thread-221): sending response (<Response 10485 bytes [200 OK]>) to 10.0.2.182
2021-01-08 15:52:58.044977 (Thread-222): Got an acceptable cached parse result
2021-01-08 15:52:58.435225 (Thread-223): handling status request
2021-01-08 15:52:58.435633 (Thread-223): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e6e5190>]}
2021-01-08 15:52:58.436518 (Thread-223): sending response (<Response 448 bytes [200 OK]>) to 10.0.16.243
2021-01-08 15:53:09.124362 (Thread-224): handling status request
2021-01-08 15:53:09.124983 (Thread-224): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '2e1c5a32-cee5-49e1-a290-7af755b6b5aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5d6e31ef10>]}
2021-01-08 15:53:09.125806 (Thread-224): sending response (<Response 448 bytes [200 OK]>) to 10.0.16.243
